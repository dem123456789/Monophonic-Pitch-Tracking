<!-- saved from url=(0014)about:internet -->
<pre class="code">
<span class="srcline"><span class="lineno"><a href="132,1" id="srcline1">  1</a></span><span class="line"><span class="keyword">function</span> <span class="var type1" id="S2T132U3">output</span> = Mybesseli(<span class="mxinfo" id="T2:U2"><span class="var type2" id="S3T2V5U6">alpha</span></span>,<span class="var type1" id="S4T51U7">xx</span>,<span class="var type0" id="S5T0U8">scale</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="132,2" id="srcline2">  2</a></span><span class="line"><span class="comment">%BESSELI Modified Bessel functions of the first kind.</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,3" id="srcline3">  3</a></span><span class="line"><span class="comment">%   I = BESSELI(ALPHA,X) computes modified Bessel functions of the</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,4" id="srcline4">  4</a></span><span class="line"><span class="comment">%   first kind, I_sub_alpha(X) for real, non-negative order ALPHA</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,5" id="srcline5">  5</a></span><span class="line"><span class="comment">%   and argument X.  In general, both ALPHA and X may be vectors.</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,6" id="srcline6">  6</a></span><span class="line"><span class="comment">%   The output I is m-by-n with m = length(X), n = length(ALPHA) and</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,7" id="srcline7">  7</a></span><span class="line"><span class="comment">%       I(k,j) = I_sub_alpha(j)(X(k)).</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,8" id="srcline8">  8</a></span><span class="line"><span class="comment">%   The elements of X can be any nonnegative real values in any order.</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,9" id="srcline9">  9</a></span><span class="line"><span class="comment">%   For ALPHA there are two important restrictions: the increment</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,10" id="srcline10"> 10</a></span><span class="line"><span class="comment">%   in ALPHA must be one, i.e. ALPHA = alpha:1:alpha+n-1, and the</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,11" id="srcline11"> 11</a></span><span class="line"><span class="comment">%   elements must also be in the range 0 &lt;= ALPHA(j) &lt;= 1000.</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,12" id="srcline12"> 12</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,13" id="srcline13"> 13</a></span><span class="line"><span class="comment">%   E = BESSELI(ALPHA,X,1) computes I_sub_alpha(X)*EXP(-X).</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,14" id="srcline14"> 14</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,15" id="srcline15"> 15</a></span><span class="line"><span class="comment">%   The relationship between the Bessel functions of the first kind is</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,16" id="srcline16"> 16</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,17" id="srcline17"> 17</a></span><span class="line"><span class="comment">%       I_sub_alpha(x) = i^(-alpha) * J_sub_alpha(i*x)</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,18" id="srcline18"> 18</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,19" id="srcline19"> 19</a></span><span class="line"><span class="comment">%   Examples:</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,20" id="srcline20"> 20</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,21" id="srcline21"> 21</a></span><span class="line"><span class="comment">%       besseli(3:9,[0:.2:9.8 10:.5:20],1) generates the entire </span></span></span>
<span class="srcline"><span class="lineno"><a href="132,22" id="srcline22"> 22</a></span><span class="line"><span class="comment">%       71-by-7 table on page 423 of Abramowitz and Stegun,</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,23" id="srcline23"> 23</a></span><span class="line"><span class="comment">%       "Handbook of Mathematical Functions."</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,24" id="srcline24"> 24</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,25" id="srcline25"> 25</a></span><span class="line"><span class="comment">%   See also: BESSELJ, BESSELY, BESSELK.</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,26" id="srcline26"> 26</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="132,27" id="srcline27"> 27</a></span><span class="line"><span class="comment">%   Acknowledgement:</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,28" id="srcline28"> 28</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,29" id="srcline29"> 29</a></span><span class="line"><span class="comment">%   This program is based on a Fortran program by W. J. Cody and</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,30" id="srcline30"> 30</a></span><span class="line"><span class="comment">%   L. Stoltz, Applied Mathematics Division, Argonne National</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,31" id="srcline31"> 31</a></span><span class="line"><span class="comment">%   Laboratory, dated May 30, 1989.  Their references include:</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,32" id="srcline32"> 32</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,33" id="srcline33"> 33</a></span><span class="line"><span class="comment">%      "A Note on backward recurrence algorithms," Olver, F. W. J.,</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,34" id="srcline34"> 34</a></span><span class="line"><span class="comment">%      and Sookne, D. J., Math. Comp. 26, 1972, pp 941-947.</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,35" id="srcline35"> 35</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,36" id="srcline36"> 36</a></span><span class="line"><span class="comment">%      "Bessel functions of real argument and integer order,"</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,37" id="srcline37"> 37</a></span><span class="line"><span class="comment">%      Sookne, D. J., NBS Jour. of Res. B. 77b, 1973, pp. 125-132.</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,38" id="srcline38"> 38</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,39" id="srcline39"> 39</a></span><span class="line"><span class="comment">%      "Algorithm 597, Sequence of modified Bessel functions of the</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,40" id="srcline40"> 40</a></span><span class="line"><span class="comment">%      "first kind," Cody, W. J., Trans. Math. Soft., 1983, pp. 242-245.</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,41" id="srcline41"> 41</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,42" id="srcline42"> 42</a></span><span class="line"><span class="comment">%   MATLAB version: C. Moler, 10/6/92.</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,43" id="srcline43"> 43</a></span><span class="line"><span class="comment">%   Copyright (c) 1984-94 by The MathWorks, Inc.</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,44" id="srcline44"> 44</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="132,45" id="srcline45"> 45</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,46" id="srcline46"> 46</a></span><span class="line"><span class="comment">%  Check for real, non-negative arguments.</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,47" id="srcline47"> 47</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,48" id="srcline48"> 48</a></span><span class="line"><span class="comment">%    if nargin &lt; 3, scale = 0; end</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,49" id="srcline49"> 49</a></span><span class="line"><span class="comment">%    if any(imag(xx)) | any(xx &lt; 0) | any(imag(alpha)) | any(alpha &lt; 0)</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,50" id="srcline50"> 50</a></span><span class="line"><span class="comment">%       error('Input arguments must be real and nonnegative.')</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,51" id="srcline51"> 51</a></span><span class="line"><span class="comment">%    end</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,52" id="srcline52"> 52</a></span><span class="line"><span class="comment">%    if isempty(alpha) | isempty(xx)</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,53" id="srcline53"> 53</a></span><span class="line"><span class="comment">%       bk = []; </span></span></span>
<span class="srcline"><span class="lineno"><a href="132,54" id="srcline54"> 54</a></span><span class="line"><span class="comment">%       return</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,55" id="srcline55"> 55</a></span><span class="line"><span class="comment">%    end</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,56" id="srcline56"> 56</a></span><span class="line">   <span class="mxinfo" id="T2:U5"><span class="var type1" id="S5T2U11">scale</span> = <span class="mxinfo" id="T2:U7">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="132,57" id="srcline57"> 57</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,58" id="srcline58"> 58</a></span><span class="line"><span class="comment">%  Break alpha into integer and fractional parts,</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,59" id="srcline59"> 59</a></span><span class="line"><span class="comment">%  and initialize result array.</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,60" id="srcline60"> 60</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,61" id="srcline61"> 61</a></span><span class="line">   <span class="mxinfo" id="T2:U8"><span class="var type1" id="S6T2U15">nfirst</span> = <span class="mxinfo" id="T2:U10">fix(<span class="var type1" id="S3T2U19">alpha</span>(1))</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="132,62" id="srcline62"> 62</a></span><span class="line">   <span class="mxinfo" id="T2:U12"><span class="var type1" id="S8T2U23">nb</span> = <span class="mxinfo" id="T2:U14">fix(<span class="var type1" id="S3T2U28">alpha</span>(length(<span class="var type1" id="S3T2U31">alpha</span>))) + 1</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="132,63" id="srcline63"> 63</a></span><span class="line">   <span class="mxinfo" id="T51:U17"><span class="var type1" id="S10T51U35">b</span> = <span class="mxinfo" id="T51:U19"><span class="mxinfo" id="T2:U20">NaN</span>*<span class="mxinfo" id="T51:U21">ones(<span class="mxinfo" id="T2:U22">length(<span class="var type1" id="S4T51U43">xx</span>)</span>,<span class="var type1" id="S8T2U44">nb</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="132,64" id="srcline64"> 64</a></span><span class="line">   <span class="keyword">if</span> ~(<span class="var type1" id="S8T2U50">nb</span> &lt;= 1001)</span></span>
<span class="srcline"><span class="lineno"><a href="132,65" id="srcline65"> 65</a></span><span class="line">      error(<span class="string">'Alpha must be &lt;= 1000.'</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="132,66" id="srcline66"> 66</a></span><span class="line">   <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,67" id="srcline67"> 67</a></span><span class="line">   <span class="keyword">if</span> length(<span class="var type1" id="S3T2U61">alpha</span>) &gt; 1</span></span>
<span class="srcline"><span class="lineno"><a href="132,68" id="srcline68"> 68</a></span><span class="line">      <span class="keyword">if</span> any(abs(diff(<span class="var type0" id="S3T0U73">alpha</span>)-1) &gt; 4*<span class="var type0" id="S8T0U78">nb</span>*eps)</span></span>
<span class="srcline"><span class="lineno"><a href="132,69" id="srcline69"> 69</a></span><span class="line">         error(<span class="string">'Increment in alpha must be 1.'</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="132,70" id="srcline70"> 70</a></span><span class="line">      <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,71" id="srcline71"> 71</a></span><span class="line">   <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,72" id="srcline72"> 72</a></span><span class="line"><span class="comment">%    resize = (length(alpha) == 1);</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,73" id="srcline73"> 73</a></span><span class="line">   <span class="mxinfo" id="T4:U27"><span class="var type1" id="S18T4U87">resize_flag</span> = (<span class="mxinfo" id="T4:U29">length(<span class="var type1" id="S3T2U92">alpha</span>) == 1</span>)</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="132,74" id="srcline74"> 74</a></span><span class="line"><span class="comment">%    if resize, resize = size(xx); end</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,75" id="srcline75"> 75</a></span><span class="line">   <span class="keyword">if</span> <span class="var type1" id="S18T4U96">resize_flag</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,76" id="srcline76"> 76</a></span><span class="line">       <span class="mxinfo" id="T7:U32"><span class="var type1" id="S19T7U99">resize</span> = <span class="mxinfo" id="T7:U34">size(<span class="var type1" id="S4T51U102">xx</span>)</span></span>; </span></span>
<span class="srcline"><span class="lineno"><a href="132,77" id="srcline77"> 77</a></span><span class="line">   <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,78" id="srcline78"> 78</a></span><span class="line">   <span class="mxinfo" id="T51:U36"><span class="var type1" id="S4T51U105">xx</span> = <span class="mxinfo" id="T51:U38"><span class="var type1" id="S4T51U107">xx</span>(:)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="132,79" id="srcline79"> 79</a></span><span class="line"><span class="comment">%    b = NaN*ones(length(xx),nb);</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,80" id="srcline80"> 80</a></span><span class="line">   <span class="mxinfo" id="T2:U40"><span class="var type1" id="S3T2U111">alpha</span> = <span class="mxinfo" id="T2:U42"><span class="var type1" id="S3T2U114">alpha</span>(1) - <span class="var type1" id="S6T2U116">nfirst</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="132,81" id="srcline81"> 81</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,82" id="srcline82"> 82</a></span><span class="line"><span class="comment">%  Asymptotic expansion for large x.</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,83" id="srcline83"> 83</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,84" id="srcline84"> 84</a></span><span class="line">   <span class="mxinfo" id="T51:U45"><span class="var type1" id="S21T51U119">v</span> = <span class="mxinfo" id="T51:U47">find(<span class="mxinfo" id="T50:U48"><span class="mxinfo" id="T2:U49">1.e3</span> &lt; <span class="var type1" id="S4T51U124">xx</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="132,85" id="srcline85"> 85</a></span><span class="line">   <span class="keyword">if</span> <span class="mxinfo" id="T4:U51">any(<span class="var type1" id="S21T51U129">v</span>)</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,86" id="srcline86"> 86</a></span><span class="line">      <span class="mxinfo" id="T51:U53"><span class="var type1" id="S23T51U132">x</span> = <span class="mxinfo" id="T51:U55"><span class="var type1" id="S4T51U134">xx</span>(<span class="var type1" id="S21T51U135">v</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="132,87" id="srcline87"> 87</a></span><span class="line">      <span class="keyword">if</span> <span class="var type1" id="S5T2U138">scale</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,88" id="srcline88"> 88</a></span><span class="line">         <span class="var type0" id="S24T0U141">z</span> = 1./(8*<span class="var type0" id="S23T0U147">x</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="132,89" id="srcline89"> 89</a></span><span class="line">         <span class="var type0" id="S25T0U150">mu</span> = 4*(<span class="var type0" id="S6T0U158">nfirst</span>+<span class="var type0" id="S3T0U159">alpha</span>:1:<span class="var type0" id="S8T0U163">nb</span>-1+<span class="var type0" id="S3T0U165">alpha</span>).^2;</span></span>
<span class="srcline"><span class="lineno"><a href="132,90" id="srcline90"> 90</a></span><span class="line">         <span class="var type0" id="S24T0U169">z</span> = (1 - <span class="var type0" id="S24T0U175">z</span>*(<span class="var type0" id="S25T0U178">mu</span>-1).*(1 - (<span class="var type0" id="S24T0U187">z</span>/2)*(<span class="var type0" id="S25T0U191">mu</span>-9).*(1 - (<span class="var type0" id="S24T0U199">z</span>/3)*(<span class="var type0" id="S25T0U203">mu</span> - 25))));</span></span>
<span class="srcline"><span class="lineno"><a href="132,91" id="srcline91"> 91</a></span><span class="line">         <span class="var type0" id="S10T0U208">b</span>(<span class="var type0" id="S21T0U209">v</span>,<span class="var type0" id="S6T0U212">nfirst</span>+1:<span class="var type0" id="S8T0U214">nb</span>) = ((1./sqrt(2*pi*<span class="var type0" id="S23T0U228">x</span>))*ones(1,<span class="var type0" id="S8T0U233">nb</span>-<span class="var type0" id="S6T0U234">nfirst</span>)).*<span class="var type0" id="S24T0U235">z</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="132,92" id="srcline92"> 92</a></span><span class="line">      <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,93" id="srcline93"> 93</a></span><span class="line">         <span class="mxinfo" id="T51:U59"><span class="mxinfo" id="T51:U60"><span class="var type1" id="S10T51U240">b</span>(<span class="var type1" id="S21T51U241">v</span>,:)</span> = <span class="mxinfo" id="T51:U63"><span class="mxinfo" id="T2:U64">Inf</span>*<span class="mxinfo" id="T51:U65">ones(<span class="mxinfo" id="T2:U66">length(<span class="var type1" id="S21T51U250">v</span>)</span>,<span class="var type1" id="S8T2U251">nb</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="132,94" id="srcline94"> 94</a></span><span class="line">      <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,95" id="srcline95"> 95</a></span><span class="line">   <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,96" id="srcline96"> 96</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,97" id="srcline97"> 97</a></span><span class="line"><span class="comment">%  Three-term backward recurrence for most x.</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,98" id="srcline98"> 98</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,99" id="srcline99"> 99</a></span><span class="line">   <span class="mxinfo" id="T51:U69"><span class="var type1" id="S21T51U254">v</span> = <span class="mxinfo" id="T51:U71">find(<span class="mxinfo" id="T50:U72">(<span class="mxinfo" id="T50:U73"><span class="mxinfo" id="T2:U74">1.e-4</span> &lt;= <span class="var type1" id="S4T51U261">xx</span></span>) &amp; (<span class="mxinfo" id="T50:U76"><span class="var type1" id="S4T51U264">xx</span> &lt;= <span class="mxinfo" id="T2:U78">1.e3</span></span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="132,100" id="srcline100">100</a></span><span class="line">   <span class="keyword">if</span> <span class="mxinfo" id="T4:U79">any(<span class="var type1" id="S21T51U270">v</span>)</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,101" id="srcline101">101</a></span><span class="line">      <span class="mxinfo" id="T51:U81"><span class="var type1" id="S23T51U273">x</span> = <span class="mxinfo" id="T51:U83"><span class="var type1" id="S4T51U275">xx</span>(<span class="var type1" id="S21T51U276">v</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="132,102" id="srcline102">102</a></span><span class="line">      <span class="mxinfo" id="T2:U86"><span class="var type1" id="S29T2U279">magx</span> = <span class="mxinfo" id="T2:U88">max(<span class="mxinfo" id="T51:U89">fix(<span class="var type1" id="S23T51U284">x</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="132,103" id="srcline103">103</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,104" id="srcline104">104</a></span><span class="line"><span class="comment">%     Initialize the forward sweep, the p-sequence of Olver.</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,105" id="srcline105">105</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,106" id="srcline106">106</a></span><span class="line">      <span class="mxinfo" id="T2:U91"><span class="var type1" id="S31T2U287">nbmx</span> = <span class="mxinfo" id="T2:U93"><span class="mxinfo" id="T2:U94"><span class="var type1" id="S8T2U289">nb</span></span>-<span class="var type1" id="S29T2U290">magx</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="132,107" id="srcline107">107</a></span><span class="line">      <span class="mxinfo" id="T2:U97"><span class="var type1" id="S32T2U293">n</span> = <span class="mxinfo" id="T2:U99"><span class="var type1" id="S29T2U295">magx</span>+<span class="mxinfo" id="T2:U101">1</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="132,108" id="srcline108">108</a></span><span class="line">      <span class="mxinfo" id="T2:U102"><span class="var type1" id="S33T2U299">en</span> = <span class="mxinfo" id="T2:U104">(<span class="mxinfo" id="T2:U105"><span class="var type1" id="S32T2U303">n</span>+<span class="var type1" id="S32T2U304">n</span></span>) + (<span class="mxinfo" id="T2:U108"><span class="var type1" id="S3T2U307">alpha</span>+<span class="var type1" id="S3T2U308">alpha</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="132,109" id="srcline109">109</a></span><span class="line">      <span class="mxinfo" id="T2:U111"><span class="var type1" id="S34T2U311">plast</span> = <span class="mxinfo" id="T2:U113">1</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="132,110" id="srcline110">110</a></span><span class="line">      <span class="mxinfo" id="T51:U114"><span class="var type1" id="S35T51U315">p</span> = <span class="mxinfo" id="T51:U116"><span class="var type1" id="S33T2U317">en</span> ./ <span class="var type1" id="S23T51U318">x</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="132,111" id="srcline111">111</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,112" id="srcline112">112</a></span><span class="line"><span class="comment">%     Calculate general significance test.</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,113" id="srcline113">113</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,114" id="srcline114">114</a></span><span class="line">      <span class="mxinfo" id="T2:U119"><span class="var type1" id="S36T2U321">test</span> = <span class="mxinfo" id="T2:U121">2/eps</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="132,115" id="srcline115">115</a></span><span class="line">      <span class="keyword">if</span> (<span class="mxinfo" id="T4:U122"><span class="mxinfo" id="T2:U123"><span class="mxinfo" id="T2:U124">2</span>*<span class="var type1" id="S29T2U332">magx</span></span> &gt; <span class="mxinfo" id="T2:U126">80</span></span>);</span></span>
<span class="srcline"><span class="lineno"><a href="132,116" id="srcline116">116</a></span><span class="line">         <span class="mxinfo" id="T2:U127"><span class="var type1" id="S36T2U336">test</span> = <span class="mxinfo" id="T2:U129">sqrt(<span class="mxinfo" id="T2:U130"><span class="mxinfo" id="T2:U131"><span class="var type1" id="S36T2U340">test</span></span>*<span class="mxinfo" id="T2:U133">max(<span class="var type1" id="S35T51U343">p</span>)</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="132,117" id="srcline117">117</a></span><span class="line">      <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,118" id="srcline118">118</a></span><span class="line">         <span class="mxinfo" id="T2:U135"><span class="var type1" id="S36T2U347">test</span> = <span class="mxinfo" id="T2:U137"><span class="mxinfo" id="T2:U138"><span class="var type1" id="S36T2U349">test</span></span> / <span class="mxinfo" id="T2:U140"><span class="mxinfo" id="T2:U141">1.585</span>^<span class="var type1" id="S29T2U352">magx</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="132,119" id="srcline119">119</a></span><span class="line">      <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,120" id="srcline120">120</a></span><span class="line"><span class="comment">%       if (nbmx &gt;= 3)</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,121" id="srcline121">121</a></span><span class="line"><span class="comment">% %</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,122" id="srcline122">122</a></span><span class="line"><span class="comment">% %     Calculate p-sequence until n = nb-1.</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,123" id="srcline123">123</a></span><span class="line"><span class="comment">% %</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,124" id="srcline124">124</a></span><span class="line"><span class="comment">%          tover = eps*realmax;</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,125" id="srcline125">125</a></span><span class="line"><span class="comment">%          nstart = magx+2;</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,126" id="srcline126">126</a></span><span class="line"><span class="comment">%          nend = nb - 1;</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,127" id="srcline127">127</a></span><span class="line"><span class="comment">%          for k = nstart:nend</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,128" id="srcline128">128</a></span><span class="line"><span class="comment">%             n = k;</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,129" id="srcline129">129</a></span><span class="line"><span class="comment">%             en = en + 2;</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,130" id="srcline130">130</a></span><span class="line"><span class="comment">%             pold = plast;</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,131" id="srcline131">131</a></span><span class="line"><span class="comment">%             plast = p;</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,132" id="srcline132">132</a></span><span class="line"><span class="comment">%             p = en * plast./x + pold;</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,133" id="srcline133">133</a></span><span class="line"><span class="comment">%             if any(p &gt; tover)</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,134" id="srcline134">134</a></span><span class="line"><span class="comment">% %</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,135" id="srcline135">135</a></span><span class="line"><span class="comment">% %           To avoid overflow, divide p-sequence by tover.</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,136" id="srcline136">136</a></span><span class="line"><span class="comment">% %           Calculate p-sequence until abs(p) &gt; 1.</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,137" id="srcline137">137</a></span><span class="line"><span class="comment">% %</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,138" id="srcline138">138</a></span><span class="line"><span class="comment">%                tover = realmax;</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,139" id="srcline139">139</a></span><span class="line"><span class="comment">%                p = p / tover;</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,140" id="srcline140">140</a></span><span class="line"><span class="comment">%                plast = plast / tover;</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,141" id="srcline141">141</a></span><span class="line"><span class="comment">%                psave = p;</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,142" id="srcline142">142</a></span><span class="line"><span class="comment">%                psavel = plast;</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,143" id="srcline143">143</a></span><span class="line"><span class="comment">%                nstart = n + 1;</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,144" id="srcline144">144</a></span><span class="line"><span class="comment">%                while any(p &lt;= 1);</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,145" id="srcline145">145</a></span><span class="line"><span class="comment">%                   n = n + 1;</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,146" id="srcline146">146</a></span><span class="line"><span class="comment">%                   en = en + 2;</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,147" id="srcline147">147</a></span><span class="line"><span class="comment">%                   pold = plast;</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,148" id="srcline148">148</a></span><span class="line"><span class="comment">%                   plast = p;</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,149" id="srcline149">149</a></span><span class="line"><span class="comment">%                   p = en * plast./x + pold;</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,150" id="srcline150">150</a></span><span class="line"><span class="comment">%                end</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,151" id="srcline151">151</a></span><span class="line"><span class="comment">%                tempb = en ./ x;</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,152" id="srcline152">152</a></span><span class="line"><span class="comment">% %</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,153" id="srcline153">153</a></span><span class="line"><span class="comment">% %              Calculate backward test, and find ncalc,</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,154" id="srcline154">154</a></span><span class="line"><span class="comment">% %              the highest n such that the test is passed.</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,155" id="srcline155">155</a></span><span class="line"><span class="comment">% %</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,156" id="srcline156">156</a></span><span class="line"><span class="comment">%                test = pold*plast*eps;</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,157" id="srcline157">157</a></span><span class="line"><span class="comment">%                test = test*(0.5-0.5/min(tempb*tempb));</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,158" id="srcline158">158</a></span><span class="line"><span class="comment">%                p = plast * tover;</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,159" id="srcline159">159</a></span><span class="line"><span class="comment">%                n = n - 1;</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,160" id="srcline160">160</a></span><span class="line"><span class="comment">%                en = en - 2;</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,161" id="srcline161">161</a></span><span class="line"><span class="comment">%                nend = min(nb,n);</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,162" id="srcline162">162</a></span><span class="line"><span class="comment">%                ncalc = nend + 1;</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,163" id="srcline163">163</a></span><span class="line"><span class="comment">%                for l = nstart:nend</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,164" id="srcline164">164</a></span><span class="line"><span class="comment">%                   pold = psavel;</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,165" id="srcline165">165</a></span><span class="line"><span class="comment">%                   psavel = psave;</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,166" id="srcline166">166</a></span><span class="line"><span class="comment">%                   psave = en * psavel./x + pold;</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,167" id="srcline167">167</a></span><span class="line"><span class="comment">%                   if any(psave.*psavel &gt; test);</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,168" id="srcline168">168</a></span><span class="line"><span class="comment">%                      ncalc = l-1;</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,169" id="srcline169">169</a></span><span class="line"><span class="comment">%                      test = 0;</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,170" id="srcline170">170</a></span><span class="line"><span class="comment">%                      break</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,171" id="srcline171">171</a></span><span class="line"><span class="comment">%                   end</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,172" id="srcline172">172</a></span><span class="line"><span class="comment">%                end</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,173" id="srcline173">173</a></span><span class="line"><span class="comment">%                break</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,174" id="srcline174">174</a></span><span class="line"><span class="comment">%             end</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,175" id="srcline175">175</a></span><span class="line"><span class="comment">%          end</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,176" id="srcline176">176</a></span><span class="line"><span class="comment">%          if ~test</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,177" id="srcline177">177</a></span><span class="line"><span class="comment">%             n = nend;</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,178" id="srcline178">178</a></span><span class="line"><span class="comment">%             en = (n+n) + (alpha+alpha);</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,179" id="srcline179">179</a></span><span class="line"><span class="comment">% %</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,180" id="srcline180">180</a></span><span class="line"><span class="comment">% %           Calculate special significance test for nbmx &gt; 2.</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,181" id="srcline181">181</a></span><span class="line"><span class="comment">% %</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,182" id="srcline182">182</a></span><span class="line"><span class="comment">%             test = max(test,max(sqrt(plast/eps).*sqrt(p+p)));</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,183" id="srcline183">183</a></span><span class="line"><span class="comment">%          end</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,184" id="srcline184">184</a></span><span class="line"><span class="comment">%       end</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,185" id="srcline185">185</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,186" id="srcline186">186</a></span><span class="line"><span class="comment">%     Calculate p-sequence until significance test passed.</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,187" id="srcline187">187</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,188" id="srcline188">188</a></span><span class="line">      <span class="mxinfo" id="T51:U143"><span class="var type1" id="S37T51U355">a</span> = <span class="var type1" id="S35T51U356">p</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="132,189" id="srcline189">189</a></span><span class="line">      <span class="mxinfo" id="T2:U146"><span class="var type1" id="S38T2U359">count</span> = <span class="mxinfo" id="T2:U148">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="132,190" id="srcline190">190</a></span><span class="line">      <span class="keyword">while</span> <span class="mxinfo" id="T4:U149">any(<span class="mxinfo" id="T50:U150"><span class="var type1" id="S35T51U365">p</span> &lt; <span class="var type1" id="S36T2U366">test</span></span>)</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,191" id="srcline191">191</a></span><span class="line">         <span class="mxinfo" id="T2:U153"><span class="var type1" id="S32T2U369">n</span> = <span class="mxinfo" id="T2:U155"><span class="var type1" id="S32T2U371">n</span> + <span class="mxinfo" id="T2:U157">1</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="132,192" id="srcline192">192</a></span><span class="line">         <span class="mxinfo" id="T2:U158"><span class="var type1" id="S33T2U375">en</span> = <span class="mxinfo" id="T2:U160"><span class="var type1" id="S33T2U377">en</span> + <span class="mxinfo" id="T2:U162">2</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="132,193" id="srcline193">193</a></span><span class="line">         <span class="keyword">if</span> <span class="mxinfo" id="T4:U163"><span class="var type1" id="S38T2U382">count</span> == <span class="mxinfo" id="T2:U165">1</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="132,194" id="srcline194">194</a></span><span class="line">            <span class="mxinfo" id="T51:U166"><span class="var type1" id="S34T51U386">plast</span> = <span class="var type1" id="S37T51U387">a</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="132,195" id="srcline195">195</a></span><span class="line">            <span class="mxinfo" id="T51:U169"><span class="var type1" id="S39T51U390">pold</span> = <span class="var type1" id="S34T51U391">plast</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="132,196" id="srcline196">196</a></span><span class="line">            <span class="mxinfo" id="T51:U172"><span class="var type1" id="S37T51U394">a</span> = <span class="var type1" id="S35T51U395">p</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="132,197" id="srcline197">197</a></span><span class="line">            <span class="mxinfo" id="T51:U175"><span class="var type1" id="S35T51U398">p</span> = <span class="mxinfo" id="T51:U177"><span class="mxinfo" id="T51:U178"><span class="mxinfo" id="T51:U179"><span class="var type1" id="S33T2U402">en</span> * <span class="var type1" id="S37T51U403">a</span></span>./<span class="var type1" id="S23T51U404">x</span></span> + <span class="var type1" id="S39T51U405">pold</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="132,198" id="srcline198">198</a></span><span class="line">         <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,199" id="srcline199">199</a></span><span class="line">             <span class="mxinfo" id="T2:U184"><span class="var type1" id="S38T2U409">count</span> = <span class="mxinfo" id="T2:U186">1</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="132,200" id="srcline200">200</a></span><span class="line">             <span class="mxinfo" id="T51:U187"><span class="var type1" id="S37T51U413">a</span> = <span class="var type1" id="S35T51U414">p</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="132,201" id="srcline201">201</a></span><span class="line">             <span class="mxinfo" id="T51:U190"><span class="var type1" id="S35T51U417">p</span> = <span class="mxinfo" id="T51:U192"><span class="mxinfo" id="T51:U193"><span class="mxinfo" id="T51:U194"><span class="var type1" id="S33T2U421">en</span> * <span class="var type1" id="S37T51U422">a</span></span>./<span class="var type1" id="S23T51U423">x</span></span> + <span class="mxinfo" id="T51:U198">ones(<span class="mxinfo" id="T2:U199">length(<span class="var type1" id="S37T51U428">a</span>)</span>,1)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="132,202" id="srcline202">202</a></span><span class="line">         <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,203" id="srcline203">203</a></span><span class="line"><span class="comment">%          a = p;</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,204" id="srcline204">204</a></span><span class="line"><span class="comment">%          p = en * a./x + pold;</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,205" id="srcline205">205</a></span><span class="line">      <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,206" id="srcline206">206</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,207" id="srcline207">207</a></span><span class="line"><span class="comment">%     Initialize the backward recursion and the normalization sum.</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,208" id="srcline208">208</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,209" id="srcline209">209</a></span><span class="line">      <span class="mxinfo" id="T2:U201"><span class="var type1" id="S32T2U432">n</span> = <span class="mxinfo" id="T2:U203"><span class="var type1" id="S32T2U434">n</span> + <span class="mxinfo" id="T2:U205">1</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="132,210" id="srcline210">210</a></span><span class="line">      <span class="mxinfo" id="T2:U206"><span class="var type1" id="S33T2U438">en</span> = <span class="mxinfo" id="T2:U208"><span class="var type1" id="S33T2U440">en</span> + <span class="mxinfo" id="T2:U210">2</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="132,211" id="srcline211">211</a></span><span class="line">      <span class="mxinfo" id="T51:U211"><span class="var type1" id="S40T51U444">tempb</span> = <span class="mxinfo" id="T2:U213">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="132,212" id="srcline212">212</a></span><span class="line">      <span class="mxinfo" id="T51:U214"><span class="var type1" id="S41T51U448">tempa</span> = <span class="mxinfo" id="T51:U216"><span class="mxinfo" id="T2:U217">1</span> ./ <span class="var type1" id="S35T51U451">p</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="132,213" id="srcline213">213</a></span><span class="line">      <span class="mxinfo" id="T2:U219"><span class="var type1" id="S42T2U454">em</span> = <span class="mxinfo" id="T2:U221"><span class="var type1" id="S32T2U456">n</span> - <span class="mxinfo" id="T2:U223">1</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="132,214" id="srcline214">214</a></span><span class="line">      <span class="mxinfo" id="T2:U224"><span class="var type1" id="S43T2U460">empal</span> = <span class="mxinfo" id="T2:U226"><span class="var type1" id="S42T2U462">em</span> + <span class="mxinfo" id="T2:U228"><span class="var type1" id="S3T2U463">alpha</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="132,215" id="srcline215">215</a></span><span class="line">      <span class="mxinfo" id="T2:U230"><span class="var type1" id="S44T2U466">emp2al</span> = <span class="mxinfo" id="T2:U232">(<span class="mxinfo" id="T2:U233"><span class="var type1" id="S42T2U470">em</span> - <span class="mxinfo" id="T2:U235">1</span></span>) + (<span class="mxinfo" id="T2:U236"><span class="var type1" id="S3T2U474">alpha</span> + <span class="var type1" id="S3T2U475">alpha</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="132,216" id="srcline216">216</a></span><span class="line">      <span class="mxinfo" id="T51:U239"><span class="var type1" id="S45T51U478">sum</span> = <span class="mxinfo" id="T51:U241"><span class="mxinfo" id="T51:U242"><span class="mxinfo" id="T51:U243"><span class="var type1" id="S41T51U482">tempa</span> * <span class="var type1" id="S43T2U483">empal</span></span> * <span class="var type1" id="S44T2U484">emp2al</span></span> / <span class="var type1" id="S42T2U485">em</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="132,217" id="srcline217">217</a></span><span class="line">      <span class="mxinfo" id="T2:U248"><span class="var type1" id="S46T2U488">nend</span> = <span class="mxinfo" id="T2:U250"><span class="var type1" id="S32T2U490">n</span> - <span class="mxinfo" id="T2:U252"><span class="var type1" id="S8T2U491">nb</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="132,218" id="srcline218">218</a></span><span class="line">      <span class="mxinfo" id="T2:U254"><span class="var type1" id="S47T2U494">skip</span> = <span class="mxinfo" id="T2:U256">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="132,219" id="srcline219">219</a></span><span class="line">      <span class="keyword">if</span> (<span class="mxinfo" id="T4:U257"><span class="var type1" id="S46T2U500">nend</span> &lt; <span class="mxinfo" id="T2:U259">0</span></span>)</span></span>
<span class="srcline"><span class="lineno"><a href="132,220" id="srcline220">220</a></span><span class="line">         <span class="mxinfo" id="T51:U260"><span class="mxinfo" id="T51:U261"><span class="var type1" id="S10T51U505">b</span>(<span class="var type1" id="S21T51U506">v</span>,<span class="var type1" id="S32T2U507">n</span>)</span> = <span class="var type1" id="S41T51U508">tempa</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="132,221" id="srcline221">221</a></span><span class="line">         <span class="mxinfo" id="T2:U266"><span class="var type1" id="S46T2U511">nend</span> = <span class="mxinfo" id="T2:U268">-<span class="var type1" id="S46T2U513">nend</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="132,222" id="srcline222">222</a></span><span class="line">         <span class="mxinfo" id="T68:U270"><span class="mxinfo" id="T68:U271"><span class="var type1" id="S10T51U517">b</span>(<span class="var type1" id="S21T51U518">v</span>,<span class="mxinfo" id="T51:U274"><span class="mxinfo" id="T2:U275"><span class="mxinfo" id="T2:U276"><span class="var type1" id="S32T2U521">n</span></span>+1</span>:<span class="mxinfo" id="T2:U278"><span class="var type1" id="S32T2U524">n</span>+<span class="var type1" id="S46T2U525">nend</span></span></span>)</span> = <span class="mxinfo" id="T68:U281">zeros(<span class="mxinfo" id="T2:U282">length(<span class="var type1" id="S21T51U530">v</span>)</span>,<span class="var type1" id="S46T2U531">nend</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="132,223" id="srcline223">223</a></span><span class="line">      <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,224" id="srcline224">224</a></span><span class="line">         <span class="keyword">if</span> (<span class="mxinfo" id="T4:U285"><span class="var type1" id="S46T2U537">nend</span> &gt; <span class="mxinfo" id="T2:U287">0</span></span>)</span></span>
<span class="srcline"><span class="lineno"><a href="132,225" id="srcline225">225</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,226" id="srcline226">226</a></span><span class="line"><span class="comment">%           Recur backward via difference equation, calculating </span></span></span>
<span class="srcline"><span class="lineno"><a href="132,227" id="srcline227">227</a></span><span class="line"><span class="comment">%           (but not storing) b(n), until n = nb.</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,228" id="srcline228">228</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,229" id="srcline229">229</a></span><span class="line">            <span class="mxinfo" id="T51:U288"><span class="var type1" id="S49T51U541">kk</span>= <span class="var type1" id="S41T51U542">tempa</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="132,230" id="srcline230">230</a></span><span class="line">            <span class="mxinfo" id="T2:U291"><span class="var type1" id="S50T2U545">count2</span> = <span class="mxinfo" id="T2:U293">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="132,231" id="srcline231">231</a></span><span class="line">            <span class="keyword">for</span> <span class="var type1" id="S51T2U549">l</span> = <span class="mxinfo" id="T2:U295">1</span>:<span class="var type1" id="S46T2U552">nend</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,232" id="srcline232">232</a></span><span class="line">               <span class="mxinfo" id="T2:U297"><span class="var type1" id="S32T2U555">n</span> = <span class="mxinfo" id="T2:U299"><span class="var type1" id="S32T2U557">n</span> - <span class="mxinfo" id="T2:U301">1</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="132,233" id="srcline233">233</a></span><span class="line">               <span class="mxinfo" id="T2:U302"><span class="var type1" id="S33T2U561">en</span> = <span class="mxinfo" id="T2:U304"><span class="var type1" id="S33T2U563">en</span> - <span class="mxinfo" id="T2:U306">2</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="132,234" id="srcline234">234</a></span><span class="line">               <span class="keyword">if</span> <span class="mxinfo" id="T4:U307"><span class="var type1" id="S50T2U568">count2</span> == <span class="mxinfo" id="T2:U309">1</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="132,235" id="srcline235">235</a></span><span class="line">                   <span class="mxinfo" id="T51:U310"><span class="var type1" id="S40T51U572">tempb</span> = <span class="var type1" id="S49T51U573">kk</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="132,236" id="srcline236">236</a></span><span class="line">                   <span class="mxinfo" id="T51:U313"><span class="var type1" id="S52T51U576">tempc</span> = <span class="var type1" id="S40T51U577">tempb</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="132,237" id="srcline237">237</a></span><span class="line">                   <span class="mxinfo" id="T51:U316"><span class="var type1" id="S49T51U580">kk</span> = <span class="var type1" id="S41T51U581">tempa</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="132,238" id="srcline238">238</a></span><span class="line">                   <span class="mxinfo" id="T51:U319"><span class="var type1" id="S41T51U584">tempa</span> = <span class="mxinfo" id="T51:U321"><span class="mxinfo" id="T51:U322">(<span class="mxinfo" id="T51:U323"><span class="var type1" id="S33T2U589">en</span>*<span class="var type1" id="S49T51U590">kk</span></span>) ./ <span class="var type1" id="S23T51U591">x</span></span> + <span class="var type1" id="S52T51U592">tempc</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="132,239" id="srcline239">239</a></span><span class="line">               <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,240" id="srcline240">240</a></span><span class="line">                   <span class="mxinfo" id="T2:U328"><span class="var type1" id="S50T2U596">count2</span> = <span class="mxinfo" id="T2:U330">1</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="132,241" id="srcline241">241</a></span><span class="line">                   <span class="mxinfo" id="T51:U331"><span class="var type1" id="S49T51U600">kk</span> = <span class="var type1" id="S41T51U601">tempa</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="132,242" id="srcline242">242</a></span><span class="line">                   <span class="mxinfo" id="T51:U334"><span class="var type1" id="S41T51U604">tempa</span> = <span class="mxinfo" id="T51:U336">(<span class="mxinfo" id="T51:U337"><span class="var type1" id="S33T2U608">en</span>*<span class="var type1" id="S49T51U609">kk</span></span>) ./ <span class="var type1" id="S23T51U610">x</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="132,243" id="srcline243">243</a></span><span class="line">               <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,244" id="srcline244">244</a></span><span class="line"><span class="comment">%                tempc = tempb;</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,245" id="srcline245">245</a></span><span class="line"><span class="comment">%                kk = tempa;</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,246" id="srcline246">246</a></span><span class="line"><span class="comment">%                tempa = (en*kk) ./ x + tempc;</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,247" id="srcline247">247</a></span><span class="line">               <span class="mxinfo" id="T2:U341"><span class="var type1" id="S42T2U613">em</span> = <span class="mxinfo" id="T2:U343"><span class="var type1" id="S42T2U615">em</span> - <span class="mxinfo" id="T2:U345">1</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="132,248" id="srcline248">248</a></span><span class="line">               <span class="mxinfo" id="T2:U346"><span class="var type1" id="S44T2U619">emp2al</span> = <span class="mxinfo" id="T2:U348"><span class="var type1" id="S44T2U621">emp2al</span> - <span class="mxinfo" id="T2:U350">1</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="132,249" id="srcline249">249</a></span><span class="line">               <span class="keyword">if</span> (<span class="mxinfo" id="T4:U351"><span class="var type1" id="S32T2U627">n</span> == <span class="mxinfo" id="T2:U353">1</span></span>), <span class="keyword">break</span>, <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,250" id="srcline250">250</a></span><span class="line">               <span class="keyword">if</span> (<span class="mxinfo" id="T4:U354"><span class="var type1" id="S32T2U634">n</span> == <span class="mxinfo" id="T2:U356">2</span></span>), <span class="mxinfo" id="T2:U357"><span class="var type1" id="S44T2U638">emp2al</span> = <span class="mxinfo" id="T2:U359">1</span></span>; <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,251" id="srcline251">251</a></span><span class="line">               <span class="mxinfo" id="T2:U360"><span class="var type1" id="S43T2U642">empal</span> = <span class="mxinfo" id="T2:U362"><span class="var type1" id="S43T2U644">empal</span> - <span class="mxinfo" id="T2:U364">1</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="132,252" id="srcline252">252</a></span><span class="line">               <span class="mxinfo" id="T51:U365"><span class="var type1" id="S45T51U648">sum</span> = <span class="mxinfo" id="T51:U367"><span class="mxinfo" id="T51:U368">(<span class="mxinfo" id="T51:U369"><span class="var type1" id="S45T51U653">sum</span> + <span class="mxinfo" id="T51:U371"><span class="var type1" id="S41T51U655">tempa</span>*<span class="var type1" id="S43T2U656">empal</span></span></span>) * <span class="var type1" id="S44T2U657">emp2al</span></span> / <span class="var type1" id="S42T2U658">em</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="132,253" id="srcline253">253</a></span><span class="line">            <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,254" id="srcline254">254</a></span><span class="line">         <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,255" id="srcline255">255</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,256" id="srcline256">256</a></span><span class="line"><span class="comment">%        Store b(nb).</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,257" id="srcline257">257</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,258" id="srcline258">258</a></span><span class="line">         <span class="mxinfo" id="T51:U376"><span class="mxinfo" id="T51:U377"><span class="var type1" id="S10T51U662">b</span>(<span class="var type1" id="S21T51U663">v</span>,<span class="var type1" id="S32T2U664">n</span>)</span> = <span class="var type1" id="S41T51U665">tempa</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="132,259" id="srcline259">259</a></span><span class="line">         <span class="keyword">if</span> (<span class="var type1" id="S8T2U670">nb</span> &lt;= 1)</span></span>
<span class="srcline"><span class="lineno"><a href="132,260" id="srcline260">260</a></span><span class="line">            <span class="mxinfo" id="T51:U383"><span class="var type1" id="S45T51U674">sum</span> = <span class="mxinfo" id="T51:U385">(<span class="mxinfo" id="T51:U386"><span class="var type1" id="S45T51U678">sum</span> + <span class="var type1" id="S45T51U679">sum</span></span>) + <span class="var type1" id="S41T51U680">tempa</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="132,261" id="srcline261">261</a></span><span class="line">            <span class="mxinfo" id="T2:U390"><span class="var type1" id="S47T2U683">skip</span> = <span class="mxinfo" id="T2:U392">-<span class="mxinfo" id="T2:U393">1</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="132,262" id="srcline262">262</a></span><span class="line">         <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,263" id="srcline263">263</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,264" id="srcline264">264</a></span><span class="line"><span class="comment">%           Calculate and store b(nb-1).</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,265" id="srcline265">265</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,266" id="srcline266">266</a></span><span class="line">            <span class="var type0" id="S32T0U689">n</span> = <span class="var type0" id="S32T0U691">n</span> - 1;</span></span>
<span class="srcline"><span class="lineno"><a href="132,267" id="srcline267">267</a></span><span class="line">            <span class="var type0" id="S33T0U695">en</span> = <span class="var type0" id="S33T0U697">en</span> - 2;</span></span>
<span class="srcline"><span class="lineno"><a href="132,268" id="srcline268">268</a></span><span class="line">            <span class="var type0" id="S10T0U702">b</span>(<span class="var type0" id="S21T0U703">v</span>,<span class="var type0" id="S32T0U704">n</span>)  = (<span class="var type0" id="S33T0U709">en</span>*<span class="var type0" id="S41T0U710">tempa</span>) ./ <span class="var type0" id="S23T0U711">x</span> + <span class="var type0" id="S40T0U712">tempb</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="132,269" id="srcline269">269</a></span><span class="line">            <span class="keyword">if</span> (<span class="var type0" id="S32T0U717">n</span> == 1)</span></span>
<span class="srcline"><span class="lineno"><a href="132,270" id="srcline270">270</a></span><span class="line">               <span class="var type0" id="S47T0U721">skip</span> = 1;</span></span>
<span class="srcline"><span class="lineno"><a href="132,271" id="srcline271">271</a></span><span class="line">            <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,272" id="srcline272">272</a></span><span class="line">               <span class="var type0" id="S42T0U726">em</span> = <span class="var type0" id="S42T0U728">em</span> - 1;</span></span>
<span class="srcline"><span class="lineno"><a href="132,273" id="srcline273">273</a></span><span class="line">               <span class="var type0" id="S44T0U732">emp2al</span> = <span class="var type0" id="S44T0U734">emp2al</span> - 1;</span></span>
<span class="srcline"><span class="lineno"><a href="132,274" id="srcline274">274</a></span><span class="line">               <span class="keyword">if</span> (<span class="var type0" id="S32T0U740">n</span> == 2), <span class="var type0" id="S44T0U744">emp2al</span> = 1; <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,275" id="srcline275">275</a></span><span class="line">               <span class="var type0" id="S43T0U748">empal</span> = <span class="var type0" id="S43T0U750">empal</span> - 1;</span></span>
<span class="srcline"><span class="lineno"><a href="132,276" id="srcline276">276</a></span><span class="line">               <span class="var type0" id="S45T0U754">sum</span> = (<span class="var type0" id="S45T0U759">sum</span> + <span class="var type0" id="S10T0U762">b</span>(<span class="var type0" id="S21T0U763">v</span>,<span class="var type0" id="S32T0U764">n</span>)*<span class="var type0" id="S43T0U765">empal</span>) * <span class="var type0" id="S44T0U766">emp2al</span> / <span class="var type0" id="S42T0U767">em</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="132,277" id="srcline277">277</a></span><span class="line">            <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,278" id="srcline278">278</a></span><span class="line">         <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,279" id="srcline279">279</a></span><span class="line">      <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,280" id="srcline280">280</a></span><span class="line">      <span class="keyword">if</span> <span class="mxinfo" id="T4:U394"><span class="var type1" id="S47T2U771">skip</span> == <span class="mxinfo" id="T2:U396">0</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="132,281" id="srcline281">281</a></span><span class="line">         <span class="mxinfo" id="T2:U397"><span class="var type1" id="S46T2U775">nend</span> = <span class="mxinfo" id="T2:U399"><span class="var type1" id="S32T2U777">n</span> - <span class="mxinfo" id="T2:U401">2</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="132,282" id="srcline282">282</a></span><span class="line">         <span class="keyword">if</span> (<span class="mxinfo" id="T4:U402"><span class="var type1" id="S46T2U783">nend</span> &gt; <span class="mxinfo" id="T2:U404">0</span></span>)</span></span>
<span class="srcline"><span class="lineno"><a href="132,283" id="srcline283">283</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,284" id="srcline284">284</a></span><span class="line"><span class="comment">%        Calculate via difference equation and store b(n), until n = 2.</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,285" id="srcline285">285</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,286" id="srcline286">286</a></span><span class="line">            <span class="keyword">for</span> <span class="var type1" id="S51T2U787">l</span> = 1:<span class="var type1" id="S46T2U790">nend</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,287" id="srcline287">287</a></span><span class="line">               <span class="var type1" id="S32T2U793">n</span> = <span class="var type1" id="S32T2U795">n</span> - 1;</span></span>
<span class="srcline"><span class="lineno"><a href="132,288" id="srcline288">288</a></span><span class="line">               <span class="var type1" id="S33T2U799">en</span> = <span class="var type1" id="S33T2U801">en</span> - 2;</span></span>
<span class="srcline"><span class="lineno"><a href="132,289" id="srcline289">289</a></span><span class="line">               <span class="var type1" id="S10T51U806">b</span>(<span class="var type1" id="S21T51U807">v</span>,<span class="var type1" id="S32T2U808">n</span>) = (<span class="var type1" id="S33T2U813">en</span>*<span class="var type1" id="S10T51U815">b</span>(<span class="var type1" id="S21T51U816">v</span>,<span class="var type1" id="S32T2U818">n</span>+1)) ./ <span class="var type1" id="S23T51U820">x</span> + <span class="var type1" id="S10T51U822">b</span>(<span class="var type1" id="S21T51U823">v</span>,<span class="var type1" id="S32T2U825">n</span>+2);</span></span>
<span class="srcline"><span class="lineno"><a href="132,290" id="srcline290">290</a></span><span class="line">               <span class="var type1" id="S42T2U829">em</span> = <span class="var type1" id="S42T2U831">em</span> - 1;</span></span>
<span class="srcline"><span class="lineno"><a href="132,291" id="srcline291">291</a></span><span class="line">               <span class="var type1" id="S44T2U835">emp2al</span> = <span class="var type1" id="S44T2U837">emp2al</span> - 1;</span></span>
<span class="srcline"><span class="lineno"><a href="132,292" id="srcline292">292</a></span><span class="line">               <span class="keyword">if</span> (<span class="var type1" id="S32T2U843">n</span> == 2), <span class="var type1" id="S44T2U847">emp2al</span> = 1; <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,293" id="srcline293">293</a></span><span class="line">               <span class="var type1" id="S43T2U851">empal</span> = <span class="var type1" id="S43T2U853">empal</span> - 1;</span></span>
<span class="srcline"><span class="lineno"><a href="132,294" id="srcline294">294</a></span><span class="line">               <span class="var type1" id="S45T51U857">sum</span> = (<span class="var type1" id="S45T51U862">sum</span> + <span class="var type1" id="S10T51U865">b</span>(<span class="var type1" id="S21T51U866">v</span>,<span class="var type1" id="S32T2U867">n</span>)*<span class="var type1" id="S43T2U868">empal</span>) * <span class="var type1" id="S44T2U869">emp2al</span> / <span class="var type1" id="S42T2U870">em</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="132,295" id="srcline295">295</a></span><span class="line">            <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,296" id="srcline296">296</a></span><span class="line">         <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,297" id="srcline297">297</a></span><span class="line">      <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,298" id="srcline298">298</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,299" id="srcline299">299</a></span><span class="line"><span class="comment">%     Calculate b(1)</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,300" id="srcline300">300</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,301" id="srcline301">301</a></span><span class="line"><span class="comment">%       if skip == 0</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,302" id="srcline302">302</a></span><span class="line"><span class="comment">%           b(v,1) = 2*empal*b(v,2) ./ x + b(v,3); </span></span></span>
<span class="srcline"><span class="lineno"><a href="132,303" id="srcline303">303</a></span><span class="line"><span class="comment">%       end</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,304" id="srcline304">304</a></span><span class="line"><span class="comment">%       if skip &gt;= 0</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,305" id="srcline305">305</a></span><span class="line"><span class="comment">%           sum = (sum + sum) + b(v,1); </span></span></span>
<span class="srcline"><span class="lineno"><a href="132,306" id="srcline306">306</a></span><span class="line"><span class="comment">%       end</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,307" id="srcline307">307</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,308" id="srcline308">308</a></span><span class="line"><span class="comment">%     Normalize.  Divide all b(n) by sum.</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,309" id="srcline309">309</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,310" id="srcline310">310</a></span><span class="line">      <span class="keyword">if</span> (<span class="var type1" id="S3T2U875">alpha</span> ~= 0)</span></span>
<span class="srcline"><span class="lineno"><a href="132,311" id="srcline311">311</a></span><span class="line">         <span class="var type0" id="S45T0U879">sum</span> = <span class="var type0" id="S45T0U882">sum</span> * gamma(1+<span class="var type0" id="S3T0U887">alpha</span>) .* (<span class="var type0" id="S23T0U891">x</span>*0.5).^(-<span class="var type0" id="S3T0U895">alpha</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="132,312" id="srcline312">312</a></span><span class="line">      <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,313" id="srcline313">313</a></span><span class="line">      <span class="keyword">if</span> ~<span class="var type1" id="S5T2U899">scale</span>, <span class="mxinfo" id="T51:U440"><span class="var type1" id="S45T51U902">sum</span> = <span class="mxinfo" id="T51:U442"><span class="var type1" id="S45T51U904">sum</span> .* <span class="mxinfo" id="T51:U444">exp(<span class="mxinfo" id="T51:U445">-<span class="var type1" id="S23T51U908">x</span></span>)</span></span></span>; <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,314" id="srcline314">314</a></span><span class="line">      <span class="keyword">for</span> <span class="var type1" id="S32T2U911">n</span> = <span class="mxinfo" id="T2:U448">1:<span class="var type1" id="S8T2U914">nb</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="132,315" id="srcline315">315</a></span><span class="line">         <span class="mxinfo" id="T51:U450"><span class="mxinfo" id="T51:U451"><span class="var type1" id="S10T51U918">b</span>(<span class="var type1" id="S21T51U919">v</span>,<span class="var type1" id="S32T2U920">n</span>)</span> = <span class="mxinfo" id="T51:U455"><span class="mxinfo" id="T51:U456"><span class="var type1" id="S10T51U923">b</span>(<span class="var type1" id="S21T51U924">v</span>,<span class="mxinfo" id="T2:U459"><span class="var type1" id="S32T2U925">n</span></span>)</span> ./ <span class="var type1" id="S45T51U926">sum</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="132,316" id="srcline316">316</a></span><span class="line">      <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,317" id="srcline317">317</a></span><span class="line">   <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,318" id="srcline318">318</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,319" id="srcline319">319</a></span><span class="line"><span class="comment">%  Two-term ascending series for small x.</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,320" id="srcline320">320</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,321" id="srcline321">321</a></span><span class="line">   <span class="mxinfo" id="T51:U462"><span class="var type1" id="S21T51U929">v</span> = <span class="mxinfo" id="T51:U464">find(<span class="mxinfo" id="T50:U465">(<span class="mxinfo" id="T50:U466"><span class="mxinfo" id="T2:U467">0</span> &lt; <span class="var type1" id="S4T51U936">xx</span></span>) &amp; (<span class="mxinfo" id="T50:U469"><span class="var type1" id="S4T51U939">xx</span> &lt; <span class="mxinfo" id="T2:U471">1.e-4</span></span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="132,322" id="srcline322">322</a></span><span class="line">   <span class="keyword">if</span> <span class="mxinfo" id="T4:U472">any(<span class="var type1" id="S21T51U945">v</span>)</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,323" id="srcline323">323</a></span><span class="line">      <span class="mxinfo" id="T51:U474"><span class="var type1" id="S23T51U948">x</span> = <span class="mxinfo" id="T51:U476"><span class="var type1" id="S4T51U950">xx</span>(<span class="var type1" id="S21T51U951">v</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="132,324" id="srcline324">324</a></span><span class="line">      <span class="mxinfo" id="T51:U479"><span class="var type1" id="S41T51U954">tempa</span> = <span class="mxinfo" id="T51:U481">ones(<span class="mxinfo" id="T2:U482">length(<span class="var type1" id="S23T51U959">x</span>)</span>,1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="132,325" id="srcline325">325</a></span><span class="line">      <span class="mxinfo" id="T2:U484"><span class="var type1" id="S43T2U963">empal</span> = <span class="mxinfo" id="T2:U486">1 + <span class="var type1" id="S3T2U966">alpha</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="132,326" id="srcline326">326</a></span><span class="line">      <span class="mxinfo" id="T51:U488"><span class="var type1" id="S55T51U969">halfx</span> = <span class="mxinfo" id="T51:U490"><span class="mxinfo" id="T2:U491">0.5</span> * <span class="var type1" id="S23T51U972">x</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="132,327" id="srcline327">327</a></span><span class="line">      <span class="keyword">if</span> (<span class="var type1" id="S3T2U977">alpha</span> ~= 0),  <span class="var type0" id="S41T0U981">tempa</span> = <span class="var type0" id="S55T0U984">halfx</span>.^<span class="var type0" id="S3T0U985">alpha</span> /gamma(<span class="var type0" id="S43T0U988">empal</span>); <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,328" id="srcline328">328</a></span><span class="line">      <span class="keyword">if</span> <span class="var type1" id="S5T2U991">scale</span>, <span class="var type0" id="S41T0U994">tempa</span> = <span class="var type0" id="S41T0U996">tempa</span> .* exp(-<span class="var type0" id="S23T0U1000">x</span>); <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,329" id="srcline329">329</a></span><span class="line">      <span class="mxinfo" id="T51:U495"><span class="var type1" id="S40T51U1003">tempb</span> = <span class="mxinfo" id="T51:U497"><span class="var type1" id="S55T51U1005">halfx</span> .* <span class="var type1" id="S55T51U1006">halfx</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="132,330" id="srcline330">330</a></span><span class="line">      <span class="mxinfo" id="T51:U500"><span class="mxinfo" id="T51:U501"><span class="var type1" id="S10T51U1010">b</span>(<span class="var type1" id="S21T51U1011">v</span>,1)</span> = <span class="mxinfo" id="T51:U504"><span class="var type1" id="S41T51U1014">tempa</span> + <span class="mxinfo" id="T51:U506"><span class="mxinfo" id="T51:U507"><span class="var type1" id="S41T51U1017">tempa</span>.*<span class="var type1" id="S40T51U1018">tempb</span></span> / <span class="mxinfo" id="T2:U510"><span class="var type1" id="S43T2U1019">empal</span></span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="132,331" id="srcline331">331</a></span><span class="line">      <span class="keyword">if</span> (<span class="var type1" id="S8T2U1024">nb</span> &gt; 1)</span></span>
<span class="srcline"><span class="lineno"><a href="132,332" id="srcline332">332</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,333" id="srcline333">333</a></span><span class="line"><span class="comment">%        Calculate higher-order functions.</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,334" id="srcline334">334</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,335" id="srcline335">335</a></span><span class="line">         <span class="var type0" id="S52T0U1028">tempc</span> = <span class="var type0" id="S55T0U1029">halfx</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="132,336" id="srcline336">336</a></span><span class="line">         <span class="var type0" id="S56T0U1032">tover</span> = 8*realmin ./ <span class="var type0" id="S23T0U1038">x</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="132,337" id="srcline337">337</a></span><span class="line">         <span class="keyword">for</span> <span class="var type0" id="S32T0U1041">n</span> = 2:<span class="var type0" id="S8T0U1044">nb</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="132,338" id="srcline338">338</a></span><span class="line">            <span class="var type0" id="S41T0U1047">tempa</span> = <span class="var type0" id="S41T0U1049">tempa</span> / <span class="var type0" id="S43T0U1050">empal</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="132,339" id="srcline339">339</a></span><span class="line">            <span class="var type0" id="S43T0U1053">empal</span> = <span class="var type0" id="S43T0U1055">empal</span> + 1;</span></span>
<span class="srcline"><span class="lineno"><a href="132,340" id="srcline340">340</a></span><span class="line">            <span class="var type0" id="S41T0U1059">tempa</span> = <span class="var type0" id="S41T0U1061">tempa</span> .* <span class="var type0" id="S52T0U1062">tempc</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="132,341" id="srcline341">341</a></span><span class="line">            <span class="var type0" id="S41T0U1065">tempa</span> = <span class="var type0" id="S41T0U1067">tempa</span> .* (<span class="var type0" id="S41T0U1070">tempa</span> &gt; <span class="var type0" id="S56T0U1072">tover</span>*<span class="var type0" id="S43T0U1073">empal</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="132,342" id="srcline342">342</a></span><span class="line">            <span class="var type0" id="S10T0U1077">b</span>(<span class="var type0" id="S21T0U1078">v</span>,<span class="var type0" id="S32T0U1079">n</span>) = <span class="var type0" id="S41T0U1081">tempa</span> + <span class="var type0" id="S41T0U1084">tempa</span>.*<span class="var type0" id="S40T0U1085">tempb</span> / <span class="var type0" id="S43T0U1086">empal</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="132,343" id="srcline343">343</a></span><span class="line">         <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,344" id="srcline344">344</a></span><span class="line">      <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,345" id="srcline345">345</a></span><span class="line">   <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,346" id="srcline346">346</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,347" id="srcline347">347</a></span><span class="line"><span class="comment">%  x == 0</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,348" id="srcline348">348</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,349" id="srcline349">349</a></span><span class="line">   <span class="mxinfo" id="T51:U513"><span class="var type1" id="S21T51U1089">v</span> = <span class="mxinfo" id="T51:U515">find(<span class="mxinfo" id="T50:U516"><span class="var type1" id="S4T51U1093">xx</span> == <span class="mxinfo" id="T2:U518">0</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="132,350" id="srcline350">350</a></span><span class="line">   <span class="keyword">if</span> <span class="mxinfo" id="T4:U519">any(<span class="var type1" id="S21T51U1099">v</span>)</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,351" id="srcline351">351</a></span><span class="line">      <span class="comment">% if alpha&gt;0, I(alpha,0) = 0; I(0,0) = 1.</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,352" id="srcline352">352</a></span><span class="line">      <span class="mxinfo" id="T51:U521"><span class="mxinfo" id="T51:U522"><span class="var type1" id="S10T51U1103">b</span>(<span class="var type1" id="S21T51U1104">v</span>,:)</span> = <span class="mxinfo" id="T51:U525">zeros(<span class="mxinfo" id="T2:U526">length(<span class="var type1" id="S21T51U1110">v</span>)</span>,<span class="var type1" id="S8T2U1111">nb</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="132,353" id="srcline353">353</a></span><span class="line">      <span class="keyword">if</span> <span class="var type1" id="S3T2U1115">alpha</span> == 0, <span class="mxinfo" id="T51:U530"><span class="mxinfo" id="T51:U531"><span class="var type1" id="S10T51U1120">b</span>(<span class="var type1" id="S21T51U1121">v</span>,1)</span> = <span class="mxinfo" id="T51:U534">ones(<span class="mxinfo" id="T2:U535">length(<span class="var type1" id="S21T51U1127">v</span>)</span>,1)</span></span>; <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,354" id="srcline354">354</a></span><span class="line">   <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,355" id="srcline355">355</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,356" id="srcline356">356</a></span><span class="line"><span class="comment">%  Return the requested index range</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,357" id="srcline357">357</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,358" id="srcline358">358</a></span><span class="line">   <span class="mxinfo" id="T51:U537"><span class="var type1" id="S10T51U1131">b</span> = <span class="mxinfo" id="T51:U539"><span class="var type1" id="S10T51U1133">b</span>(:,<span class="mxinfo" id="T2:U541"><span class="var type1" id="S6T2U1137">nfirst</span>+1:<span class="var type1" id="S8T2U1139">nb</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="132,359" id="srcline359">359</a></span><span class="line"><span class="comment">%    if resize</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,360" id="srcline360">360</a></span><span class="line">   <span class="keyword">if</span> <span class="var type1" id="S18T4U1142">resize_flag</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,361" id="srcline361">361</a></span><span class="line">      <span class="mxinfo" id="T132:U545"><span class="var type1" id="S2T132U1145">output</span> = <span class="mxinfo" id="T132:U547">reshape(<span class="var type1" id="S10T51U1148">b</span>,<span class="mxinfo" id="T2:U549"><span class="var type1" id="S19T7U1150">resize</span>(<span class="mxinfo" id="T2:U551">1</span>)</span>,<span class="mxinfo" id="T2:U552"><span class="var type1" id="S19T7U1153">resize</span>(<span class="mxinfo" id="T2:U554">2</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="132,362" id="srcline362">362</a></span><span class="line">   <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,363" id="srcline363">363</a></span><span class="line">       <span class="var type0" id="S2T0U1158">output</span> = <span class="var type0" id="S10T0U1159">b</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="132,364" id="srcline364">364</a></span><span class="line">   <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="132,365" id="srcline365">365</a></span><span class="line"><span class="keyword">end</span></span></span>
</pre>
