<!-- saved from url=(0014)about:internet -->
<pre class="code">
<span class="srcline"><span class="lineno"><a href="211,1" id="srcline1">  1</a></span><span class="line"><span class="keyword">function</span>[<span class="var type1" id="S2T74U3">Pitch</span>, <span class="var type1" id="S3T74U4">Merit</span>] = refine(<span class="var type1" id="S4T118U7">TPitch1</span>, <span class="var type1" id="S5T118U8">TMerit1</span>, <span class="var type1" id="S6T118U9">TPitch2</span>, <span class="var type1" id="S7T118U10">TMerit2</span>, <span class="var type1" id="S8T1U11">SPitch</span>, <span class="var type1" id="S9T1U12">Energy</span>, <span class="var type1" id="S10T76U13">VUVEnergy</span>, <span class="mxinfo" id="T3:U10"><span class="var type2" id="S11T3V3U14">Prm</span></span>)</span></span>
<span class="srcline"><span class="lineno"><a href="211,2" id="srcline2">  2</a></span><span class="line"><span class="comment">% REFINE Refine pitch candidates for YAAPT Pitch tracking</span></span></span>
<span class="srcline"><span class="lineno"><a href="211,3" id="srcline3">  3</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="211,4" id="srcline4">  4</a></span><span class="line"><span class="comment">% [Pitch, Merit] = refine(TPitch1, TMerit1, TPitch2, TMerit2, SPitch, Energy, VUVEnergy, Prm)</span></span></span>
<span class="srcline"><span class="lineno"><a href="211,5" id="srcline5">  5</a></span><span class="line"><span class="comment">%   refins pitch cadidates obtained from NCCF using spectral pitch</span></span></span>
<span class="srcline"><span class="lineno"><a href="211,6" id="srcline6">  6</a></span><span class="line"><span class="comment">%   track and NLFER energy information.</span></span></span>
<span class="srcline"><span class="lineno"><a href="211,7" id="srcline7">  7</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="211,8" id="srcline8">  8</a></span><span class="line"><span class="comment">% INPUTS: </span></span></span>
<span class="srcline"><span class="lineno"><a href="211,9" id="srcline9">  9</a></span><span class="line"><span class="comment">%   TPitch1:  Pitch candidates array 1</span></span></span>
<span class="srcline"><span class="lineno"><a href="211,10" id="srcline10"> 10</a></span><span class="line"><span class="comment">%   TMerti1:  Merits for pitch candidates array 1</span></span></span>
<span class="srcline"><span class="lineno"><a href="211,11" id="srcline11"> 11</a></span><span class="line"><span class="comment">%   TPitch2:  Pitch candidates array 2</span></span></span>
<span class="srcline"><span class="lineno"><a href="211,12" id="srcline12"> 12</a></span><span class="line"><span class="comment">%   TMerti2:  Merits for pitch candidates array 2</span></span></span>
<span class="srcline"><span class="lineno"><a href="211,13" id="srcline13"> 13</a></span><span class="line"><span class="comment">%   SPitch:   Smoothed spectral pitch track</span></span></span>
<span class="srcline"><span class="lineno"><a href="211,14" id="srcline14"> 14</a></span><span class="line"><span class="comment">%   Energy:   NLFER Energy information</span></span></span>
<span class="srcline"><span class="lineno"><a href="211,15" id="srcline15"> 15</a></span><span class="line"><span class="comment">%   VUVEnergy: Voiced/Unvoiced information determined by NLFER energy</span></span></span>
<span class="srcline"><span class="lineno"><a href="211,16" id="srcline16"> 16</a></span><span class="line"><span class="comment">%   Prm:      Parameters</span></span></span>
<span class="srcline"><span class="lineno"><a href="211,17" id="srcline17"> 17</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="211,18" id="srcline18"> 18</a></span><span class="line"><span class="comment">% OUTPUTS:</span></span></span>
<span class="srcline"><span class="lineno"><a href="211,19" id="srcline19"> 19</a></span><span class="line"><span class="comment">%   Pitch:   Refined overall pitch candidates</span></span></span>
<span class="srcline"><span class="lineno"><a href="211,20" id="srcline20"> 20</a></span><span class="line"><span class="comment">%   Merit:   Merit for overall pitch candidates</span></span></span>
<span class="srcline"><span class="lineno"><a href="211,21" id="srcline21"> 21</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="211,22" id="srcline22"> 22</a></span><span class="line"><span class="comment">%   Creation: July 27 2007</span></span></span>
<span class="srcline"><span class="lineno"><a href="211,23" id="srcline23"> 23</a></span><span class="line"><span class="comment">%   Author:   Hongbing Hu</span></span></span>
<span class="srcline"><span class="lineno"><a href="211,24" id="srcline24"> 24</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="211,25" id="srcline25"> 25</a></span><span class="line"><span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span></span></span>
<span class="srcline"><span class="lineno"><a href="211,26" id="srcline26"> 26</a></span><span class="line"><span class="comment">%     This file is a part of the YAAPT program, designed for a fundamental </span></span></span>
<span class="srcline"><span class="lineno"><a href="211,27" id="srcline27"> 27</a></span><span class="line"><span class="comment">%   frequency tracking algorithm that is extermely robust for both high quality </span></span></span>
<span class="srcline"><span class="lineno"><a href="211,28" id="srcline28"> 28</a></span><span class="line"><span class="comment">%   and telephone speech.  </span></span></span>
<span class="srcline"><span class="lineno"><a href="211,29" id="srcline29"> 29</a></span><span class="line"><span class="comment">%     The YAAPT program was created by the Speech Communication Laboratory of</span></span></span>
<span class="srcline"><span class="lineno"><a href="211,30" id="srcline30"> 30</a></span><span class="line"><span class="comment">%   the state university of New York at Binghamton. The program is available </span></span></span>
<span class="srcline"><span class="lineno"><a href="211,31" id="srcline31"> 31</a></span><span class="line"><span class="comment">%   at http://www.ws.binghamton.edu/zahorian as free software. Further </span></span></span>
<span class="srcline"><span class="lineno"><a href="211,32" id="srcline32"> 32</a></span><span class="line"><span class="comment">%   information about the program could be found at "A spectral/temporal </span></span></span>
<span class="srcline"><span class="lineno"><a href="211,33" id="srcline33"> 33</a></span><span class="line"><span class="comment">%   method for robust fundamental frequency tracking," J.Acosut.Soc.Am. 123(6), </span></span></span>
<span class="srcline"><span class="lineno"><a href="211,34" id="srcline34"> 34</a></span><span class="line"><span class="comment">%   June 2008.</span></span></span>
<span class="srcline"><span class="lineno"><a href="211,35" id="srcline35"> 35</a></span><span class="line"><span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span></span></span>
<span class="srcline"><span class="lineno"><a href="211,36" id="srcline36"> 36</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="211,37" id="srcline37"> 37</a></span><span class="line"><span class="comment">%-- PARAMETERS ----------------------------------------------------------------</span></span></span>
<span class="srcline"><span class="lineno"><a href="211,38" id="srcline38"> 38</a></span><span class="line"><span class="comment">% Threshold for NLFER energy</span></span></span>
<span class="srcline"><span class="lineno"><a href="211,39" id="srcline39"> 39</a></span><span class="line"><span class="mxinfo" id="T2:U12"><span class="var type1" id="S12T2U17">nlfer_thresh2</span>  = <span class="mxinfo" id="T2:U14"><span class="var type1" id="S11T3U19">Prm</span>.nlfer_thresh2</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="211,40" id="srcline40"> 40</a></span><span class="line"><span class="mxinfo" id="T2:U16"><span class="var type1" id="S13T2U23">Merit_pivot</span> = <span class="mxinfo" id="T2:U18"><span class="var type1" id="S11T3U25">Prm</span>.merit_pivot</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="211,41" id="srcline41"> 41</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="211,42" id="srcline42"> 42</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="211,43" id="srcline43"> 43</a></span><span class="line"><span class="comment">%-- MAIN ROUTINE --------------------------------------------------------------</span></span></span>
<span class="srcline"><span class="lineno"><a href="211,44" id="srcline44"> 44</a></span><span class="line"><span class="comment">% Merge pitch candidates and their merits from two types of the signal</span></span></span>
<span class="srcline"><span class="lineno"><a href="211,45" id="srcline45"> 45</a></span><span class="line"><span class="mxinfo" id="T74:U20"><span class="var type1" id="S2T74U29">Pitch</span> = <span class="mxinfo" id="T74:U22">cat(1,<span class="var type1" id="S4T118U33">TPitch1</span>, <span class="var type1" id="S6T118U34">TPitch2</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="211,46" id="srcline46"> 46</a></span><span class="line"><span class="mxinfo" id="T74:U25"><span class="var type1" id="S3T74U37">Merit</span> = <span class="mxinfo" id="T74:U27">cat(1,<span class="var type1" id="S5T118U41">TMerit1</span>, <span class="var type1" id="S7T118U42">TMerit2</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="211,47" id="srcline47"> 47</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="211,48" id="srcline48"> 48</a></span><span class="line"><span class="comment">%  The rate/pitch arrays and the merit arrays are now arranged</span></span></span>
<span class="srcline"><span class="lineno"><a href="211,49" id="srcline49"> 49</a></span><span class="line"><span class="comment">%  according to the index of the sorted Merit.</span></span></span>
<span class="srcline"><span class="lineno"><a href="211,50" id="srcline50"> 50</a></span><span class="line"><span class="mxinfo" id="T2:U30">[<span class="var type1" id="S15T2U46">maxcands</span>, <span class="var type1" id="S16T2U47">numframes</span>] = size(<span class="var type1" id="S2T74U50">Pitch</span>)</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="211,51" id="srcline51"> 51</a></span><span class="line"><span class="mxinfo" id="T74:U34">[<span class="var type1" id="S3T74U54">Merit</span>, <span class="var type1" id="S18T74U55">Idx</span>] = sort(<span class="var type1" id="S3T74U58">Merit</span>, <span class="string">'descend'</span>)</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="211,52" id="srcline52"> 52</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S20T2U62">n</span>=<span class="mxinfo" id="T2:U39">1</span>:<span class="var type1" id="S16T2U65">numframes</span></span></span>
<span class="srcline"><span class="lineno"><a href="211,53" id="srcline53"> 53</a></span><span class="line">    <span class="mxinfo" id="T48:U41"><span class="mxinfo" id="T48:U42"><span class="var type1" id="S2T74U69">Pitch</span>(:,<span class="var type1" id="S20T2U71">n</span>)</span> = <span class="mxinfo" id="T48:U45"><span class="var type1" id="S2T74U73">Pitch</span>(<span class="mxinfo" id="T48:U47"><span class="var type1" id="S18T74U75">Idx</span>(:,<span class="var type1" id="S20T2U77">n</span>)</span>,<span class="var type1" id="S20T2U78">n</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="211,54" id="srcline54"> 54</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="211,55" id="srcline55"> 55</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="211,56" id="srcline56"> 56</a></span><span class="line"><span class="comment">% A best pitch track is generated from the best candidates</span></span></span>
<span class="srcline"><span class="lineno"><a href="211,57" id="srcline57"> 57</a></span><span class="line"><span class="mxinfo" id="T1:U51"><span class="var type1" id="S21T1U81">BestPitch</span> = <span class="mxinfo" id="T1:U53"><span class="mxinfo" id="T1:U54"><span class="fcn" id="F1374N7:B84">Mymedfilt1</span>(<span class="mxinfo" id="T1:U55"><span class="var type1" id="S2T74U86">Pitch</span>(<span class="mxinfo" id="T2:U57">1</span>,:)</span>, <span class="var type1" id="S11T3U90">Prm</span>.median_value)</span>.*<span class="var type1" id="S10T76U92">VUVEnergy</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="211,58" id="srcline58"> 58</a></span><span class="line"><span class="comment">% BestPitch_test = medfilt1(Pitch(1,:), Prm.median_value).*VUVEnergy;</span></span></span>
<span class="srcline"><span class="lineno"><a href="211,59" id="srcline59"> 59</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="211,60" id="srcline60"> 60</a></span><span class="line"><span class="comment">% Refine pitch candidates</span></span></span>
<span class="srcline"><span class="lineno"><a href="211,61" id="srcline61"> 61</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S23T2U95">i</span> = <span class="mxinfo" id="T2:U61">1</span>:<span class="var type1" id="S16T2U98">numframes</span></span></span>
<span class="srcline"><span class="lineno"><a href="211,62" id="srcline62"> 62</a></span><span class="line">    <span class="keyword">if</span> (<span class="mxinfo" id="T4:U63"><span class="mxinfo" id="T2:U64"><span class="var type1" id="S9T1U104">Energy</span>(<span class="var type1" id="S23T2U105">i</span>)</span>&lt;=<span class="mxinfo" id="T2:U67"><span class="var type1" id="S12T2U106">nlfer_thresh2</span></span></span>)       </span></span>
<span class="srcline"><span class="lineno"><a href="211,63" id="srcline63"> 63</a></span><span class="line">        <span class="comment">%Definitely unvoiced, all candidates will be unvoiced  with high merit</span></span></span>
<span class="srcline"><span class="lineno"><a href="211,64" id="srcline64"> 64</a></span><span class="line">        <span class="mxinfo" id="T48:U69"><span class="mxinfo" id="T48:U70"><span class="var type1" id="S2T74U110">Pitch</span>(:,<span class="var type1" id="S23T2U112">i</span>)</span> = <span class="mxinfo" id="T2:U73">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="211,65" id="srcline65"> 65</a></span><span class="line">        <span class="mxinfo" id="T48:U74"><span class="mxinfo" id="T48:U75"><span class="var type1" id="S3T74U117">Merit</span>(:,<span class="var type1" id="S23T2U119">i</span>)</span> = <span class="mxinfo" id="T2:U78"><span class="var type1" id="S13T2U120">Merit_pivot</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="211,66" id="srcline66"> 66</a></span><span class="line">    <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="211,67" id="srcline67"> 67</a></span><span class="line">        <span class="keyword">if</span> (<span class="mxinfo" id="T4:U80"><span class="mxinfo" id="T2:U81"><span class="var type1" id="S2T74U127">Pitch</span>(<span class="mxinfo" id="T2:U83">1</span>,<span class="var type1" id="S23T2U129">i</span>)</span> &gt; <span class="mxinfo" id="T2:U85">0</span></span>)       </span></span>
<span class="srcline"><span class="lineno"><a href="211,68" id="srcline68"> 68</a></span><span class="line">            <span class="comment">% already have the voiced candidate, Want to have at</span></span></span>
<span class="srcline"><span class="lineno"><a href="211,69" id="srcline69"> 69</a></span><span class="line">            <span class="comment">% least one unvoiced candidate</span></span></span>
<span class="srcline"><span class="lineno"><a href="211,70" id="srcline70"> 70</a></span><span class="line">            <span class="mxinfo" id="T2:U86"><span class="mxinfo" id="T2:U87"><span class="var type1" id="S2T74U134">Pitch</span>(<span class="var type1" id="S15T2U135">maxcands</span>,<span class="var type1" id="S23T2U136">i</span>)</span> = <span class="mxinfo" id="T2:U91">0.0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="211,71" id="srcline71"> 71</a></span><span class="line">            <span class="mxinfo" id="T2:U92"><span class="mxinfo" id="T2:U93"><span class="var type1" id="S3T74U141">Merit</span>(<span class="var type1" id="S15T2U142">maxcands</span>,<span class="var type1" id="S23T2U143">i</span>)</span> = (<span class="mxinfo" id="T2:U97"><span class="mxinfo" id="T2:U98">1</span> - <span class="mxinfo" id="T2:U99"><span class="var type1" id="S3T74U148">Merit</span>(<span class="mxinfo" id="T2:U101">1</span>,<span class="var type1" id="S23T2U150">i</span>)</span></span>)</span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="211,72" id="srcline72"> 72</a></span><span class="line">            <span class="keyword">for</span> <span class="var type1" id="S24T2U153">j</span> = <span class="mxinfo" id="T2:U104">2</span>:<span class="mxinfo" id="T2:U105"><span class="var type1" id="S15T2U157">maxcands</span>-<span class="mxinfo" id="T2:U107">1</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="211,73" id="srcline73"> 73</a></span><span class="line">                <span class="keyword">if</span> (<span class="mxinfo" id="T4:U108"><span class="mxinfo" id="T2:U109"><span class="var type1" id="S2T74U164">Pitch</span>(<span class="var type1" id="S24T2U165">j</span>,<span class="var type1" id="S23T2U166">i</span>)</span> == <span class="mxinfo" id="T2:U113">0</span></span>)</span></span>
<span class="srcline"><span class="lineno"><a href="211,74" id="srcline74"> 74</a></span><span class="line">                    <span class="mxinfo" id="T2:U114"><span class="mxinfo" id="T2:U115"><span class="var type1" id="S3T74U171">Merit</span>(<span class="var type1" id="S24T2U172">j</span>,<span class="var type1" id="S23T2U173">i</span>)</span> = <span class="mxinfo" id="T2:U119">0.0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="211,75" id="srcline75"> 75</a></span><span class="line">                <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="211,76" id="srcline76"> 76</a></span><span class="line">            <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="211,77" id="srcline77"> 77</a></span><span class="line">        <span class="keyword">else</span>                        </span></span>
<span class="srcline"><span class="lineno"><a href="211,78" id="srcline78"> 78</a></span><span class="line">            <span class="comment">% there was no voiced candidate from nccf fill in</span></span></span>
<span class="srcline"><span class="lineno"><a href="211,79" id="srcline79"> 79</a></span><span class="line">            <span class="comment">% option for F0 from spectrogram</span></span></span>
<span class="srcline"><span class="lineno"><a href="211,80" id="srcline80"> 80</a></span><span class="line">            <span class="mxinfo" id="T2:U120"><span class="mxinfo" id="T2:U121"><span class="var type1" id="S2T74U179">Pitch</span>(<span class="mxinfo" id="T2:U123">1</span>,<span class="var type1" id="S23T2U181">i</span>)</span>  = <span class="mxinfo" id="T2:U125"><span class="var type1" id="S8T1U183">SPitch</span>(<span class="var type1" id="S23T2U184">i</span>)</span></span>; </span></span>
<span class="srcline"><span class="lineno"><a href="211,81" id="srcline81"> 81</a></span><span class="line">            <span class="mxinfo" id="T2:U128"><span class="mxinfo" id="T2:U129"><span class="var type1" id="S3T74U188">Merit</span>(<span class="mxinfo" id="T2:U131">1</span>,<span class="var type1" id="S23T2U190">i</span>)</span> = <span class="mxinfo" id="T2:U133">min(<span class="mxinfo" id="T2:U134">1</span>, <span class="mxinfo" id="T2:U135"><span class="mxinfo" id="T2:U136"><span class="var type1" id="S9T1U196">Energy</span>(<span class="var type1" id="S23T2U197">i</span>)</span>/<span class="mxinfo" id="T2:U139">2</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="211,82" id="srcline82"> 82</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="211,83" id="srcline83"> 83</a></span><span class="line">            <span class="comment">% all other candidates will be unvoiced</span></span></span>
<span class="srcline"><span class="lineno"><a href="211,84" id="srcline84"> 84</a></span><span class="line">            <span class="comment">% with low merit</span></span></span>
<span class="srcline"><span class="lineno"><a href="211,85" id="srcline85"> 85</a></span><span class="line">            <span class="mxinfo" id="T48:U140"><span class="mxinfo" id="T48:U141"><span class="var type1" id="S2T74U202">Pitch</span>(<span class="mxinfo" id="T4:U143"><span class="mxinfo" id="T2:U144">2</span>:<span class="var type1" id="S15T2U205">maxcands</span></span>,<span class="var type1" id="S23T2U206">i</span>)</span> = <span class="mxinfo" id="T2:U147">0.0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="211,86" id="srcline86"> 86</a></span><span class="line">            <span class="mxinfo" id="T48:U148"><span class="mxinfo" id="T48:U149"><span class="var type1" id="S3T74U211">Merit</span>(<span class="mxinfo" id="T4:U151"><span class="mxinfo" id="T2:U152">2</span>:<span class="var type1" id="S15T2U214">maxcands</span></span>,<span class="var type1" id="S23T2U215">i</span>)</span> = <span class="mxinfo" id="T2:U155"><span class="mxinfo" id="T2:U156">1</span> - <span class="mxinfo" id="T2:U157"><span class="var type1" id="S3T74U219">Merit</span>(<span class="mxinfo" id="T2:U159">1</span>,<span class="var type1" id="S23T2U221">i</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="211,87" id="srcline87"> 87</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="211,88" id="srcline88"> 88</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="211,89" id="srcline89"> 89</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="211,90" id="srcline90"> 90</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="211,91" id="srcline91"> 91</a></span><span class="line"><span class="comment">%  Insert some good values  from the track that appears</span></span></span>
<span class="srcline"><span class="lineno"><a href="211,92" id="srcline92"> 92</a></span><span class="line"><span class="comment">%   the best, without dp, including both F0   and VUV info</span></span></span>
<span class="srcline"><span class="lineno"><a href="211,93" id="srcline93"> 93</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S23T2U224">i</span> = <span class="mxinfo" id="T2:U162">1</span>:<span class="var type1" id="S16T2U227">numframes</span></span></span>
<span class="srcline"><span class="lineno"><a href="211,94" id="srcline94"> 94</a></span><span class="line">    <span class="mxinfo" id="T2:U164"><span class="mxinfo" id="T2:U165"><span class="var type1" id="S2T74U231">Pitch</span>(<span class="mxinfo" id="T2:U167"><span class="var type1" id="S15T2U233">maxcands</span>-<span class="mxinfo" id="T2:U169">1</span></span>,<span class="var type1" id="S23T2U235">i</span>)</span> = <span class="mxinfo" id="T2:U171"><span class="var type1" id="S21T1U237">BestPitch</span>(<span class="mxinfo" id="T2:U173">1</span>,<span class="var type1" id="S23T2U239">i</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="211,95" id="srcline95"> 95</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="211,96" id="srcline96"> 96</a></span><span class="line">    <span class="comment">%  if this candidate was voiced, already have it, along with merit</span></span></span>
<span class="srcline"><span class="lineno"><a href="211,97" id="srcline97"> 97</a></span><span class="line">    <span class="comment">%  if unvoiced, need to assign appropriate merit</span></span></span>
<span class="srcline"><span class="lineno"><a href="211,98" id="srcline98"> 98</a></span><span class="line">    <span class="keyword">if</span> (<span class="mxinfo" id="T4:U175"><span class="mxinfo" id="T2:U176"><span class="var type1" id="S21T1U245">BestPitch</span>(<span class="mxinfo" id="T2:U178">1</span>,<span class="var type1" id="S23T2U247">i</span>)</span> &gt; <span class="mxinfo" id="T2:U180">0</span></span>)          <span class="comment">% voiced</span></span></span>
<span class="srcline"><span class="lineno"><a href="211,99" id="srcline99"> 99</a></span><span class="line">        <span class="mxinfo" id="T2:U181"><span class="mxinfo" id="T2:U182"><span class="var type1" id="S3T74U252">Merit</span>(<span class="mxinfo" id="T2:U184"><span class="var type1" id="S15T2U254">maxcands</span>-<span class="mxinfo" id="T2:U186">1</span></span>,<span class="var type1" id="S23T2U256">i</span>)</span> = <span class="mxinfo" id="T2:U188"><span class="var type1" id="S3T74U258">Merit</span>(<span class="mxinfo" id="T2:U190">1</span>,<span class="var type1" id="S23T2U260">i</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="211,100" id="srcline100">100</a></span><span class="line">    <span class="keyword">else</span>                                <span class="comment">% unvoiced</span></span></span>
<span class="srcline"><span class="lineno"><a href="211,101" id="srcline101">101</a></span><span class="line">        <span class="mxinfo" id="T2:U192"><span class="mxinfo" id="T2:U193"><span class="var type1" id="S3T74U265">Merit</span>(<span class="mxinfo" id="T2:U195"><span class="var type1" id="S15T2U267">maxcands</span>-<span class="mxinfo" id="T2:U197">1</span></span>,<span class="var type1" id="S23T2U269">i</span>)</span> = <span class="mxinfo" id="T2:U199"><span class="mxinfo" id="T2:U200">1</span>-<span class="mxinfo" id="T2:U201">min(<span class="mxinfo" id="T2:U202">1</span>, <span class="mxinfo" id="T2:U203"><span class="mxinfo" id="T2:U204"><span class="var type1" id="S9T1U277">Energy</span>(<span class="var type1" id="S23T2U278">i</span>)</span>/<span class="mxinfo" id="T2:U207">2</span></span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="211,102" id="srcline102">102</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="211,103" id="srcline103">103</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="211,104" id="srcline104">104</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="211,105" id="srcline105">105</a></span><span class="line"><span class="comment">%  Copy over the SPitch array</span></span></span>
<span class="srcline"><span class="lineno"><a href="211,106" id="srcline106">106</a></span><span class="line"><span class="mxinfo" id="T1:U208"><span class="mxinfo" id="T1:U209"><span class="var type1" id="S2T74U283">Pitch</span>(<span class="mxinfo" id="T2:U211"><span class="var type1" id="S15T2U285">maxcands</span>-<span class="mxinfo" id="T2:U213">2</span></span>,:)</span> = <span class="var type1" id="S8T1U288">SPitch</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="211,107" id="srcline107">107</a></span><span class="line"><span class="mxinfo" id="T1:U215"><span class="mxinfo" id="T1:U216"><span class="var type1" id="S3T74U292">Merit</span>(<span class="mxinfo" id="T2:U218"><span class="var type1" id="S15T2U294">maxcands</span>-<span class="mxinfo" id="T2:U220">2</span></span>,:)</span> = <span class="mxinfo" id="T1:U221"><span class="var type1" id="S9T1U298">Energy</span>/<span class="mxinfo" id="T2:U223">5</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="211,108" id="srcline108">108</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="211,109" id="srcline109">109</a></span><span class="line"><span class="comment">%==============================================================================</span></span></span>
</pre>
