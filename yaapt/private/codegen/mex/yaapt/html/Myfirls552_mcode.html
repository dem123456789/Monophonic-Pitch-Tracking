<!-- saved from url=(0014)about:internet -->
<pre class="code">
<span class="srcline"><span class="lineno"><a href="135,1" id="srcline1">  1</a></span><span class="line"><span class="keyword">function</span> <span class="var type1" id="S2T1U3">h</span>=Myfirls(<span class="var type1" id="S3T2U6">N</span>,<span class="var type1" id="S4T41U7">F</span>,<span class="var type2" id="S5T41V1U8">M</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="135,2" id="srcline2">  2</a></span><span class="line"><span class="comment">% FIRLS Linear-phase FIR filter design using least-squares error minimization</span></span></span>
<span class="srcline"><span class="lineno"><a href="135,3" id="srcline3">  3</a></span><span class="line"><span class="comment">%   B=FIRLS(N,F,M) returns a length N+1 linear phase (real, symmetric</span></span></span>
<span class="srcline"><span class="lineno"><a href="135,4" id="srcline4">  4</a></span><span class="line"><span class="comment">%   coefficients) FIR filter which has the best approximation to the </span></span></span>
<span class="srcline"><span class="lineno"><a href="135,5" id="srcline5">  5</a></span><span class="line"><span class="comment">%   desired frequency response described by F and M in the least squares </span></span></span>
<span class="srcline"><span class="lineno"><a href="135,6" id="srcline6">  6</a></span><span class="line"><span class="comment">%   sense. F is a vector of frequency band edges in pairs, in ascending </span></span></span>
<span class="srcline"><span class="lineno"><a href="135,7" id="srcline7">  7</a></span><span class="line"><span class="comment">%   order between 0 and 1. 1 corresponds to the Nyquist frequency or half</span></span></span>
<span class="srcline"><span class="lineno"><a href="135,8" id="srcline8">  8</a></span><span class="line"><span class="comment">%   the sampling frequency. M is a real vector the same size as F </span></span></span>
<span class="srcline"><span class="lineno"><a href="135,9" id="srcline9">  9</a></span><span class="line"><span class="comment">%   which specifies the desired magnitude of the frequency response of the</span></span></span>
<span class="srcline"><span class="lineno"><a href="135,10" id="srcline10"> 10</a></span><span class="line"><span class="comment">%   resultant filter B. The desired response is the line connecting the</span></span></span>
<span class="srcline"><span class="lineno"><a href="135,11" id="srcline11"> 11</a></span><span class="line"><span class="comment">%   points (F(k),M(k)) and (F(k+1),M(k+1)) for odd k; FIRLS treats the </span></span></span>
<span class="srcline"><span class="lineno"><a href="135,12" id="srcline12"> 12</a></span><span class="line"><span class="comment">%   bands between F(k+1) and F(k+2) for odd k as "transition bands" or </span></span></span>
<span class="srcline"><span class="lineno"><a href="135,13" id="srcline13"> 13</a></span><span class="line"><span class="comment">%   "don't care" regions. Thus the desired magnitude is piecewise linear</span></span></span>
<span class="srcline"><span class="lineno"><a href="135,14" id="srcline14"> 14</a></span><span class="line"><span class="comment">%   with transition bands.  The integrated squared error is minimized.</span></span></span>
<span class="srcline"><span class="lineno"><a href="135,15" id="srcline15"> 15</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="135,16" id="srcline16"> 16</a></span><span class="line"><span class="comment">%   B=FIRLS(N,F,M,W) uses the weights in W to weight the error. W has one</span></span></span>
<span class="srcline"><span class="lineno"><a href="135,17" id="srcline17"> 17</a></span><span class="line"><span class="comment">%   entry per band (so it is half the length of F and M) which tells</span></span></span>
<span class="srcline"><span class="lineno"><a href="135,18" id="srcline18"> 18</a></span><span class="line"><span class="comment">%   FIRLS how much emphasis to put on minimizing the integral squared error</span></span></span>
<span class="srcline"><span class="lineno"><a href="135,19" id="srcline19"> 19</a></span><span class="line"><span class="comment">%   in each band relative to the other bands.</span></span></span>
<span class="srcline"><span class="lineno"><a href="135,20" id="srcline20"> 20</a></span><span class="line"><span class="comment">%   </span></span></span>
<span class="srcline"><span class="lineno"><a href="135,21" id="srcline21"> 21</a></span><span class="line"><span class="comment">%   B=FIRLS(N,F,M,'Hilbert') and B=FIRLS(N,F,M,W,'Hilbert') design filters </span></span></span>
<span class="srcline"><span class="lineno"><a href="135,22" id="srcline22"> 22</a></span><span class="line"><span class="comment">%   that have odd symmetry, that is, B(k) = -B(N+2-k) for k = 1, <span class="keyword">...</span><span class="comment">, N+1. </span></span></span></span>
<span class="srcline"><span class="lineno"><a href="135,23" id="srcline23"> 23</a></span><span class="line"><span class="comment">%   A special case is a Hilbert transformer which has an approx. magnitude</span></span></span>
<span class="srcline"><span class="lineno"><a href="135,24" id="srcline24"> 24</a></span><span class="line"><span class="comment">%   of 1 across the entire band, e.g. B=FIRLS(30,[.1 .9],[1 1],'Hilbert'). </span></span></span>
<span class="srcline"><span class="lineno"><a href="135,25" id="srcline25"> 25</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="135,26" id="srcline26"> 26</a></span><span class="line"><span class="comment">%   B=FIRLS(N,F,M,'differentiator') and B=FIRLS(N,F,M,W,'differentiator')</span></span></span>
<span class="srcline"><span class="lineno"><a href="135,27" id="srcline27"> 27</a></span><span class="line"><span class="comment">%   also design filters with odd symmetry, but with a special weighting</span></span></span>
<span class="srcline"><span class="lineno"><a href="135,28" id="srcline28"> 28</a></span><span class="line"><span class="comment">%   scheme for non-zero magnitude bands. The weight is assumed to be equal </span></span></span>
<span class="srcline"><span class="lineno"><a href="135,29" id="srcline29"> 29</a></span><span class="line"><span class="comment">%   to the inverse of frequency, squared, times the weight W. Thus the </span></span></span>
<span class="srcline"><span class="lineno"><a href="135,30" id="srcline30"> 30</a></span><span class="line"><span class="comment">%   filter has a much better fit at low frequency than at high frequency. </span></span></span>
<span class="srcline"><span class="lineno"><a href="135,31" id="srcline31"> 31</a></span><span class="line"><span class="comment">%   This designs FIR differentiators.</span></span></span>
<span class="srcline"><span class="lineno"><a href="135,32" id="srcline32"> 32</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="135,33" id="srcline33"> 33</a></span><span class="line"><span class="comment">%   See also REMEZ, FIR1, FIR2, FREQZ and FILTER.</span></span></span>
<span class="srcline"><span class="lineno"><a href="135,34" id="srcline34"> 34</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="135,35" id="srcline35"> 35</a></span><span class="line"><span class="comment">%   Example of a length 29 low-pass filter:</span></span></span>
<span class="srcline"><span class="lineno"><a href="135,36" id="srcline36"> 36</a></span><span class="line"><span class="comment">%       h=firls(30,[0 .1 .2 .5]*2,[1 1 0 0]);</span></span></span>
<span class="srcline"><span class="lineno"><a href="135,37" id="srcline37"> 37</a></span><span class="line"><span class="comment">%   Example of a low-pass differentiator: </span></span></span>
<span class="srcline"><span class="lineno"><a href="135,38" id="srcline38"> 38</a></span><span class="line"><span class="comment">%       h=firls(N,[0 10 20 40]/50,[0 .2 0 0],'differentiator');</span></span></span>
<span class="srcline"><span class="lineno"><a href="135,39" id="srcline39"> 39</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="135,40" id="srcline40"> 40</a></span><span class="line"><span class="comment">%       Author(s): T. Krauss, 10-18-91</span></span></span>
<span class="srcline"><span class="lineno"><a href="135,41" id="srcline41"> 41</a></span><span class="line"><span class="comment">%              T. Krauss, 3-30-93, updated</span></span></span>
<span class="srcline"><span class="lineno"><a href="135,42" id="srcline42"> 42</a></span><span class="line"><span class="comment">%   Copyright (c) 1984-94 by The MathWorks, Inc.</span></span></span>
<span class="srcline"><span class="lineno"><a href="135,43" id="srcline43"> 43</a></span><span class="line"><span class="comment">%   $Revision: 1.8 $  $Date: 1994/01/25 17:59:10 $</span></span></span>
<span class="srcline"><span class="lineno"><a href="135,44" id="srcline44"> 44</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="135,45" id="srcline45"> 45</a></span><span class="line"><span class="comment">% check number of arguments, set up defaults.</span></span></span>
<span class="srcline"><span class="lineno"><a href="135,46" id="srcline46"> 46</a></span><span class="line"><span class="comment">% nargchk(3,5,nargin);</span></span></span>
<span class="srcline"><span class="lineno"><a href="135,47" id="srcline47"> 47</a></span><span class="line"><span class="comment">% if (nargin==3)</span></span></span>
<span class="srcline"><span class="lineno"><a href="135,48" id="srcline48"> 48</a></span><span class="line">    <span class="mxinfo " id="T42:U5"><span class="var type1" id="S6T42U11">W</span> = <span class="mxinfo " id="T42:U7">ones(<span class="mxinfo " id="T2:U8">length(<span class="var type1" id="S4T41U17">F</span>)/2</span>,1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="135,49" id="srcline49"> 49</a></span><span class="line"><span class="comment">%     ftype = '';</span></span></span>
<span class="srcline"><span class="lineno"><a href="135,50" id="srcline50"> 50</a></span><span class="line"><span class="comment">% end</span></span></span>
<span class="srcline"><span class="lineno"><a href="135,51" id="srcline51"> 51</a></span><span class="line"><span class="comment">% if (nargin==4),</span></span></span>
<span class="srcline"><span class="lineno"><a href="135,52" id="srcline52"> 52</a></span><span class="line"><span class="comment">%     if isstr(W), </span></span></span>
<span class="srcline"><span class="lineno"><a href="135,53" id="srcline53"> 53</a></span><span class="line"><span class="comment">%         ftype = W; W = ones(length(F)/2,1);</span></span></span>
<span class="srcline"><span class="lineno"><a href="135,54" id="srcline54"> 54</a></span><span class="line"><span class="comment">%     else</span></span></span>
<span class="srcline"><span class="lineno"><a href="135,55" id="srcline55"> 55</a></span><span class="line"><span class="comment">%         ftype = '';</span></span></span>
<span class="srcline"><span class="lineno"><a href="135,56" id="srcline56"> 56</a></span><span class="line"><span class="comment">%     end</span></span></span>
<span class="srcline"><span class="lineno"><a href="135,57" id="srcline57"> 57</a></span><span class="line"><span class="comment">% end   </span></span></span>
<span class="srcline"><span class="lineno"><a href="135,58" id="srcline58"> 58</a></span><span class="line"><span class="comment">% if (nargin==5),</span></span></span>
<span class="srcline"><span class="lineno"><a href="135,59" id="srcline59"> 59</a></span><span class="line"><span class="comment">%     if isempty(W), </span></span></span>
<span class="srcline"><span class="lineno"><a href="135,60" id="srcline60"> 60</a></span><span class="line"><span class="comment">%         W = ones(length(F)/2,1);</span></span></span>
<span class="srcline"><span class="lineno"><a href="135,61" id="srcline61"> 61</a></span><span class="line"><span class="comment">%     end</span></span></span>
<span class="srcline"><span class="lineno"><a href="135,62" id="srcline62"> 62</a></span><span class="line"><span class="comment">% end</span></span></span>
<span class="srcline"><span class="lineno"><a href="135,63" id="srcline63"> 63</a></span><span class="line"><span class="comment">% if isempty(ftype)</span></span></span>
<span class="srcline"><span class="lineno"><a href="135,64" id="srcline64"> 64</a></span><span class="line">    <span class="mxinfo " id="T2:U10"><span class="var type1" id="S9T2U22">ftype</span> = <span class="mxinfo " id="T2:U12">0</span></span>;  <span class="mxinfo " id="T2:U13"><span class="var type1" id="S10T2U26">differ</span> = <span class="mxinfo " id="T2:U15">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="135,65" id="srcline65"> 65</a></span><span class="line"><span class="comment">% else</span></span></span>
<span class="srcline"><span class="lineno"><a href="135,66" id="srcline66"> 66</a></span><span class="line"><span class="comment">%     ftype = lower(ftype);</span></span></span>
<span class="srcline"><span class="lineno"><a href="135,67" id="srcline67"> 67</a></span><span class="line"><span class="comment">%     if strcmp(ftype,'h')|strcmp(ftype,'hilbert')</span></span></span>
<span class="srcline"><span class="lineno"><a href="135,68" id="srcline68"> 68</a></span><span class="line"><span class="comment">%         ftype = 1;  differ = 0;</span></span></span>
<span class="srcline"><span class="lineno"><a href="135,69" id="srcline69"> 69</a></span><span class="line"><span class="comment">%     elseif strcmp(ftype,'d')|strcmp(ftype,'differentiator')</span></span></span>
<span class="srcline"><span class="lineno"><a href="135,70" id="srcline70"> 70</a></span><span class="line"><span class="comment">%         ftype = 1;  differ = 1;</span></span></span>
<span class="srcline"><span class="lineno"><a href="135,71" id="srcline71"> 71</a></span><span class="line"><span class="comment">%     else</span></span></span>
<span class="srcline"><span class="lineno"><a href="135,72" id="srcline72"> 72</a></span><span class="line"><span class="comment">%         error('Requires symmetry to be ''Hilbert'' or ''differentiator''.')</span></span></span>
<span class="srcline"><span class="lineno"><a href="135,73" id="srcline73"> 73</a></span><span class="line"><span class="comment">%     end</span></span></span>
<span class="srcline"><span class="lineno"><a href="135,74" id="srcline74"> 74</a></span><span class="line"><span class="comment">% end</span></span></span>
<span class="srcline"><span class="lineno"><a href="135,75" id="srcline75"> 75</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="135,76" id="srcline76"> 76</a></span><span class="line"><span class="mxinfo " id="T2:U16"><span class="var type1" id="S3T2U30">N</span> = <span class="mxinfo " id="T2:U18"><span class="var type1" id="S3T2U32">N</span>+<span class="mxinfo " id="T2:U20">1</span></span></span>;                   <span class="comment">% filter length</span></span></span>
<span class="srcline"><span class="lineno"><a href="135,77" id="srcline77"> 77</a></span><span class="line"><span class="mxinfo " id="T41:U21"><span class="var type1" id="S4T41U36">F</span>=<span class="mxinfo " id="T41:U23"><span class="mxinfo " id="T41:U24"><span class="var type1" id="S4T41U39">F</span>(:)</span>/2</span></span>;  <span class="mxinfo " id="T41:U26"><span class="var type1" id="S5T41U44">M</span>=<span class="mxinfo " id="T41:U28"><span class="var type1" id="S5T41U46">M</span>(:)</span></span>;  <span class="mxinfo " id="T42:U30"><span class="var type1" id="S6T42U50">W</span>=<span class="mxinfo " id="T42:U32">sqrt(<span class="var type1" id="S6T42U54">W</span>(:))</span></span>;  <span class="comment">% make these guys columns</span></span></span>
<span class="srcline"><span class="lineno"><a href="135,78" id="srcline78"> 78</a></span><span class="line"><span class="keyword">if</span> (<span class="mxinfo " id="T4:U34"><span class="mxinfo " id="T2:U35">rem(<span class="mxinfo " id="T2:U36">length(<span class="var type1" id="S4T41U64">F</span>)</span>,2)</span>~=<span class="mxinfo " id="T2:U38">0</span></span>)</span></span>
<span class="srcline"><span class="lineno"><a href="135,79" id="srcline79"> 79</a></span><span class="line">    error(<span class="string">'F must have even length'</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="135,80" id="srcline80"> 80</a></span><span class="line"><span class="keyword">end</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="135,81" id="srcline81"> 81</a></span><span class="line"><span class="keyword">if</span> (<span class="mxinfo " id="T4:U39"><span class="mxinfo " id="T2:U40">length(<span class="var type1" id="S4T41U77">F</span>)</span>~=<span class="mxinfo " id="T2:U42">length(<span class="var type1" id="S5T41U80">M</span>)</span></span>)</span></span>
<span class="srcline"><span class="lineno"><a href="135,82" id="srcline82"> 82</a></span><span class="line">    error(<span class="string">'F and M must be equal lengths'</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="135,83" id="srcline83"> 83</a></span><span class="line"><span class="keyword">end</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="135,84" id="srcline84"> 84</a></span><span class="line"><span class="keyword">if</span> (<span class="mxinfo " id="T4:U44"><span class="mxinfo " id="T2:U45">length(<span class="var type1" id="S4T41U91">F</span>)</span>~=<span class="mxinfo " id="T2:U47"><span class="mxinfo " id="T2:U48">length(<span class="var type1" id="S6T42U95">W</span>)</span>*<span class="mxinfo " id="T2:U50">2</span></span></span>)</span></span>
<span class="srcline"><span class="lineno"><a href="135,85" id="srcline85"> 85</a></span><span class="line">    error(<span class="string">'There should be one weight per band.'</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="135,86" id="srcline86"> 86</a></span><span class="line"><span class="keyword">end</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="135,87" id="srcline87"> 87</a></span><span class="line"><span class="keyword">if</span> <span class="mxinfo " id="T4:U51">any(<span class="mxinfo " id="T45:U52"><span class="mxinfo " id="T44:U53">diff(<span class="var type1" id="S4T41U108">F</span>)</span>&lt;<span class="mxinfo " id="T2:U55">0</span></span>)</span>,</span></span>
<span class="srcline"><span class="lineno"><a href="135,88" id="srcline88"> 88</a></span><span class="line">    error(<span class="string">'Frequencies in F must be nondecreasing.'</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="135,89" id="srcline89"> 89</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="135,90" id="srcline90"> 90</a></span><span class="line"><span class="mxinfo " id="T4:U56"><span class="keyword">if</span> <span class="mxinfo " id="T4:U57">(<span class="mxinfo " id="T4:U58"><span class="mxinfo " id="T2:U59">max(<span class="var type1" id="S4T41U121">F</span>)</span>&gt;<span class="mxinfo " id="T2:U61">1</span></span>)|(<span class="mxinfo " id="T4:U62"><span class="mxinfo " id="T2:U63">min(<span class="var type1" id="S4T41U127">F</span>)</span>&lt;<span class="mxinfo " id="T2:U65">0</span></span>)</span></span></span>
<span class="srcline"><span class="lineno"><a href="135,91" id="srcline91"> 91</a></span><span class="line">    error(<span class="string">'Frequencies in F must be in range [0,1].'</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="135,92" id="srcline92"> 92</a></span><span class="line"><span class="keyword">end</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="135,93" id="srcline93"> 93</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="135,94" id="srcline94"> 94</a></span><span class="line"><span class="mxinfo " id="T2:U66"><span class="var type1" id="S18T2U135">L</span>=<span class="mxinfo " id="T2:U68">(<span class="mxinfo " id="T2:U69"><span class="var type1" id="S3T2U139">N</span>-<span class="mxinfo " id="T2:U71">1</span></span>)/<span class="mxinfo " id="T2:U72">2</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="135,95" id="srcline95"> 95</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="135,96" id="srcline96"> 96</a></span><span class="line"><span class="keyword">if</span> (<span class="mxinfo " id="T4:U73"><span class="var type1" id="S9T2U146">ftype</span> == <span class="mxinfo " id="T2:U75">0</span></span>),  <span class="comment">% Type I and Type II linear phase FIR </span></span></span>
<span class="srcline"><span class="lineno"><a href="135,97" id="srcline97"> 97</a></span><span class="line">                  <span class="comment">% basis vectors are cos(2*pi*m*f) (see m below)</span></span></span>
<span class="srcline"><span class="lineno"><a href="135,98" id="srcline98"> 98</a></span><span class="line">    <span class="keyword">if</span> (<span class="mxinfo " id="T4:U76"><span class="mxinfo " id="T2:U77">rem(<span class="var type1" id="S3T2U154">N</span>,2)</span>==<span class="mxinfo " id="T2:U79">0</span></span>),</span></span>
<span class="srcline"><span class="lineno"><a href="135,99" id="srcline99"> 99</a></span><span class="line">        <span class="mxinfo " id="T1:U80"><span class="var type1" id="S19T1U159">m</span>=<span class="mxinfo " id="T1:U82">(<span class="mxinfo " id="T1:U83">0:<span class="var type1" id="S18T2U164">L</span></span>)+<span class="mxinfo " id="T2:U85">.5</span></span></span>;   <span class="comment">% type II</span></span></span>
<span class="srcline"><span class="lineno"><a href="135,100" id="srcline100">100</a></span><span class="line">    <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="135,101" id="srcline101">101</a></span><span class="line">        <span class="mxinfo " id="T1:U86"><span class="var type1" id="S19T1U169">m</span>=(<span class="mxinfo " id="T1:U88">0:<span class="var type1" id="S18T2U173">L</span></span>)</span>;      <span class="comment">% type I</span></span></span>
<span class="srcline"><span class="lineno"><a href="135,102" id="srcline102">102</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="135,103" id="srcline103">103</a></span><span class="line"><span class="comment">%     k=m';</span></span></span>
<span class="srcline"><span class="lineno"><a href="135,104" id="srcline104">104</a></span><span class="line">    <span class="mxinfo " id="T33:U90"><span class="var type1" id="S20T33U176">a</span>=<span class="mxinfo " id="T33:U92"><span class="var type1" id="S19T1U178">m</span>'</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="135,105" id="srcline105">105</a></span><span class="line">    <span class="mxinfo " id="T9:U94"><span class="var type1" id="S21T9U181">I1</span>=<span class="mxinfo " id="T9:U96"><span class="mxinfo " id="T9:U97"><span class="var type1" id="S20T33U184">a</span>(<span class="mxinfo " id="T57:U99">:</span>,<span class="mxinfo " id="T1:U100">ones(<span class="mxinfo " id="T2:U101">size(<span class="var type1" id="S19T1U190">m</span>)</span>)</span>)</span>+<span class="mxinfo " id="T9:U103"><span class="var type1" id="S19T1U192">m</span>(<span class="mxinfo " id="T33:U105">ones(<span class="mxinfo " id="T2:U106">size(<span class="var type1" id="S20T33U197">a</span>)</span>)</span>,<span class="mxinfo " id="T57:U108">:</span>)</span></span></span>;    <span class="comment">% entries are m + k</span></span></span>
<span class="srcline"><span class="lineno"><a href="135,106" id="srcline106">106</a></span><span class="line">    <span class="mxinfo " id="T9:U109"><span class="var type1" id="S23T9U201">I2</span>=<span class="mxinfo " id="T9:U111"><span class="mxinfo " id="T9:U112"><span class="var type1" id="S20T33U204">a</span>(<span class="mxinfo " id="T57:U114">:</span>,<span class="mxinfo " id="T1:U115">ones(<span class="mxinfo " id="T2:U116">size(<span class="var type1" id="S19T1U210">m</span>)</span>)</span>)</span>-<span class="mxinfo " id="T9:U118"><span class="var type1" id="S19T1U212">m</span>(<span class="mxinfo " id="T33:U120">ones(<span class="mxinfo " id="T2:U121">size(<span class="var type1" id="S20T33U217">a</span>)</span>)</span>,<span class="mxinfo " id="T57:U123">:</span>)</span></span></span>;    <span class="comment">% entries are m - k</span></span></span>
<span class="srcline"><span class="lineno"><a href="135,107" id="srcline107">107</a></span><span class="line">    <span class="mxinfo " id="T9:U124"><span class="var type1" id="S24T9U221">G</span>=<span class="mxinfo " id="T9:U126">zeros(<span class="mxinfo " id="T2:U127">size(<span class="var type1" id="S21T9U226">I1</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="135,108" id="srcline108">108</a></span><span class="line">    <span class="mxinfo " id="T2:U129"><span class="var type1" id="S26T2U229">b0</span>=<span class="mxinfo " id="T2:U131">0</span></span>;       <span class="comment">%  first entry must be handled separately (where k(1)=0)</span></span></span>
<span class="srcline"><span class="lineno"><a href="135,109" id="srcline109">109</a></span><span class="line">    <span class="keyword">if</span> (<span class="mxinfo " id="T4:U132"><span class="mxinfo " id="T2:U133">rem(<span class="var type1" id="S3T2U237">N</span>,2)</span>~=<span class="mxinfo " id="T2:U135">0</span></span>),</span></span>
<span class="srcline"><span class="lineno"><a href="135,110" id="srcline110">110</a></span><span class="line">        <span class="mxinfo " id="T33:U136"><span class="var type1" id="S27T33U242">k</span>=<span class="mxinfo " id="T33:U138"><span class="var type1" id="S20T33U244">a</span>(<span class="mxinfo " id="T1:U140"><span class="mxinfo " id="T2:U141">2</span>:length(<span class="var type1" id="S20T33U249">a</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="135,111" id="srcline111">111</a></span><span class="line">    <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="135,112" id="srcline112">112</a></span><span class="line">        <span class="mxinfo " id="T33:U143"><span class="var type1" id="S27T33U253">k</span>=<span class="mxinfo " id="T33:U145"><span class="var type1" id="S19T1U255">m</span>'</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="135,113" id="srcline113">113</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="135,114" id="srcline114">114</a></span><span class="line">    <span class="mxinfo " id="T33:U147"><span class="var type1" id="S28T33U258">b</span>=<span class="mxinfo " id="T33:U149">zeros(<span class="mxinfo " id="T2:U150">size(<span class="var type1" id="S27T33U263">k</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="135,115" id="srcline115">115</a></span><span class="line">    <span class="keyword">for</span> <span class="var type1" id="S29T2U266">s</span>=<span class="mxinfo " id="T2:U153">1</span>:<span class="mxinfo " id="T2:U154">2</span>:length(<span class="var type1" id="S4T41U273">F</span>),</span></span>
<span class="srcline"><span class="lineno"><a href="135,116" id="srcline116">116</a></span><span class="line">        <span class="mxinfo " id="T2:U156"><span class="var type1" id="S19T2U276">m</span>=<span class="mxinfo " id="T2:U158">(<span class="mxinfo " id="T2:U159"><span class="mxinfo " id="T2:U160"><span class="var type1" id="S5T41U281">M</span>(<span class="mxinfo " id="T2:U162"><span class="var type1" id="S29T2U283">s</span>+<span class="mxinfo " id="T2:U164">1</span></span>)</span>-<span class="mxinfo " id="T2:U165"><span class="var type1" id="S5T41U286">M</span>(<span class="var type1" id="S29T2U287">s</span>)</span></span>)/(<span class="mxinfo " id="T2:U168"><span class="mxinfo " id="T2:U169"><span class="var type1" id="S4T41U291">F</span>(<span class="mxinfo " id="T2:U171"><span class="var type1" id="S29T2U293">s</span>+<span class="mxinfo " id="T2:U173">1</span></span>)</span>-<span class="mxinfo " id="T2:U174"><span class="var type1" id="S4T41U296">F</span>(<span class="var type1" id="S29T2U297">s</span>)</span></span>)</span></span>;    <span class="comment">%  slope</span></span></span>
<span class="srcline"><span class="lineno"><a href="135,117" id="srcline117">117</a></span><span class="line">        <span class="mxinfo " id="T2:U177"><span class="var type1" id="S30T2U300">b1</span>=<span class="mxinfo " id="T2:U179"><span class="mxinfo " id="T2:U180"><span class="var type1" id="S5T41U303">M</span>(<span class="var type1" id="S29T2U304">s</span>)</span>-<span class="mxinfo " id="T2:U183"><span class="var type1" id="S19T2U306">m</span>*<span class="mxinfo " id="T2:U185"><span class="var type1" id="S4T41U308">F</span>(<span class="var type1" id="S29T2U309">s</span>)</span></span></span></span>;                   <span class="comment">%  y-intercept</span></span></span>
<span class="srcline"><span class="lineno"><a href="135,118" id="srcline118">118</a></span><span class="line">        <span class="mxinfo " id="T2:U188"><span class="var type1" id="S26T2U312">b0</span> = <span class="mxinfo " id="T2:U190"><span class="var type1" id="S26T2U314">b0</span> + <span class="mxinfo " id="T2:U192">(<span class="mxinfo " id="T2:U193"><span class="mxinfo " id="T2:U194"><span class="var type1" id="S30T2U319">b1</span>*(<span class="mxinfo " id="T2:U196"><span class="mxinfo " id="T2:U197"><span class="var type1" id="S4T41U323">F</span>(<span class="mxinfo " id="T2:U199"><span class="var type1" id="S29T2U325">s</span>+<span class="mxinfo " id="T2:U201">1</span></span>)</span>-<span class="mxinfo " id="T2:U202"><span class="var type1" id="S4T41U328">F</span>(<span class="var type1" id="S29T2U329">s</span>)</span></span>)</span> + <span class="mxinfo " id="T2:U205"><span class="mxinfo " id="T2:U206"><span class="var type1" id="S19T2U332">m</span>/<span class="mxinfo " id="T2:U208">2</span></span>*(<span class="mxinfo " id="T2:U209"><span class="mxinfo " id="T2:U210"><span class="mxinfo " id="T2:U211"><span class="var type1" id="S4T41U338">F</span>(<span class="mxinfo " id="T2:U213"><span class="var type1" id="S29T2U340">s</span>+<span class="mxinfo " id="T2:U215">1</span></span>)</span>*<span class="mxinfo " id="T2:U216"><span class="var type1" id="S4T41U343">F</span>(<span class="mxinfo " id="T2:U218"><span class="var type1" id="S29T2U345">s</span>+<span class="mxinfo " id="T2:U220">1</span></span>)</span></span>-<span class="mxinfo " id="T2:U221"><span class="mxinfo " id="T2:U222"><span class="var type1" id="S4T41U349">F</span>(<span class="var type1" id="S29T2U350">s</span>)</span>*<span class="mxinfo " id="T2:U225"><span class="var type1" id="S4T41U352">F</span>(<span class="var type1" id="S29T2U353">s</span>)</span></span></span>)</span></span>)<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="135,119" id="srcline119">119</a></span><span class="line">                     * <span class="mxinfo " id="T2:U228">abs(<span class="mxinfo " id="T2:U229"><span class="mxinfo " id="T2:U230"><span class="var type1" id="S6T42U358">W</span>(<span class="mxinfo " id="T2:U232">(<span class="mxinfo " id="T2:U233"><span class="var type1" id="S29T2U362">s</span>+<span class="mxinfo " id="T2:U235">1</span></span>)/<span class="mxinfo " id="T2:U236">2</span></span>)</span>^2</span>)</span></span></span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="135,120" id="srcline120">120</a></span><span class="line">        <span class="mxinfo " id="T33:U237"><span class="var type1" id="S28T33U368">b</span> = <span class="mxinfo " id="T33:U239"><span class="var type1" id="S28T33U370">b</span>+<span class="mxinfo " id="T33:U241">(<span class="mxinfo " id="T33:U242"><span class="mxinfo " id="T33:U243"><span class="mxinfo " id="T2:U244"><span class="var type1" id="S19T2U376">m</span>/(<span class="mxinfo " id="T2:U246">4*pi*pi</span>)</span>*(<span class="mxinfo " id="T33:U247"><span class="mxinfo " id="T33:U248">cos(<span class="mxinfo " id="T33:U249"><span class="mxinfo " id="T33:U250"><span class="mxinfo " id="T2:U251">2*pi</span>*<span class="var type1" id="S27T33U395">k</span></span>*<span class="mxinfo " id="T2:U253"><span class="var type1" id="S4T41U397">F</span>(<span class="mxinfo " id="T2:U255"><span class="var type1" id="S29T2U399">s</span>+<span class="mxinfo " id="T2:U257">1</span></span>)</span></span>)</span>-<span class="mxinfo " id="T33:U258">cos(<span class="mxinfo " id="T33:U259"><span class="mxinfo " id="T33:U260"><span class="mxinfo " id="T2:U261">2*pi</span>*<span class="var type1" id="S27T33U409">k</span></span>*<span class="mxinfo " id="T2:U263"><span class="var type1" id="S4T41U411">F</span>(<span class="var type1" id="S29T2U412">s</span>)</span></span>)</span></span>)</span>./(<span class="mxinfo " id="T33:U266"><span class="var type1" id="S27T33U415">k</span>.*<span class="var type1" id="S27T33U416">k</span></span>)</span>)<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="135,121" id="srcline121">121</a></span><span class="line">                     * <span class="mxinfo " id="T2:U269">abs(<span class="mxinfo " id="T2:U270"><span class="mxinfo " id="T2:U271"><span class="var type1" id="S6T42U421">W</span>(<span class="mxinfo " id="T2:U273">(<span class="mxinfo " id="T2:U274"><span class="var type1" id="S29T2U425">s</span>+<span class="mxinfo " id="T2:U276">1</span></span>)/<span class="mxinfo " id="T2:U277">2</span></span>)</span>^2</span>)</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="135,122" id="srcline122">122</a></span><span class="line">        <span class="mxinfo " id="T33:U278"><span class="var type1" id="S28T33U431">b</span> = <span class="mxinfo " id="T33:U280"><span class="var type1" id="S28T33U433">b</span> + <span class="mxinfo " id="T33:U282">(<span class="mxinfo " id="T33:U283"><span class="mxinfo " id="T33:U284"><span class="mxinfo " id="T2:U285"><span class="mxinfo " id="T2:U286"><span class="var type1" id="S4T41U440">F</span>(<span class="mxinfo " id="T2:U288"><span class="var type1" id="S29T2U442">s</span>+<span class="mxinfo " id="T2:U290">1</span></span>)</span>*(<span class="mxinfo " id="T2:U291"><span class="mxinfo " id="T2:U292"><span class="var type1" id="S19T2U447">m</span>*<span class="mxinfo " id="T2:U294"><span class="var type1" id="S4T41U449">F</span>(<span class="mxinfo " id="T2:U296"><span class="var type1" id="S29T2U451">s</span>+<span class="mxinfo " id="T2:U298">1</span></span>)</span></span>+<span class="var type1" id="S30T2U453">b1</span></span>)</span>*<span class="mxinfo " id="T33:U300">sinc(<span class="mxinfo " id="T33:U301"><span class="mxinfo " id="T33:U302"><span class="mxinfo " id="T2:U303">2</span>*<span class="var type1" id="S27T33U459">k</span></span>*<span class="mxinfo " id="T2:U305"><span class="var type1" id="S4T41U461">F</span>(<span class="mxinfo " id="T2:U307"><span class="var type1" id="S29T2U463">s</span>+<span class="mxinfo " id="T2:U309">1</span></span>)</span></span>)</span></span> <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="135,123" id="srcline123">123</a></span><span class="line">                   - <span class="mxinfo " id="T33:U310"><span class="mxinfo " id="T2:U311"><span class="mxinfo " id="T2:U312"><span class="var type1" id="S4T41U468">F</span>(<span class="var type1" id="S29T2U469">s</span>)</span>*(<span class="mxinfo " id="T2:U315"><span class="mxinfo " id="T2:U316"><span class="var type1" id="S19T2U473">m</span>*<span class="mxinfo " id="T2:U318"><span class="var type1" id="S4T41U475">F</span>(<span class="var type1" id="S29T2U476">s</span>)</span></span>+<span class="var type1" id="S30T2U477">b1</span></span>)</span>*<span class="mxinfo " id="T33:U322">sinc(<span class="mxinfo " id="T33:U323"><span class="mxinfo " id="T33:U324"><span class="mxinfo " id="T2:U325">2</span>*<span class="var type1" id="S27T33U483">k</span></span>*<span class="mxinfo " id="T2:U327"><span class="var type1" id="S4T41U485">F</span>(<span class="var type1" id="S29T2U486">s</span>)</span></span>)</span></span></span>) <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="135,124" id="srcline124">124</a></span><span class="line">                     * <span class="mxinfo " id="T2:U330">abs(<span class="mxinfo " id="T2:U331"><span class="mxinfo " id="T2:U332"><span class="var type1" id="S6T42U491">W</span>(<span class="mxinfo " id="T2:U334">(<span class="mxinfo " id="T2:U335"><span class="var type1" id="S29T2U495">s</span>+<span class="mxinfo " id="T2:U337">1</span></span>)/<span class="mxinfo " id="T2:U338">2</span></span>)</span>^2</span>)</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="135,125" id="srcline125">125</a></span><span class="line">        <span class="mxinfo " id="T9:U339"><span class="var type1" id="S24T9U501">G</span> = <span class="mxinfo " id="T9:U341"><span class="var type1" id="S24T9U503">G</span> + <span class="mxinfo " id="T9:U343">(<span class="mxinfo " id="T9:U344"><span class="mxinfo " id="T9:U345"><span class="mxinfo " id="T2:U346"><span class="mxinfo " id="T2:U347">.5</span>*<span class="mxinfo " id="T2:U348"><span class="var type1" id="S4T41U511">F</span>(<span class="mxinfo " id="T2:U350"><span class="var type1" id="S29T2U513">s</span>+<span class="mxinfo " id="T2:U352">1</span></span>)</span></span>*(<span class="mxinfo " id="T9:U353"><span class="mxinfo " id="T9:U354">sinc(<span class="mxinfo " id="T9:U355"><span class="mxinfo " id="T9:U356"><span class="mxinfo " id="T2:U357">2</span>*<span class="var type1" id="S21T9U522">I1</span></span>*<span class="mxinfo " id="T2:U359"><span class="var type1" id="S4T41U524">F</span>(<span class="mxinfo " id="T2:U361"><span class="var type1" id="S29T2U526">s</span>+<span class="mxinfo " id="T2:U363">1</span></span>)</span></span>)</span>+<span class="mxinfo " id="T9:U364">sinc(<span class="mxinfo " id="T9:U365"><span class="mxinfo " id="T9:U366"><span class="mxinfo " id="T2:U367">2</span>*<span class="var type1" id="S23T9U533">I2</span></span>*<span class="mxinfo " id="T2:U369"><span class="var type1" id="S4T41U535">F</span>(<span class="mxinfo " id="T2:U371"><span class="var type1" id="S29T2U537">s</span>+<span class="mxinfo " id="T2:U373">1</span></span>)</span></span>)</span></span>)</span> <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="135,126" id="srcline126">126</a></span><span class="line">               - <span class="mxinfo " id="T9:U374"><span class="mxinfo " id="T2:U375"><span class="mxinfo " id="T2:U376">.5</span>*<span class="mxinfo " id="T2:U377"><span class="var type1" id="S4T41U543">F</span>(<span class="var type1" id="S29T2U544">s</span>)</span></span>*(<span class="mxinfo " id="T9:U380"><span class="mxinfo " id="T9:U381">sinc(<span class="mxinfo " id="T9:U382"><span class="mxinfo " id="T9:U383"><span class="mxinfo " id="T2:U384">2</span>*<span class="var type1" id="S21T9U552">I1</span></span>*<span class="mxinfo " id="T2:U386"><span class="var type1" id="S4T41U554">F</span>(<span class="var type1" id="S29T2U555">s</span>)</span></span>)</span>+<span class="mxinfo " id="T9:U389">sinc(<span class="mxinfo " id="T9:U390"><span class="mxinfo " id="T9:U391"><span class="mxinfo " id="T2:U392">2</span>*<span class="var type1" id="S23T9U561">I2</span></span>*<span class="mxinfo " id="T2:U394"><span class="var type1" id="S4T41U563">F</span>(<span class="var type1" id="S29T2U564">s</span>)</span></span>)</span></span>)</span></span> ) <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="135,127" id="srcline127">127</a></span><span class="line">                     * <span class="mxinfo " id="T2:U397">abs(<span class="mxinfo " id="T2:U398"><span class="mxinfo " id="T2:U399"><span class="var type1" id="S6T42U569">W</span>(<span class="mxinfo " id="T2:U401">(<span class="mxinfo " id="T2:U402"><span class="var type1" id="S29T2U573">s</span>+<span class="mxinfo " id="T2:U404">1</span></span>)/<span class="mxinfo " id="T2:U405">2</span></span>)</span>^2</span>)</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="135,128" id="srcline128">128</a></span><span class="line">    <span class="keyword">end</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="135,129" id="srcline129">129</a></span><span class="line">    <span class="keyword">if</span> (<span class="mxinfo " id="T4:U406"><span class="mxinfo " id="T2:U407">rem(<span class="var type1" id="S3T2U583">N</span>,2)</span>~=<span class="mxinfo " id="T2:U409">0</span></span>),</span></span>
<span class="srcline"><span class="lineno"><a href="135,130" id="srcline130">130</a></span><span class="line">        <span class="mxinfo " id="T33:U410"><span class="var type1" id="S35T33U588">p</span>=<span class="mxinfo " id="T33:U412">[<span class="var type1" id="S26T2U591">b0</span>; <span class="var type1" id="S28T33U593">b</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="135,131" id="srcline131">131</a></span><span class="line">    <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="135,132" id="srcline132">132</a></span><span class="line">        <span class="mxinfo " id="T33:U415"><span class="var type1" id="S35T33U597">p</span>=<span class="var type1" id="S28T33U598">b</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="135,133" id="srcline133">133</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="135,134" id="srcline134">134</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="135,135" id="srcline135">135</a></span><span class="line">    <span class="mxinfo " id="T33:U418"><span class="var type1" id="S20T33U601">a</span>=<span class="mxinfo " id="T33:U420"><span class="var type1" id="S24T9U603">G</span>\<span class="var type1" id="S35T33U604">p</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="135,136" id="srcline136">136</a></span><span class="line">    <span class="keyword">if</span> (<span class="mxinfo " id="T4:U423"><span class="mxinfo " id="T2:U424">rem(<span class="var type1" id="S3T2U611">N</span>,2)</span>~=<span class="mxinfo " id="T2:U426">0</span></span>),</span></span>
<span class="srcline"><span class="lineno"><a href="135,137" id="srcline137">137</a></span><span class="line">        <span class="mxinfo " id="T1:U427"><span class="var type1" id="S2T1U616">h</span>=<span class="mxinfo " id="T1:U429"><span class="mxinfo " id="T33:U430">[<span class="mxinfo " id="T33:U431"><span class="mxinfo " id="T33:U432"><span class="var type1" id="S20T33U622">a</span>(<span class="mxinfo " id="T1:U434"><span class="mxinfo " id="T2:U435"><span class="var type1" id="S18T2U626">L</span>+<span class="mxinfo " id="T2:U437">1</span></span>:<span class="mxinfo " id="T2:U438">-1</span>:<span class="mxinfo " id="T2:U439">2</span></span>)</span>/2</span>; <span class="mxinfo " id="T2:U440"><span class="var type1" id="S20T33U634">a</span>(<span class="mxinfo " id="T2:U442">1</span>)</span>; <span class="mxinfo " id="T33:U443"><span class="mxinfo " id="T33:U444"><span class="var type1" id="S20T33U639">a</span>(<span class="mxinfo " id="T1:U446"><span class="mxinfo " id="T2:U447">2</span>:<span class="mxinfo " id="T2:U448"><span class="var type1" id="S18T2U643">L</span>+<span class="mxinfo " id="T2:U450">1</span></span></span>)</span>/2</span>]</span>.'</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="135,138" id="srcline138">138</a></span><span class="line">    <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="135,139" id="srcline139">139</a></span><span class="line">        <span class="mxinfo " id="T1:U451"><span class="var type1" id="S2T1U649">h</span>=<span class="mxinfo " id="T1:U453"><span class="mxinfo " id="T2:U454">.5</span>*<span class="mxinfo " id="T1:U455"><span class="mxinfo " id="T33:U456">[<span class="mxinfo " id="T33:U457">flipud(<span class="var type1" id="S20T33U657">a</span>)</span>; <span class="var type1" id="S20T33U659">a</span>]</span>.'</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="135,140" id="srcline140">140</a></span><span class="line">    <span class="keyword">end</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="135,141" id="srcline141">141</a></span><span class="line"><span class="comment">% elseif (ftype == 1),  % Type III and Type IV linear phase FIR</span></span></span>
<span class="srcline"><span class="lineno"><a href="135,142" id="srcline142">142</a></span><span class="line"><span class="comment">%                   %  basis vectors are sin(2*pi*m*f) (see m below)</span></span></span>
<span class="srcline"><span class="lineno"><a href="135,143" id="srcline143">143</a></span><span class="line"><span class="comment">%     if (differ),      % weight non-zero bands with 1/f^2</span></span></span>
<span class="srcline"><span class="lineno"><a href="135,144" id="srcline144">144</a></span><span class="line"><span class="comment">%         do_weight = ( abs(M(1:2:length(M))) +  abs(M(2:2:length(M))) ) &gt; 0;</span></span></span>
<span class="srcline"><span class="lineno"><a href="135,145" id="srcline145">145</a></span><span class="line"><span class="comment">%     else</span></span></span>
<span class="srcline"><span class="lineno"><a href="135,146" id="srcline146">146</a></span><span class="line"><span class="comment">%         do_weight = zeros(size(F));</span></span></span>
<span class="srcline"><span class="lineno"><a href="135,147" id="srcline147">147</a></span><span class="line"><span class="comment">%     end</span></span></span>
<span class="srcline"><span class="lineno"><a href="135,148" id="srcline148">148</a></span><span class="line"><span class="comment">% </span></span></span>
<span class="srcline"><span class="lineno"><a href="135,149" id="srcline149">149</a></span><span class="line"><span class="comment">%     if rem(N,2),</span></span></span>
<span class="srcline"><span class="lineno"><a href="135,150" id="srcline150">150</a></span><span class="line"><span class="comment">%         m=(1:L);      % type III</span></span></span>
<span class="srcline"><span class="lineno"><a href="135,151" id="srcline151">151</a></span><span class="line"><span class="comment">%     else</span></span></span>
<span class="srcline"><span class="lineno"><a href="135,152" id="srcline152">152</a></span><span class="line"><span class="comment">%         m=(0:L)+.5;   % type IV</span></span></span>
<span class="srcline"><span class="lineno"><a href="135,153" id="srcline153">153</a></span><span class="line"><span class="comment">%     end;</span></span></span>
<span class="srcline"><span class="lineno"><a href="135,154" id="srcline154">154</a></span><span class="line"><span class="comment">%     k=m';</span></span></span>
<span class="srcline"><span class="lineno"><a href="135,155" id="srcline155">155</a></span><span class="line"><span class="comment">%     I1=k(:,ones(size(m)))+m(ones(size(k)),:);    % entries are m + k</span></span></span>
<span class="srcline"><span class="lineno"><a href="135,156" id="srcline156">156</a></span><span class="line"><span class="comment">%     I2=k(:,ones(size(m)))-m(ones(size(k)),:);    % entries are m - k</span></span></span>
<span class="srcline"><span class="lineno"><a href="135,157" id="srcline157">157</a></span><span class="line"><span class="comment">%     b=zeros(size(k));</span></span></span>
<span class="srcline"><span class="lineno"><a href="135,158" id="srcline158">158</a></span><span class="line"><span class="comment">%     G=zeros(size(I1));</span></span></span>
<span class="srcline"><span class="lineno"><a href="135,159" id="srcline159">159</a></span><span class="line"><span class="comment">% </span></span></span>
<span class="srcline"><span class="lineno"><a href="135,160" id="srcline160">160</a></span><span class="line"><span class="comment">%     i = sqrt(-1);</span></span></span>
<span class="srcline"><span class="lineno"><a href="135,161" id="srcline161">161</a></span><span class="line"><span class="comment">%     for s=1:2:length(F),</span></span></span>
<span class="srcline"><span class="lineno"><a href="135,162" id="srcline162">162</a></span><span class="line"><span class="comment">%         if (do_weight((s+1)/2)),      % weight bands with 1/f^2</span></span></span>
<span class="srcline"><span class="lineno"><a href="135,163" id="srcline163">163</a></span><span class="line"><span class="comment">%             if F(s) == 0, F(s) = 1e-5; end     % avoid singularities</span></span></span>
<span class="srcline"><span class="lineno"><a href="135,164" id="srcline164">164</a></span><span class="line"><span class="comment">%             m=(M(s+1)-M(s))/(F(s+1)-F(s));</span></span></span>
<span class="srcline"><span class="lineno"><a href="135,165" id="srcline165">165</a></span><span class="line"><span class="comment">%             b1=M(s)-m*F(s);</span></span></span>
<span class="srcline"><span class="lineno"><a href="135,166" id="srcline166">166</a></span><span class="line"><span class="comment">%             snint1 = sineint(2*pi*k*F(s+1)) - sineint(2*pi*k*F(s));</span></span></span>
<span class="srcline"><span class="lineno"><a href="135,167" id="srcline167">167</a></span><span class="line"><span class="comment">%             %snint1 = (-1/2/i)*(expint(i*2*pi*k*F(s+1)) <span class="keyword">...</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="135,168" id="srcline168">168</a></span><span class="line"><span class="comment">%             %    -expint(-i*2*pi*k*F(s+1)) -expint(i*2*pi*k*F(s)) <span class="keyword">...</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="135,169" id="srcline169">169</a></span><span class="line"><span class="comment">%             %    +expint(-i*2*pi*k*F(s)) );</span></span></span>
<span class="srcline"><span class="lineno"><a href="135,170" id="srcline170">170</a></span><span class="line"><span class="comment">%             % csint1 = cosint(2*pi*k*F(s+1)) - cosint(2*pi*k*F(s)) ;</span></span></span>
<span class="srcline"><span class="lineno"><a href="135,171" id="srcline171">171</a></span><span class="line"><span class="comment">%             csint1 = (-1/2)*(expint(i*2*pi*k*F(s+1))+expint(-i*2*pi*k*F(s+1))<span class="keyword">...</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="135,172" id="srcline172">172</a></span><span class="line"><span class="comment">%                             -expint(i*2*pi*k*F(s))  -expint(-i*2*pi*k*F(s)) );</span></span></span>
<span class="srcline"><span class="lineno"><a href="135,173" id="srcline173">173</a></span><span class="line"><span class="comment">%             b=b + ( m*snint1 <span class="keyword">...</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="135,174" id="srcline174">174</a></span><span class="line"><span class="comment">%                 + b1*2*pi*k.*( -sinc(2*k*F(s+1)) + sinc(2*k*F(s)) + csint1 ))<span class="keyword">...</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="135,175" id="srcline175">175</a></span><span class="line"><span class="comment">%                 * abs(W((s+1)/2)^2);</span></span></span>
<span class="srcline"><span class="lineno"><a href="135,176" id="srcline176">176</a></span><span class="line"><span class="comment">%             snint1 = sineint(2*pi*F(s+1)*(-I2));</span></span></span>
<span class="srcline"><span class="lineno"><a href="135,177" id="srcline177">177</a></span><span class="line"><span class="comment">%             snint2 = sineint(2*pi*F(s+1)*I1);</span></span></span>
<span class="srcline"><span class="lineno"><a href="135,178" id="srcline178">178</a></span><span class="line"><span class="comment">%             snint3 = sineint(2*pi*F(s)*(-I2));</span></span></span>
<span class="srcline"><span class="lineno"><a href="135,179" id="srcline179">179</a></span><span class="line"><span class="comment">%             snint4 = sineint(2*pi*F(s)*I1);</span></span></span>
<span class="srcline"><span class="lineno"><a href="135,180" id="srcline180">180</a></span><span class="line"><span class="comment">%             G = G - ( ( -1/2*( cos(2*pi*F(s+1)*(-I2))/F(s+1)  <span class="keyword">...</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="135,181" id="srcline181">181</a></span><span class="line"><span class="comment">%                       - 2*snint1*pi.*I2 <span class="keyword">...</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="135,182" id="srcline182">182</a></span><span class="line"><span class="comment">%                       - cos(2*pi*F(s+1)*I1)/F(s+1) <span class="keyword">...</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="135,183" id="srcline183">183</a></span><span class="line"><span class="comment">%                       - 2*snint2*pi.*I1 )) <span class="keyword">...</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="135,184" id="srcline184">184</a></span><span class="line"><span class="comment">%                   - ( -1/2*( cos(2*pi*F(s)*(-I2))/F(s)  <span class="keyword">...</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="135,185" id="srcline185">185</a></span><span class="line"><span class="comment">%                       - 2*snint3*pi.*I2 <span class="keyword">...</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="135,186" id="srcline186">186</a></span><span class="line"><span class="comment">%                       - cos(2*pi*F(s)*I1)/F(s) <span class="keyword">...</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="135,187" id="srcline187">187</a></span><span class="line"><span class="comment">%                       - 2*snint4*pi.*I1) ) ) <span class="keyword">...</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="135,188" id="srcline188">188</a></span><span class="line"><span class="comment">%                          * abs(W((s+1)/2)^2);</span></span></span>
<span class="srcline"><span class="lineno"><a href="135,189" id="srcline189">189</a></span><span class="line"><span class="comment">%         else      % use usual weights</span></span></span>
<span class="srcline"><span class="lineno"><a href="135,190" id="srcline190">190</a></span><span class="line"><span class="comment">%             m=(M(s+1)-M(s))/(F(s+1)-F(s));</span></span></span>
<span class="srcline"><span class="lineno"><a href="135,191" id="srcline191">191</a></span><span class="line"><span class="comment">%             b1=M(s)-m*F(s);</span></span></span>
<span class="srcline"><span class="lineno"><a href="135,192" id="srcline192">192</a></span><span class="line"><span class="comment">%             b=b+(m/(4*pi*pi)*(sin(2*pi*k*F(s+1))-sin(2*pi*k*F(s)))./(k.*k))<span class="keyword">...</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="135,193" id="srcline193">193</a></span><span class="line"><span class="comment">%                          * abs(W((s+1)/2)^2) ;</span></span></span>
<span class="srcline"><span class="lineno"><a href="135,194" id="srcline194">194</a></span><span class="line"><span class="comment">%             b = b + (((m*F(s)+b1)*cos(2*pi*k*F(s)) - <span class="keyword">...</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="135,195" id="srcline195">195</a></span><span class="line"><span class="comment">%                  (m*F(s+1)+b1)*cos(2*pi*k*F(s+1)))./(2*pi*k)) <span class="keyword">...</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="135,196" id="srcline196">196</a></span><span class="line"><span class="comment">%                          * abs(W((s+1)/2)^2) ;</span></span></span>
<span class="srcline"><span class="lineno"><a href="135,197" id="srcline197">197</a></span><span class="line"><span class="comment">%             G = G + (.5*F(s+1)*(sinc(2*I1*F(s+1))-sinc(2*I2*F(s+1))) <span class="keyword">...</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="135,198" id="srcline198">198</a></span><span class="line"><span class="comment">%                - .5*F(s)*(sinc(2*I1*F(s))-sinc(2*I2*F(s)))) * abs(W((s+1)/2)^2);</span></span></span>
<span class="srcline"><span class="lineno"><a href="135,199" id="srcline199">199</a></span><span class="line"><span class="comment">%         end;</span></span></span>
<span class="srcline"><span class="lineno"><a href="135,200" id="srcline200">200</a></span><span class="line"><span class="comment">%     end</span></span></span>
<span class="srcline"><span class="lineno"><a href="135,201" id="srcline201">201</a></span><span class="line"><span class="comment">% </span></span></span>
<span class="srcline"><span class="lineno"><a href="135,202" id="srcline202">202</a></span><span class="line"><span class="comment">%     a=G\b;</span></span></span>
<span class="srcline"><span class="lineno"><a href="135,203" id="srcline203">203</a></span><span class="line"><span class="comment">%     if (rem(N,2)~=0),</span></span></span>
<span class="srcline"><span class="lineno"><a href="135,204" id="srcline204">204</a></span><span class="line"><span class="comment">%         h=.5*[flipud(a); 0; -a].';</span></span></span>
<span class="srcline"><span class="lineno"><a href="135,205" id="srcline205">205</a></span><span class="line"><span class="comment">%     else</span></span></span>
<span class="srcline"><span class="lineno"><a href="135,206" id="srcline206">206</a></span><span class="line"><span class="comment">%         h=.5*[flipud(a); -a].';</span></span></span>
<span class="srcline"><span class="lineno"><a href="135,207" id="srcline207">207</a></span><span class="line"><span class="comment">%     end</span></span></span>
<span class="srcline"><span class="lineno"><a href="135,208" id="srcline208">208</a></span><span class="line"><span class="comment">% end    </span></span></span>
<span class="srcline"><span class="lineno"><a href="135,209" id="srcline209">209</a></span><span class="line"><span class="keyword"><span class="keyword">end</span></span></span></span>
</pre>
