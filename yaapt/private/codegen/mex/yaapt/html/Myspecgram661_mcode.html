<!-- saved from url=(0014)about:internet -->
<pre class="code">
<span class="srcline"><span class="lineno"><a href="130,1" id="srcline1">  1</a></span><span class="line"><span class="keyword">function</span> [<span class="var type1" id="S2T91U3">yo</span>,<span class="var type0" id="S3T0U4">fo</span>,<span class="var type0" id="S4T0U5">to</span>] = Myspecgram(<span class="var type1" id="S5T1U8">x</span>,<span class="var type2" id="S6T2V4U9">nfft</span>,<span class="var type1" id="S7T2U10">Fs</span>,<span class="var type1" id="S8T2U11">window</span>,<span class="var type1" id="S9T2U12">noverlap</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="130,2" id="srcline2">  2</a></span><span class="line"><span class="comment">%SPECGRAM Calculate spectrogram from signal.</span></span></span>
<span class="srcline"><span class="lineno"><a href="130,3" id="srcline3">  3</a></span><span class="line"><span class="comment">%   B = SPECGRAM(A,NFFT,Fs,WINDOW,NOVERLAP) calculates the spectrogram for </span></span></span>
<span class="srcline"><span class="lineno"><a href="130,4" id="srcline4">  4</a></span><span class="line"><span class="comment">%   the signal in vector A.  SPECGRAM splits the signal into overlapping </span></span></span>
<span class="srcline"><span class="lineno"><a href="130,5" id="srcline5">  5</a></span><span class="line"><span class="comment">%   segments, windows each with the WINDOW vector and forms the columns of</span></span></span>
<span class="srcline"><span class="lineno"><a href="130,6" id="srcline6">  6</a></span><span class="line"><span class="comment">%   B with their zero-padded, length NFFT discrete Fourier transforms.  Thus</span></span></span>
<span class="srcline"><span class="lineno"><a href="130,7" id="srcline7">  7</a></span><span class="line"><span class="comment">%   each column of B contains an estimate of the short-term, time-localized</span></span></span>
<span class="srcline"><span class="lineno"><a href="130,8" id="srcline8">  8</a></span><span class="line"><span class="comment">%   frequency content of the signal A.  Time increases linearly across the </span></span></span>
<span class="srcline"><span class="lineno"><a href="130,9" id="srcline9">  9</a></span><span class="line"><span class="comment">%   columns of B, from left to right.  Frequency increases linearly down </span></span></span>
<span class="srcline"><span class="lineno"><a href="130,10" id="srcline10"> 10</a></span><span class="line"><span class="comment">%   the rows, starting at 0.  If A is a length NX complex signal, B is a </span></span></span>
<span class="srcline"><span class="lineno"><a href="130,11" id="srcline11"> 11</a></span><span class="line"><span class="comment">%   complex matrix with NFFT rows and </span></span></span>
<span class="srcline"><span class="lineno"><a href="130,12" id="srcline12"> 12</a></span><span class="line"><span class="comment">%        k = fix((NX-NOVERLAP)/(length(WINDOW)-NOVERLAP)) </span></span></span>
<span class="srcline"><span class="lineno"><a href="130,13" id="srcline13"> 13</a></span><span class="line"><span class="comment">%   columns.  If A is real, B still has k columns but the higher frequency</span></span></span>
<span class="srcline"><span class="lineno"><a href="130,14" id="srcline14"> 14</a></span><span class="line"><span class="comment">%   components are truncated (because they are redundant); in that case,</span></span></span>
<span class="srcline"><span class="lineno"><a href="130,15" id="srcline15"> 15</a></span><span class="line"><span class="comment">%   SPECGRAM returns B with NFFT/2+1 rows for NFFT even and (NFFT+1)/2 rows </span></span></span>
<span class="srcline"><span class="lineno"><a href="130,16" id="srcline16"> 16</a></span><span class="line"><span class="comment">%   for NFFT odd.  If you specify a scalar for WINDOW, SPECGRAM uses a </span></span></span>
<span class="srcline"><span class="lineno"><a href="130,17" id="srcline17"> 17</a></span><span class="line"><span class="comment">%   Hanning window of that length.  WINDOW must have length smaller than</span></span></span>
<span class="srcline"><span class="lineno"><a href="130,18" id="srcline18"> 18</a></span><span class="line"><span class="comment">%   or equal to NFFT and greater than NOVERLAP.  NOVERLAP is the number of</span></span></span>
<span class="srcline"><span class="lineno"><a href="130,19" id="srcline19"> 19</a></span><span class="line"><span class="comment">%   samples the sections of A overlap.  Fs is the sampling frequency</span></span></span>
<span class="srcline"><span class="lineno"><a href="130,20" id="srcline20"> 20</a></span><span class="line"><span class="comment">%   which does not effect the spectrogram but is used for scaling plots.</span></span></span>
<span class="srcline"><span class="lineno"><a href="130,21" id="srcline21"> 21</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="130,22" id="srcline22"> 22</a></span><span class="line"><span class="comment">%   [B,F,T] = SPECGRAM(A,NFFT,Fs,WINDOW,NOVERLAP) returns a column of </span></span></span>
<span class="srcline"><span class="lineno"><a href="130,23" id="srcline23"> 23</a></span><span class="line"><span class="comment">%   frequencies F and one of times T at which the spectrogram is computed.</span></span></span>
<span class="srcline"><span class="lineno"><a href="130,24" id="srcline24"> 24</a></span><span class="line"><span class="comment">%   F has length equal to the number of rows of B, T has length k. If you </span></span></span>
<span class="srcline"><span class="lineno"><a href="130,25" id="srcline25"> 25</a></span><span class="line"><span class="comment">%   leave Fs unspecified, SPECGRAM assumes a default of 2 Hz.</span></span></span>
<span class="srcline"><span class="lineno"><a href="130,26" id="srcline26"> 26</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="130,27" id="srcline27"> 27</a></span><span class="line"><span class="comment">%   B = SPECGRAM(A) produces the spectrogram of the signal A using default</span></span></span>
<span class="srcline"><span class="lineno"><a href="130,28" id="srcline28"> 28</a></span><span class="line"><span class="comment">%   settings; the defaults are NFFT = minimum of 256 and the length of A, a</span></span></span>
<span class="srcline"><span class="lineno"><a href="130,29" id="srcline29"> 29</a></span><span class="line"><span class="comment">%   Hanning window of length NFFT, and NOVERLAP = length(WINDOW)/2.  You </span></span></span>
<span class="srcline"><span class="lineno"><a href="130,30" id="srcline30"> 30</a></span><span class="line"><span class="comment">%   can tell SPECGRAM to use the default for any parameter by leaving it </span></span></span>
<span class="srcline"><span class="lineno"><a href="130,31" id="srcline31"> 31</a></span><span class="line"><span class="comment">%   off or using [] for that parameter, e.g. SPECGRAM(A,[],1000)</span></span></span>
<span class="srcline"><span class="lineno"><a href="130,32" id="srcline32"> 32</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="130,33" id="srcline33"> 33</a></span><span class="line"><span class="comment">%   SPECGRAM with no output arguments plots the absolute value of the </span></span></span>
<span class="srcline"><span class="lineno"><a href="130,34" id="srcline34"> 34</a></span><span class="line"><span class="comment">%   spectrogram in the current figure, using IMAGESC(T,F,20*log10(ABS(B))),</span></span></span>
<span class="srcline"><span class="lineno"><a href="130,35" id="srcline35"> 35</a></span><span class="line"><span class="comment">%   AXIS XY, COLORMAP(JET) so the low frequency content of the first </span></span></span>
<span class="srcline"><span class="lineno"><a href="130,36" id="srcline36"> 36</a></span><span class="line"><span class="comment">%   portion of the signal is displayed in the lower left corner of the axes.</span></span></span>
<span class="srcline"><span class="lineno"><a href="130,37" id="srcline37"> 37</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="130,38" id="srcline38"> 38</a></span><span class="line"><span class="comment">%   SPECGRAM(A,F,Fs,WINDOW) where F is a vector of frequencies in Hz</span></span></span>
<span class="srcline"><span class="lineno"><a href="130,39" id="srcline39"> 39</a></span><span class="line"><span class="comment">%   (with 2 or more elements) computes the spectrogram at those frequencies</span></span></span>
<span class="srcline"><span class="lineno"><a href="130,40" id="srcline40"> 40</a></span><span class="line"><span class="comment">%   using either the chirp z-transform for more than 20 evenly spaced </span></span></span>
<span class="srcline"><span class="lineno"><a href="130,41" id="srcline41"> 41</a></span><span class="line"><span class="comment">%   frequencies or a polyphase decimation filterbank.</span></span></span>
<span class="srcline"><span class="lineno"><a href="130,42" id="srcline42"> 42</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="130,43" id="srcline43"> 43</a></span><span class="line"><span class="comment">%   See also PWELCH, CSD, COHERE and TFE.</span></span></span>
<span class="srcline"><span class="lineno"><a href="130,44" id="srcline44"> 44</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="130,45" id="srcline45"> 45</a></span><span class="line"><span class="comment">%   Author(s): L. Shure, 1-1-91</span></span></span>
<span class="srcline"><span class="lineno"><a href="130,46" id="srcline46"> 46</a></span><span class="line"><span class="comment">%              T. Krauss, 4-2-93, updated</span></span></span>
<span class="srcline"><span class="lineno"><a href="130,47" id="srcline47"> 47</a></span><span class="line"><span class="comment">%   Copyright 1988-2002 The MathWorks, Inc.</span></span></span>
<span class="srcline"><span class="lineno"><a href="130,48" id="srcline48"> 48</a></span><span class="line"><span class="comment">%   $Revision: 1.8 $  $Date: 2002/03/28 17:30:53 $</span></span></span>
<span class="srcline"><span class="lineno"><a href="130,49" id="srcline49"> 49</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="130,50" id="srcline50"> 50</a></span><span class="line"><span class="comment">% error(nargchk(1,5,nargin))</span></span></span>
<span class="srcline"><span class="lineno"><a href="130,51" id="srcline51"> 51</a></span><span class="line"><span class="comment">% [msg,x,nfft,Fs,window,noverlap]=specgramchk(varargin);</span></span></span>
<span class="srcline"><span class="lineno"><a href="130,52" id="srcline52"> 52</a></span><span class="line"><span class="comment">% error(msg)</span></span></span>
<span class="srcline"><span class="lineno"><a href="130,53" id="srcline53"> 53</a></span><span class="line"><span class="mxinfo " id="T6:U7"><span class="var type1" id="S8T6U15">window</span> = <span class="mxinfo " id="T6:U9"><span class="fcn" id="F582N5:B17">Myhanning</span>(<span class="var type1" id="S8T2U18">window</span>)</span></span>;   </span></span>
<span class="srcline"><span class="lineno"><a href="130,54" id="srcline54"> 54</a></span><span class="line"><span class="comment">% window = hanning(window);</span></span></span>
<span class="srcline"><span class="lineno"><a href="130,55" id="srcline55"> 55</a></span><span class="line"><span class="mxinfo " id="T2:U11"><span class="var type1" id="S11T2U21">nx</span> = <span class="mxinfo " id="T2:U13">length(<span class="var type1" id="S5T1U24">x</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="130,56" id="srcline56"> 56</a></span><span class="line"><span class="mxinfo " id="T2:U15"><span class="var type1" id="S13T2U27">nwind</span> = <span class="mxinfo " id="T2:U17">length(<span class="var type1" id="S8T6U30">window</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="130,57" id="srcline57"> 57</a></span><span class="line"><span class="keyword">if</span> <span class="mxinfo " id="T4:U19"><span class="var type1" id="S11T2U34">nx</span> &lt; <span class="var type1" id="S13T2U35">nwind</span></span>    <span class="comment">% zero-pad x if it has length less than the window length</span></span></span>
<span class="srcline"><span class="lineno"><a href="130,58" id="srcline58"> 58</a></span><span class="line">    <span class="mxinfo " id="T2:U22"><span class="mxinfo " id="T2:U23"><span class="var type1" id="S5T1U39">x</span>(<span class="var type1" id="S13T2U40">nwind</span>)</span>=<span class="mxinfo " id="T2:U26">0</span></span>;  <span class="mxinfo " id="T2:U27"><span class="var type1" id="S11T2U44">nx</span>=<span class="var type1" id="S13T2U45">nwind</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="130,59" id="srcline59"> 59</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="130,60" id="srcline60"> 60</a></span><span class="line"><span class="mxinfo " id="T6:U30"><span class="var type1" id="S5T6U48">x</span> = <span class="mxinfo " id="T6:U32"><span class="var type1" id="S5T1U50">x</span>(:)</span></span>; <span class="comment">% make a column vector for ease later</span></span></span>
<span class="srcline"><span class="lineno"><a href="130,61" id="srcline61"> 61</a></span><span class="line"><span class="mxinfo " id="T6:U34"><span class="var type1" id="S8T6U54">window</span> = <span class="mxinfo " id="T6:U36"><span class="var type1" id="S8T6U56">window</span>(:)</span></span>; <span class="comment">% be consistent with data set</span></span></span>
<span class="srcline"><span class="lineno"><a href="130,62" id="srcline62"> 62</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="130,63" id="srcline63"> 63</a></span><span class="line"><span class="mxinfo " id="T2:U38"><span class="var type1" id="S14T2U60">ncol</span> = <span class="mxinfo " id="T2:U40">fix(<span class="mxinfo " id="T2:U41">(<span class="mxinfo " id="T2:U42"><span class="var type1" id="S11T2U66">nx</span>-<span class="var type1" id="S9T2U67">noverlap</span></span>)/(<span class="mxinfo " id="T2:U45"><span class="var type1" id="S13T2U70">nwind</span>-<span class="var type1" id="S9T2U71">noverlap</span></span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="130,64" id="srcline64"> 64</a></span><span class="line"><span class="mxinfo " id="T1:U48"><span class="var type1" id="S16T1U74">colindex</span> = <span class="mxinfo " id="T1:U50"><span class="mxinfo " id="T2:U51">1</span> + <span class="mxinfo " id="T1:U52">(<span class="mxinfo " id="T1:U53">0:(<span class="mxinfo " id="T2:U54"><span class="var type1" id="S14T2U83">ncol</span>-<span class="mxinfo " id="T2:U56">1</span></span>)</span>)*(<span class="mxinfo " id="T2:U57"><span class="var type1" id="S13T2U87">nwind</span>-<span class="var type1" id="S9T2U88">noverlap</span></span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="130,65" id="srcline65"> 65</a></span><span class="line"><span class="mxinfo " id="T6:U60"><span class="var type1" id="S17T6U91">rowindex</span> = <span class="mxinfo " id="T6:U62">(<span class="mxinfo " id="T1:U63">1:<span class="var type1" id="S13T2U96">nwind</span></span>)'</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="130,66" id="srcline66"> 66</a></span><span class="line"><span class="keyword">if</span> <span class="mxinfo " id="T4:U65"><span class="mxinfo " id="T2:U66">length(<span class="var type1" id="S5T6U102">x</span>)</span>&lt;(<span class="mxinfo " id="T2:U68"><span class="mxinfo " id="T2:U69"><span class="var type1" id="S13T2U106">nwind</span>+<span class="mxinfo " id="T2:U71"><span class="var type1" id="S16T1U108">colindex</span>(<span class="var type1" id="S14T2U109">ncol</span>)</span></span>-<span class="mxinfo " id="T2:U74">1</span></span>)</span></span></span>
<span class="srcline"><span class="lineno"><a href="130,67" id="srcline67"> 67</a></span><span class="line">    <span class="mxinfo " id="T2:U75"><span class="mxinfo " id="T2:U76"><span class="var type1" id="S5T6U114">x</span>(<span class="mxinfo " id="T2:U78"><span class="mxinfo " id="T2:U79"><span class="var type1" id="S13T2U117">nwind</span>+<span class="mxinfo " id="T2:U81"><span class="var type1" id="S16T1U119">colindex</span>(<span class="var type1" id="S14T2U120">ncol</span>)</span></span>-<span class="mxinfo " id="T2:U84">1</span></span>)</span> = <span class="mxinfo " id="T2:U85">0</span></span>;   <span class="comment">% zero-pad x</span></span></span>
<span class="srcline"><span class="lineno"><a href="130,68" id="srcline68"> 68</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="130,69" id="srcline69"> 69</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="130,70" id="srcline70"> 70</a></span><span class="line"><span class="keyword">if</span> length(<span class="var type1" id="S6T2U128">nfft</span>)&gt;1</span></span>
<span class="srcline"><span class="lineno"><a href="130,71" id="srcline71"> 71</a></span><span class="line">    <span class="var type0" id="S18T0U132">df</span> = diff(<span class="var type0" id="S6T0U135">nfft</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="130,72" id="srcline72"> 72</a></span><span class="line">    <span class="var type0" id="S20T0U138">evenly_spaced</span> = all(abs(<span class="var type0" id="S18T0U146">df</span>-<span class="var type0" id="S18T0U148">df</span>(1))/<span class="var type0" id="S7T0U150">Fs</span>&lt;1e-12);  <span class="comment">% evenly spaced flag (boolean)</span></span></span>
<span class="srcline"><span class="lineno"><a href="130,73" id="srcline73"> 73</a></span><span class="line">    <span class="var type0" id="S23T0U154">use_chirp</span> = <span class="var type0" id="S20T0U156">evenly_spaced</span> &amp; (length(<span class="var type0" id="S6T0U161">nfft</span>)&gt;20);</span></span>
<span class="srcline"><span class="lineno"><a href="130,74" id="srcline74"> 74</a></span><span class="line"><span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="130,75" id="srcline75"> 75</a></span><span class="line">    <span class="mxinfo " id="T2:U87"><span class="var type1" id="S20T2U166">evenly_spaced</span> = <span class="mxinfo " id="T2:U89">1</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="130,76" id="srcline76"> 76</a></span><span class="line">    <span class="mxinfo " id="T2:U90"><span class="var type1" id="S23T2U170">use_chirp</span> = <span class="mxinfo " id="T2:U92">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="130,77" id="srcline77"> 77</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="130,78" id="srcline78"> 78</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="130,79" id="srcline79"> 79</a></span><span class="line"><span class="keyword">if</span> (length(<span class="var type1" id="S6T2U179">nfft</span>)==1) | <span class="var type0" id="S23T0U181">use_chirp</span></span></span>
<span class="srcline"><span class="lineno"><a href="130,80" id="srcline80"> 80</a></span><span class="line">    <span class="mxinfo " id="T91:U94"><span class="var type1" id="S24T91U184">y</span> = <span class="mxinfo " id="T91:U96">complex(<span class="mxinfo " id="T8:U97">zeros(<span class="var type1" id="S13T2U189">nwind</span>,<span class="var type1" id="S14T2U190">ncol</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="130,81" id="srcline81"> 81</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="130,82" id="srcline82"> 82</a></span><span class="line">    <span class="comment">% put x into columns of y with the proper offset</span></span></span>
<span class="srcline"><span class="lineno"><a href="130,83" id="srcline83"> 83</a></span><span class="line">    <span class="comment">% should be able to do this with fancy indexing!</span></span></span>
<span class="srcline"><span class="lineno"><a href="130,84" id="srcline84"> 84</a></span><span class="line">    <span class="mxinfo " id="T91:U100"><span class="var type1" id="S24T91U194">y</span>(:) = <span class="mxinfo " id="T8:U102"><span class="var type1" id="S5T6U197">x</span>(<span class="mxinfo " id="T8:U104"><span class="mxinfo " id="T8:U105"><span class="mxinfo " id="T8:U106"><span class="var type1" id="S17T6U201">rowindex</span>(<span class="mxinfo " id="T55:U108">:</span>,<span class="mxinfo " id="T1:U109">ones(<span class="mxinfo " id="T2:U110">1</span>,<span class="var type1" id="S14T2U206">ncol</span>)</span>)</span>+<span class="mxinfo " id="T8:U112"><span class="var type1" id="S16T1U208">colindex</span>(<span class="mxinfo " id="T6:U114">ones(<span class="var type1" id="S13T2U211">nwind</span>,1)</span>,<span class="mxinfo " id="T55:U116">:</span>)</span></span>-<span class="mxinfo " id="T2:U117">1</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="130,85" id="srcline85"> 85</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="130,86" id="srcline86"> 86</a></span><span class="line">    <span class="comment">% Apply the window to the array of offset signal segments.</span></span></span>
<span class="srcline"><span class="lineno"><a href="130,87" id="srcline87"> 87</a></span><span class="line">    <span class="mxinfo " id="T91:U118"><span class="var type1" id="S24T91U217">y</span> = <span class="mxinfo " id="T91:U120"><span class="mxinfo " id="T8:U121"><span class="var type1" id="S8T6U220">window</span>(<span class="mxinfo " id="T55:U123">:</span>,<span class="mxinfo " id="T1:U124">ones(<span class="mxinfo " id="T2:U125">1</span>,<span class="var type1" id="S14T2U225">ncol</span>)</span>)</span>.*<span class="var type1" id="S24T91U226">y</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="130,88" id="srcline88"> 88</a></span><span class="line">    <span class="mxinfo " id="T16:U128"><span class="var type1" id="S28T16U229">select</span>=<span class="mxinfo " id="T16:U130">[]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="130,89" id="srcline89"> 89</a></span><span class="line">    <span class="keyword">if</span> ~<span class="var type1" id="S23T2U235">use_chirp</span>     <span class="comment">% USE FFT</span></span></span>
<span class="srcline"><span class="lineno"><a href="130,90" id="srcline90"> 90</a></span><span class="line">        <span class="comment">% now fft y which does the columns</span></span></span>
<span class="srcline"><span class="lineno"><a href="130,91" id="srcline91"> 91</a></span><span class="line">        <span class="mxinfo " id="T91:U132"><span class="var type1" id="S24T91U238">y</span> = <span class="mxinfo " id="T94:U134">fft(<span class="var type1" id="S24T91U241">y</span>,<span class="var type1" id="S6T2U242">nfft</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="130,92" id="srcline92"> 92</a></span><span class="line">        <span class="keyword">if</span> <span class="mxinfo " id="T4:U137">~<span class="mxinfo " id="T4:U138">any(<span class="mxinfo " id="T4:U139">any(<span class="mxinfo " id="T6:U140">imag(<span class="var type1" id="S5T6U252">x</span>)</span>)</span>)</span></span>    <span class="comment">% x purely real</span></span></span>
<span class="srcline"><span class="lineno"><a href="130,93" id="srcline93"> 93</a></span><span class="line">            <span class="keyword">if</span> rem(<span class="var type1" id="S6T2U257">nfft</span>,2),    <span class="comment">% nfft odd</span></span></span>
<span class="srcline"><span class="lineno"><a href="130,94" id="srcline94"> 94</a></span><span class="line">                <span class="var type0" id="S28T0U261">select</span> = 1:(<span class="var type0" id="S6T0U267">nfft</span>+1)/2;</span></span>
<span class="srcline"><span class="lineno"><a href="130,95" id="srcline95"> 95</a></span><span class="line">            <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="130,96" id="srcline96"> 96</a></span><span class="line">                <span class="mxinfo " id="T8:U143"><span class="var type1" id="S28T8U273">select</span> = <span class="mxinfo " id="T93:U145">1:<span class="var type1" id="S6T2U278">nfft</span>/2+1</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="130,97" id="srcline97"> 97</a></span><span class="line">            <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="130,98" id="srcline98"> 98</a></span><span class="line">            <span class="mxinfo " id="T91:U147"><span class="var type1" id="S24T91U283">y</span> = <span class="mxinfo " id="T91:U149"><span class="var type1" id="S24T91U285">y</span>(<span class="var type1" id="S28T8U286">select</span>,<span class="mxinfo " id="T55:U152">:</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="130,99" id="srcline99"> 99</a></span><span class="line">        <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="130,100" id="srcline100">100</a></span><span class="line">            <span class="mxinfo " id="T8:U153"><span class="var type1" id="S28T8U291">select</span> = <span class="mxinfo " id="T95:U155">1:<span class="var type1" id="S6T2U294">nfft</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="130,101" id="srcline101">101</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="130,102" id="srcline102">102</a></span><span class="line">        <span class="mxinfo " id="T8:U157"><span class="var type1" id="S33T8U297">f</span> = <span class="mxinfo " id="T8:U159"><span class="mxinfo " id="T8:U160"><span class="mxinfo " id="T8:U161">(<span class="mxinfo " id="T8:U162"><span class="var type1" id="S28T8U303">select</span> - <span class="mxinfo " id="T2:U164">1</span></span>)'</span>*<span class="var type1" id="S7T2U305">Fs</span></span>/<span class="var type1" id="S6T2U306">nfft</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="130,103" id="srcline103">103</a></span><span class="line">    <span class="keyword">else</span> <span class="comment">% USE CHIRP Z TRANSFORM</span></span></span>
<span class="srcline"><span class="lineno"><a href="130,104" id="srcline104">104</a></span><span class="line">        error(<span class="string">'has to use czt'</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="130,105" id="srcline105">105</a></span><span class="line"><span class="comment">%         f = nfft(:);</span></span></span>
<span class="srcline"><span class="lineno"><a href="130,106" id="srcline106">106</a></span><span class="line"><span class="comment">%         f1 = f(1);</span></span></span>
<span class="srcline"><span class="lineno"><a href="130,107" id="srcline107">107</a></span><span class="line"><span class="comment">%         f2 = f(end);</span></span></span>
<span class="srcline"><span class="lineno"><a href="130,108" id="srcline108">108</a></span><span class="line"><span class="comment">%         m = length(f);</span></span></span>
<span class="srcline"><span class="lineno"><a href="130,109" id="srcline109">109</a></span><span class="line"><span class="comment">%         w = exp(-j*2*pi*(f2-f1)/(m*Fs));</span></span></span>
<span class="srcline"><span class="lineno"><a href="130,110" id="srcline110">110</a></span><span class="line"><span class="comment">%         a = exp(j*2*pi*f1/Fs);</span></span></span>
<span class="srcline"><span class="lineno"><a href="130,111" id="srcline111">111</a></span><span class="line"><span class="comment">%         y = czt(y,m,w,a);</span></span></span>
<span class="srcline"><span class="lineno"><a href="130,112" id="srcline112">112</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="130,113" id="srcline113">113</a></span><span class="line"><span class="keyword">else</span>  <span class="comment">% evaluate DFT on given set of frequencies</span></span></span>
<span class="srcline"><span class="lineno"><a href="130,114" id="srcline114">114</a></span><span class="line">    <span class="var type0" id="S33T0U315">f</span> = <span class="var type0" id="S6T0U317">nfft</span>(:);</span></span>
<span class="srcline"><span class="lineno"><a href="130,115" id="srcline115">115</a></span><span class="line">    <span class="var type0" id="S35T0U321">q</span> = <span class="var type0" id="S13T0U323">nwind</span> - <span class="var type0" id="S9T0U324">noverlap</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="130,116" id="srcline116">116</a></span><span class="line">    <span class="var type0" id="S36T0U327">extras</span> = floor(<span class="var type0" id="S13T0U331">nwind</span>/<span class="var type0" id="S35T0U332">q</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="130,117" id="srcline117">117</a></span><span class="line">    <span class="var type0" id="S5T0U335">x</span> = [zeros(<span class="var type0" id="S35T0U342">q</span>-rem(<span class="var type0" id="S13T0U345">nwind</span>,<span class="var type0" id="S35T0U346">q</span>)+1,1); <span class="var type0" id="S5T0U350">x</span>];</span></span>
<span class="srcline"><span class="lineno"><a href="130,118" id="srcline118">118</a></span><span class="line">    <span class="comment">% create windowed DTFT matrix (filter bank)</span></span></span>
<span class="srcline"><span class="lineno"><a href="130,119" id="srcline119">119</a></span><span class="line">    <span class="var type0" id="S38T0U353">D</span> = <span class="var type0" id="S8T0U356">window</span>(:,ones(1,length(<span class="var type0" id="S33T0U363">f</span>))).*exp((-j*2*pi/<span class="var type0" id="S7T0U379">Fs</span>*((<span class="var type0" id="S13T0U385">nwind</span>-1):-1:0)).'*<span class="var type0" id="S33T0U391">f</span>'); </span></span>
<span class="srcline"><span class="lineno"><a href="130,120" id="srcline120">120</a></span><span class="line">    <span class="var type0" id="S24T0U394">y</span> = upfirdn(<span class="var type0" id="S5T0U398">x</span>,<span class="var type0" id="S38T0U399">D</span>,1,<span class="var type0" id="S35T0U401">q</span>).';</span></span>
<span class="srcline"><span class="lineno"><a href="130,121" id="srcline121">121</a></span><span class="line">    <span class="var type0" id="S24T0U405">y</span>(:,[1:<span class="var type0" id="S36T0U412">extras</span>+1 end-<span class="var type0" id="S36T0U419">extras</span>+1:end]) = []; </span></span>
<span class="srcline"><span class="lineno"><a href="130,122" id="srcline122">122</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="130,123" id="srcline123">123</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="130,124" id="srcline124">124</a></span><span class="line"><span class="mxinfo " id="T6:U167"><span class="var type1" id="S44T6U427">t</span> = <span class="mxinfo " id="T6:U169"><span class="mxinfo " id="T6:U170">(<span class="mxinfo " id="T1:U171"><span class="var type1" id="S16T1U432">colindex</span>-<span class="mxinfo " id="T2:U173">1</span></span>)'</span>/<span class="var type1" id="S7T2U434">Fs</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="130,125" id="srcline125">125</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="130,126" id="srcline126">126</a></span><span class="line"><span class="comment">% take abs, and use image to display results</span></span></span>
<span class="srcline"><span class="lineno"><a href="130,127" id="srcline127">127</a></span><span class="line"><span class="comment">% if nargout == 0</span></span></span>
<span class="srcline"><span class="lineno"><a href="130,128" id="srcline128">128</a></span><span class="line"><span class="comment">%     newplot;</span></span></span>
<span class="srcline"><span class="lineno"><a href="130,129" id="srcline129">129</a></span><span class="line"><span class="comment">%     if length(t)==1</span></span></span>
<span class="srcline"><span class="lineno"><a href="130,130" id="srcline130">130</a></span><span class="line"><span class="comment">%         imagesc([0 1/f(2)],f,20*log10(abs(y)+eps));axis xy; colormap(jet)</span></span></span>
<span class="srcline"><span class="lineno"><a href="130,131" id="srcline131">131</a></span><span class="line"><span class="comment">%     else</span></span></span>
<span class="srcline"><span class="lineno"><a href="130,132" id="srcline132">132</a></span><span class="line"><span class="comment">%         imagesc(t,f,20*log10(abs(y)+eps));axis xy; colormap(jet)</span></span></span>
<span class="srcline"><span class="lineno"><a href="130,133" id="srcline133">133</a></span><span class="line"><span class="comment">%     end</span></span></span>
<span class="srcline"><span class="lineno"><a href="130,134" id="srcline134">134</a></span><span class="line"><span class="comment">%     xlabel('Time')</span></span></span>
<span class="srcline"><span class="lineno"><a href="130,135" id="srcline135">135</a></span><span class="line"><span class="comment">%     ylabel('Frequency')</span></span></span>
<span class="srcline"><span class="lineno"><a href="130,136" id="srcline136">136</a></span><span class="line"><span class="keyword">if</span> nargout == 1,</span></span>
<span class="srcline"><span class="lineno"><a href="130,137" id="srcline137">137</a></span><span class="line">    <span class="mxinfo " id="T91:U175"><span class="var type1" id="S2T91U443">yo</span> = <span class="var type1" id="S24T91U444">y</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="130,138" id="srcline138">138</a></span><span class="line"><span class="keyword">elseif</span> nargout == 2,</span></span>
<span class="srcline"><span class="lineno"><a href="130,139" id="srcline139">139</a></span><span class="line">    <span class="var type0" id="S2T0U452">yo</span> = <span class="var type0" id="S24T0U453">y</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="130,140" id="srcline140">140</a></span><span class="line">    <span class="var type0" id="S3T0U456">fo</span> = <span class="var type0" id="S33T0U457">f</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="130,141" id="srcline141">141</a></span><span class="line"><span class="keyword">elseif</span> nargout == 3,</span></span>
<span class="srcline"><span class="lineno"><a href="130,142" id="srcline142">142</a></span><span class="line">    <span class="var type0" id="S2T0U465">yo</span> = <span class="var type0" id="S24T0U466">y</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="130,143" id="srcline143">143</a></span><span class="line">    <span class="var type0" id="S3T0U469">fo</span> = <span class="var type0" id="S33T0U470">f</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="130,144" id="srcline144">144</a></span><span class="line">    <span class="var type0" id="S4T0U473">to</span> = <span class="var type0" id="S44T0U474">t</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="130,145" id="srcline145">145</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="130,146" id="srcline146">146</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="130,147" id="srcline147">147</a></span><span class="line"><span class="comment">% function [msg,x,nfft,Fs,window,noverlap] = specgramchk(P)</span></span></span>
<span class="srcline"><span class="lineno"><a href="130,148" id="srcline148">148</a></span><span class="line"><span class="comment">% %SPECGRAMCHK Helper function for SPECGRAM.</span></span></span>
<span class="srcline"><span class="lineno"><a href="130,149" id="srcline149">149</a></span><span class="line"><span class="comment">% %   SPECGRAMCHK(P) takes the cell array P and uses each cell as </span></span></span>
<span class="srcline"><span class="lineno"><a href="130,150" id="srcline150">150</a></span><span class="line"><span class="comment">% %   an input argument.  Assumes P has between 1 and 5 elements.</span></span></span>
<span class="srcline"><span class="lineno"><a href="130,151" id="srcline151">151</a></span><span class="line"><span class="comment">% </span></span></span>
<span class="srcline"><span class="lineno"><a href="130,152" id="srcline152">152</a></span><span class="line"><span class="comment">% msg = [];</span></span></span>
<span class="srcline"><span class="lineno"><a href="130,153" id="srcline153">153</a></span><span class="line"><span class="comment">% </span></span></span>
<span class="srcline"><span class="lineno"><a href="130,154" id="srcline154">154</a></span><span class="line"><span class="comment">% x = P{1}; </span></span></span>
<span class="srcline"><span class="lineno"><a href="130,155" id="srcline155">155</a></span><span class="line"><span class="comment">% if (length(P) &gt; 1) &amp; ~isempty(P{2})</span></span></span>
<span class="srcline"><span class="lineno"><a href="130,156" id="srcline156">156</a></span><span class="line"><span class="comment">%     nfft = P{2};</span></span></span>
<span class="srcline"><span class="lineno"><a href="130,157" id="srcline157">157</a></span><span class="line"><span class="comment">% else</span></span></span>
<span class="srcline"><span class="lineno"><a href="130,158" id="srcline158">158</a></span><span class="line"><span class="comment">%     nfft = min(length(x),256);</span></span></span>
<span class="srcline"><span class="lineno"><a href="130,159" id="srcline159">159</a></span><span class="line"><span class="comment">% end</span></span></span>
<span class="srcline"><span class="lineno"><a href="130,160" id="srcline160">160</a></span><span class="line"><span class="comment">% if (length(P) &gt; 2) &amp; ~isempty(P{3})</span></span></span>
<span class="srcline"><span class="lineno"><a href="130,161" id="srcline161">161</a></span><span class="line"><span class="comment">%     Fs = P{3};</span></span></span>
<span class="srcline"><span class="lineno"><a href="130,162" id="srcline162">162</a></span><span class="line"><span class="comment">% else</span></span></span>
<span class="srcline"><span class="lineno"><a href="130,163" id="srcline163">163</a></span><span class="line"><span class="comment">%     Fs = 2;</span></span></span>
<span class="srcline"><span class="lineno"><a href="130,164" id="srcline164">164</a></span><span class="line"><span class="comment">% end</span></span></span>
<span class="srcline"><span class="lineno"><a href="130,165" id="srcline165">165</a></span><span class="line"><span class="comment">% if length(P) &gt; 3 &amp; ~isempty(P{4})</span></span></span>
<span class="srcline"><span class="lineno"><a href="130,166" id="srcline166">166</a></span><span class="line"><span class="comment">%     window = P{4}; </span></span></span>
<span class="srcline"><span class="lineno"><a href="130,167" id="srcline167">167</a></span><span class="line"><span class="comment">% else</span></span></span>
<span class="srcline"><span class="lineno"><a href="130,168" id="srcline168">168</a></span><span class="line"><span class="comment">%     if length(nfft) == 1</span></span></span>
<span class="srcline"><span class="lineno"><a href="130,169" id="srcline169">169</a></span><span class="line"><span class="comment">%         window = hanning(nfft);</span></span></span>
<span class="srcline"><span class="lineno"><a href="130,170" id="srcline170">170</a></span><span class="line"><span class="comment">%     else</span></span></span>
<span class="srcline"><span class="lineno"><a href="130,171" id="srcline171">171</a></span><span class="line"><span class="comment">%         msg = 'You must specify a window function.';</span></span></span>
<span class="srcline"><span class="lineno"><a href="130,172" id="srcline172">172</a></span><span class="line"><span class="comment">%     end</span></span></span>
<span class="srcline"><span class="lineno"><a href="130,173" id="srcline173">173</a></span><span class="line"><span class="comment">% end</span></span></span>
<span class="srcline"><span class="lineno"><a href="130,174" id="srcline174">174</a></span><span class="line"><span class="comment">% if length(window) == 1, window = hanning(window); end</span></span></span>
<span class="srcline"><span class="lineno"><a href="130,175" id="srcline175">175</a></span><span class="line"><span class="comment">% if (length(P) &gt; 4) &amp; ~isempty(P{5})</span></span></span>
<span class="srcline"><span class="lineno"><a href="130,176" id="srcline176">176</a></span><span class="line"><span class="comment">%     noverlap = P{5};</span></span></span>
<span class="srcline"><span class="lineno"><a href="130,177" id="srcline177">177</a></span><span class="line"><span class="comment">% else</span></span></span>
<span class="srcline"><span class="lineno"><a href="130,178" id="srcline178">178</a></span><span class="line"><span class="comment">%     noverlap = ceil(length(window)/2);</span></span></span>
<span class="srcline"><span class="lineno"><a href="130,179" id="srcline179">179</a></span><span class="line"><span class="comment">% end</span></span></span>
<span class="srcline"><span class="lineno"><a href="130,180" id="srcline180">180</a></span><span class="line"><span class="comment">% </span></span></span>
<span class="srcline"><span class="lineno"><a href="130,181" id="srcline181">181</a></span><span class="line"><span class="comment">% % NOW do error checking</span></span></span>
<span class="srcline"><span class="lineno"><a href="130,182" id="srcline182">182</a></span><span class="line"><span class="comment">% if (length(nfft)==1) &amp; (nfft&lt;length(window)), </span></span></span>
<span class="srcline"><span class="lineno"><a href="130,183" id="srcline183">183</a></span><span class="line"><span class="comment">%     msg = 'Requires window''s length to be no greater than the FFT length.';</span></span></span>
<span class="srcline"><span class="lineno"><a href="130,184" id="srcline184">184</a></span><span class="line"><span class="comment">% end</span></span></span>
<span class="srcline"><span class="lineno"><a href="130,185" id="srcline185">185</a></span><span class="line"><span class="comment">% if (noverlap &gt;= length(window)),</span></span></span>
<span class="srcline"><span class="lineno"><a href="130,186" id="srcline186">186</a></span><span class="line"><span class="comment">%     msg = 'Requires NOVERLAP to be strictly less than the window length.';</span></span></span>
<span class="srcline"><span class="lineno"><a href="130,187" id="srcline187">187</a></span><span class="line"><span class="comment">% end</span></span></span>
<span class="srcline"><span class="lineno"><a href="130,188" id="srcline188">188</a></span><span class="line"><span class="comment">% if (length(nfft)==1) &amp; (nfft ~= abs(round(nfft)))</span></span></span>
<span class="srcline"><span class="lineno"><a href="130,189" id="srcline189">189</a></span><span class="line"><span class="comment">%     msg = 'Requires positive integer values for NFFT.';</span></span></span>
<span class="srcline"><span class="lineno"><a href="130,190" id="srcline190">190</a></span><span class="line"><span class="comment">% end</span></span></span>
<span class="srcline"><span class="lineno"><a href="130,191" id="srcline191">191</a></span><span class="line"><span class="comment">% if (noverlap ~= abs(round(noverlap))),</span></span></span>
<span class="srcline"><span class="lineno"><a href="130,192" id="srcline192">192</a></span><span class="line"><span class="comment">%     msg = 'Requires positive integer value for NOVERLAP.';</span></span></span>
<span class="srcline"><span class="lineno"><a href="130,193" id="srcline193">193</a></span><span class="line"><span class="comment">% end</span></span></span>
<span class="srcline"><span class="lineno"><a href="130,194" id="srcline194">194</a></span><span class="line"><span class="comment">% if min(size(x))~=1,</span></span></span>
<span class="srcline"><span class="lineno"><a href="130,195" id="srcline195">195</a></span><span class="line"><span class="comment">%     msg = 'Requires vector (either row or column) input.';</span></span></span>
<span class="srcline"><span class="lineno"><a href="130,196" id="srcline196">196</a></span><span class="line"><span class="comment">% end</span></span></span>
<span class="srcline"><span class="lineno"><a href="130,197" id="srcline197">197</a></span><span class="line"><span class="comment">% end</span></span></span>
<span class="srcline"><span class="lineno"><a href="130,198" id="srcline198">198</a></span><span class="line"><span class="keyword">end</span></span></span>
</pre>
