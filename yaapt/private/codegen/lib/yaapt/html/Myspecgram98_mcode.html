<!-- saved from url=(0014)about:internet -->
<pre class="code">
<span class="srcline"><span class="lineno"><a href="44,1" id="srcline1">  1</a></span><span class="line"><span class="keyword">function</span> [<span class="var type1" id="S2T35U3">yo</span>,<span class="var type0" id="S3T0U4">fo</span>,<span class="var type0" id="S4T0U5">to</span>] = Myspecgram(<span class="var type1" id="S5T25U8">varargin</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="44,2" id="srcline2">  2</a></span><span class="line"><span class="comment">%SPECGRAM Calculate spectrogram from signal.</span></span></span>
<span class="srcline"><span class="lineno"><a href="44,3" id="srcline3">  3</a></span><span class="line"><span class="comment">%   B = SPECGRAM(A,NFFT,Fs,WINDOW,NOVERLAP) calculates the spectrogram for </span></span></span>
<span class="srcline"><span class="lineno"><a href="44,4" id="srcline4">  4</a></span><span class="line"><span class="comment">%   the signal in vector A.  SPECGRAM splits the signal into overlapping </span></span></span>
<span class="srcline"><span class="lineno"><a href="44,5" id="srcline5">  5</a></span><span class="line"><span class="comment">%   segments, windows each with the WINDOW vector and forms the columns of</span></span></span>
<span class="srcline"><span class="lineno"><a href="44,6" id="srcline6">  6</a></span><span class="line"><span class="comment">%   B with their zero-padded, length NFFT discrete Fourier transforms.  Thus</span></span></span>
<span class="srcline"><span class="lineno"><a href="44,7" id="srcline7">  7</a></span><span class="line"><span class="comment">%   each column of B contains an estimate of the short-term, time-localized</span></span></span>
<span class="srcline"><span class="lineno"><a href="44,8" id="srcline8">  8</a></span><span class="line"><span class="comment">%   frequency content of the signal A.  Time increases linearly across the </span></span></span>
<span class="srcline"><span class="lineno"><a href="44,9" id="srcline9">  9</a></span><span class="line"><span class="comment">%   columns of B, from left to right.  Frequency increases linearly down </span></span></span>
<span class="srcline"><span class="lineno"><a href="44,10" id="srcline10"> 10</a></span><span class="line"><span class="comment">%   the rows, starting at 0.  If A is a length NX complex signal, B is a </span></span></span>
<span class="srcline"><span class="lineno"><a href="44,11" id="srcline11"> 11</a></span><span class="line"><span class="comment">%   complex matrix with NFFT rows and </span></span></span>
<span class="srcline"><span class="lineno"><a href="44,12" id="srcline12"> 12</a></span><span class="line"><span class="comment">%        k = fix((NX-NOVERLAP)/(length(WINDOW)-NOVERLAP)) </span></span></span>
<span class="srcline"><span class="lineno"><a href="44,13" id="srcline13"> 13</a></span><span class="line"><span class="comment">%   columns.  If A is real, B still has k columns but the higher frequency</span></span></span>
<span class="srcline"><span class="lineno"><a href="44,14" id="srcline14"> 14</a></span><span class="line"><span class="comment">%   components are truncated (because they are redundant); in that case,</span></span></span>
<span class="srcline"><span class="lineno"><a href="44,15" id="srcline15"> 15</a></span><span class="line"><span class="comment">%   SPECGRAM returns B with NFFT/2+1 rows for NFFT even and (NFFT+1)/2 rows </span></span></span>
<span class="srcline"><span class="lineno"><a href="44,16" id="srcline16"> 16</a></span><span class="line"><span class="comment">%   for NFFT odd.  If you specify a scalar for WINDOW, SPECGRAM uses a </span></span></span>
<span class="srcline"><span class="lineno"><a href="44,17" id="srcline17"> 17</a></span><span class="line"><span class="comment">%   Hanning window of that length.  WINDOW must have length smaller than</span></span></span>
<span class="srcline"><span class="lineno"><a href="44,18" id="srcline18"> 18</a></span><span class="line"><span class="comment">%   or equal to NFFT and greater than NOVERLAP.  NOVERLAP is the number of</span></span></span>
<span class="srcline"><span class="lineno"><a href="44,19" id="srcline19"> 19</a></span><span class="line"><span class="comment">%   samples the sections of A overlap.  Fs is the sampling frequency</span></span></span>
<span class="srcline"><span class="lineno"><a href="44,20" id="srcline20"> 20</a></span><span class="line"><span class="comment">%   which does not effect the spectrogram but is used for scaling plots.</span></span></span>
<span class="srcline"><span class="lineno"><a href="44,21" id="srcline21"> 21</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="44,22" id="srcline22"> 22</a></span><span class="line"><span class="comment">%   [B,F,T] = SPECGRAM(A,NFFT,Fs,WINDOW,NOVERLAP) returns a column of </span></span></span>
<span class="srcline"><span class="lineno"><a href="44,23" id="srcline23"> 23</a></span><span class="line"><span class="comment">%   frequencies F and one of times T at which the spectrogram is computed.</span></span></span>
<span class="srcline"><span class="lineno"><a href="44,24" id="srcline24"> 24</a></span><span class="line"><span class="comment">%   F has length equal to the number of rows of B, T has length k. If you </span></span></span>
<span class="srcline"><span class="lineno"><a href="44,25" id="srcline25"> 25</a></span><span class="line"><span class="comment">%   leave Fs unspecified, SPECGRAM assumes a default of 2 Hz.</span></span></span>
<span class="srcline"><span class="lineno"><a href="44,26" id="srcline26"> 26</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="44,27" id="srcline27"> 27</a></span><span class="line"><span class="comment">%   B = SPECGRAM(A) produces the spectrogram of the signal A using default</span></span></span>
<span class="srcline"><span class="lineno"><a href="44,28" id="srcline28"> 28</a></span><span class="line"><span class="comment">%   settings; the defaults are NFFT = minimum of 256 and the length of A, a</span></span></span>
<span class="srcline"><span class="lineno"><a href="44,29" id="srcline29"> 29</a></span><span class="line"><span class="comment">%   Hanning window of length NFFT, and NOVERLAP = length(WINDOW)/2.  You </span></span></span>
<span class="srcline"><span class="lineno"><a href="44,30" id="srcline30"> 30</a></span><span class="line"><span class="comment">%   can tell SPECGRAM to use the default for any parameter by leaving it </span></span></span>
<span class="srcline"><span class="lineno"><a href="44,31" id="srcline31"> 31</a></span><span class="line"><span class="comment">%   off or using [] for that parameter, e.g. SPECGRAM(A,[],1000)</span></span></span>
<span class="srcline"><span class="lineno"><a href="44,32" id="srcline32"> 32</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="44,33" id="srcline33"> 33</a></span><span class="line"><span class="comment">%   SPECGRAM with no output arguments plots the absolute value of the </span></span></span>
<span class="srcline"><span class="lineno"><a href="44,34" id="srcline34"> 34</a></span><span class="line"><span class="comment">%   spectrogram in the current figure, using IMAGESC(T,F,20*log10(ABS(B))),</span></span></span>
<span class="srcline"><span class="lineno"><a href="44,35" id="srcline35"> 35</a></span><span class="line"><span class="comment">%   AXIS XY, COLORMAP(JET) so the low frequency content of the first </span></span></span>
<span class="srcline"><span class="lineno"><a href="44,36" id="srcline36"> 36</a></span><span class="line"><span class="comment">%   portion of the signal is displayed in the lower left corner of the axes.</span></span></span>
<span class="srcline"><span class="lineno"><a href="44,37" id="srcline37"> 37</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="44,38" id="srcline38"> 38</a></span><span class="line"><span class="comment">%   SPECGRAM(A,F,Fs,WINDOW) where F is a vector of frequencies in Hz</span></span></span>
<span class="srcline"><span class="lineno"><a href="44,39" id="srcline39"> 39</a></span><span class="line"><span class="comment">%   (with 2 or more elements) computes the spectrogram at those frequencies</span></span></span>
<span class="srcline"><span class="lineno"><a href="44,40" id="srcline40"> 40</a></span><span class="line"><span class="comment">%   using either the chirp z-transform for more than 20 evenly spaced </span></span></span>
<span class="srcline"><span class="lineno"><a href="44,41" id="srcline41"> 41</a></span><span class="line"><span class="comment">%   frequencies or a polyphase decimation filterbank.</span></span></span>
<span class="srcline"><span class="lineno"><a href="44,42" id="srcline42"> 42</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="44,43" id="srcline43"> 43</a></span><span class="line"><span class="comment">%   See also PWELCH, CSD, COHERE and TFE.</span></span></span>
<span class="srcline"><span class="lineno"><a href="44,44" id="srcline44"> 44</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="44,45" id="srcline45"> 45</a></span><span class="line"><span class="comment">%   Author(s): L. Shure, 1-1-91</span></span></span>
<span class="srcline"><span class="lineno"><a href="44,46" id="srcline46"> 46</a></span><span class="line"><span class="comment">%              T. Krauss, 4-2-93, updated</span></span></span>
<span class="srcline"><span class="lineno"><a href="44,47" id="srcline47"> 47</a></span><span class="line"><span class="comment">%   Copyright 1988-2002 The MathWorks, Inc.</span></span></span>
<span class="srcline"><span class="lineno"><a href="44,48" id="srcline48"> 48</a></span><span class="line"><span class="comment">%   $Revision: 1.8 $  $Date: 2002/03/28 17:30:53 $</span></span></span>
<span class="srcline"><span class="lineno"><a href="44,49" id="srcline49"> 49</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="44,50" id="srcline50"> 50</a></span><span class="line">error(nargchk(1,5,nargin))</span></span>
<span class="srcline"><span class="lineno"><a href="44,51" id="srcline51"> 51</a></span><span class="line">[<span class="var type0" id="S9T0U21"><span class="message error" id="M4F98C">msg</span></span>,<span class="var type0" id="S10T0U22"><span class="message error" id="M5F98C">x</span></span>,<span class="var type0" id="S11T0U23"><span class="message error" id="M6F98C">nfft</span></span>,<span class="var type0" id="S12T0U24"><span class="message error" id="M7F98C">Fs</span></span>,<span class="var type0" id="S13T0U25"><span class="message error" id="M8F98C">window</span></span>,<span class="var type0" id="S14T0U26"><span class="message error" id="M9F98C">noverlap</span></span>]=specgramchk(<span class="mxinfo" id="T25:U3"><span class="var type1" id="S5T25U29"><span class="message error" id="M3F98C">varargin</span></span></span>);</span></span>
<span class="srcline"><span class="lineno"><a href="44,52" id="srcline52"> 52</a></span><span class="line">error(<span class="var type0" id="S9T0U33"><span class="message error" id="M10F98C">msg</span></span>)</span></span>
<span class="srcline"><span class="lineno"><a href="44,53" id="srcline53"> 53</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="44,54" id="srcline54"> 54</a></span><span class="line"><span class="var type0" id="S16T0U36">nx</span> = length(<span class="var type0" id="S10T0U39"><span class="message error" id="M11F98C">x</span></span>);</span></span>
<span class="srcline"><span class="lineno"><a href="44,55" id="srcline55"> 55</a></span><span class="line"><span class="var type0" id="S18T0U42">nwind</span> = length(<span class="var type0" id="S13T0U45"><span class="message error" id="M12F98C">window</span></span>);</span></span>
<span class="srcline"><span class="lineno"><a href="44,56" id="srcline56"> 56</a></span><span class="line"><span class="keyword">if</span> <span class="var type0" id="S16T0U49"><span class="message error" id="M13F98C">nx</span></span> &lt; <span class="var type0" id="S18T0U50">nwind</span>    <span class="comment">% zero-pad x if it has length less than the window length</span></span></span>
<span class="srcline"><span class="lineno"><a href="44,57" id="srcline57"> 57</a></span><span class="line">    <span class="var type0" id="S10T0U54"><span class="message error" id="M14F98C">x</span></span>(<span class="var type0" id="S18T0U55">nwind</span>)=0;  <span class="var type0" id="S16T0U59">nx</span>=<span class="var type0" id="S18T0U60"><span class="message error" id="M15F98C">nwind</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="44,58" id="srcline58"> 58</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="44,59" id="srcline59"> 59</a></span><span class="line"><span class="var type0" id="S10T0U63">x</span> = <span class="var type0" id="S10T0U65"><span class="message error" id="M16F98C">x</span></span>(:); <span class="comment">% make a column vector for ease later</span></span></span>
<span class="srcline"><span class="lineno"><a href="44,60" id="srcline60"> 60</a></span><span class="line"><span class="var type0" id="S13T0U69">window</span> = <span class="var type0" id="S13T0U71"><span class="message error" id="M17F98C">window</span></span>(:); <span class="comment">% be consistent with data set</span></span></span>
<span class="srcline"><span class="lineno"><a href="44,61" id="srcline61"> 61</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="44,62" id="srcline62"> 62</a></span><span class="line"><span class="var type0" id="S19T0U75">ncol</span> = fix((<span class="var type0" id="S16T0U81"><span class="message error" id="M18F98C">nx</span></span>-<span class="var type0" id="S14T0U82">noverlap</span>)/(<span class="var type0" id="S18T0U85">nwind</span>-<span class="var type0" id="S14T0U86">noverlap</span>));</span></span>
<span class="srcline"><span class="lineno"><a href="44,63" id="srcline63"> 63</a></span><span class="line"><span class="var type0" id="S21T0U89">colindex</span> = 1 + (0:(<span class="var type0" id="S19T0U98"><span class="message error" id="M19F98C">ncol</span></span>-1))*(<span class="var type0" id="S18T0U102">nwind</span>-<span class="var type0" id="S14T0U103">noverlap</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="44,64" id="srcline64"> 64</a></span><span class="line"><span class="var type0" id="S22T0U106">rowindex</span> = (1:<span class="var type0" id="S18T0U111"><span class="message error" id="M20F98C">nwind</span></span>)';</span></span>
<span class="srcline"><span class="lineno"><a href="44,65" id="srcline65"> 65</a></span><span class="line"><span class="keyword">if</span> length(<span class="var type0" id="S10T0U117"><span class="message error" id="M21F98C">x</span></span>)&lt;(<span class="var type0" id="S18T0U121">nwind</span>+<span class="var type0" id="S21T0U123">colindex</span>(<span class="var type0" id="S19T0U124">ncol</span>)-1)</span></span>
<span class="srcline"><span class="lineno"><a href="44,66" id="srcline66"> 66</a></span><span class="line">    <span class="var type0" id="S10T0U129"><span class="message error" id="M22F98C">x</span></span>(<span class="var type0" id="S18T0U132">nwind</span>+<span class="var type0" id="S21T0U134">colindex</span>(<span class="var type0" id="S19T0U135">ncol</span>)-1) = 0;   <span class="comment">% zero-pad x</span></span></span>
<span class="srcline"><span class="lineno"><a href="44,67" id="srcline67"> 67</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="44,68" id="srcline68"> 68</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="44,69" id="srcline69"> 69</a></span><span class="line"><span class="keyword">if</span> length(<span class="var type0" id="S11T0U143"><span class="message error" id="M23F98C">nfft</span></span>)&gt;1</span></span>
<span class="srcline"><span class="lineno"><a href="44,70" id="srcline70"> 70</a></span><span class="line">    <span class="var type0" id="S23T0U147">df</span> = diff(<span class="var type0" id="S11T0U150"><span class="message error" id="M24F98C">nfft</span></span>);</span></span>
<span class="srcline"><span class="lineno"><a href="44,71" id="srcline71"> 71</a></span><span class="line">    <span class="var type0" id="S25T0U153">evenly_spaced</span> = all(abs(<span class="var type0" id="S23T0U161"><span class="message error" id="M25F98C">df</span></span>-<span class="var type0" id="S23T0U163">df</span>(1))/<span class="var type0" id="S12T0U165">Fs</span>&lt;1e-12);  <span class="comment">% evenly spaced flag (boolean)</span></span></span>
<span class="srcline"><span class="lineno"><a href="44,72" id="srcline72"> 72</a></span><span class="line">    <span class="var type0" id="S28T0U169">use_chirp</span> = <span class="var type0" id="S25T0U171"><span class="message fatal" id="M26F98C">evenly_spaced</span></span> &amp; (length(<span class="var type0" id="S11T0U176">nfft</span>)&gt;20);</span></span>
<span class="srcline"><span class="lineno"><a href="44,73" id="srcline73"> 73</a></span><span class="line"><span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="44,74" id="srcline74"> 74</a></span><span class="line">    <span class="var type0" id="S25T0U181">evenly_spaced</span> = 1;</span></span>
<span class="srcline"><span class="lineno"><a href="44,75" id="srcline75"> 75</a></span><span class="line">    <span class="var type0" id="S28T0U185">use_chirp</span> = 0;</span></span>
<span class="srcline"><span class="lineno"><a href="44,76" id="srcline76"> 76</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="44,77" id="srcline77"> 77</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="44,78" id="srcline78"> 78</a></span><span class="line"><span class="keyword">if</span> (length(<span class="var type0" id="S11T0U194">nfft</span>)==1) | <span class="var type0" id="S28T0U196">use_chirp</span></span></span>
<span class="srcline"><span class="lineno"><a href="44,79" id="srcline79"> 79</a></span><span class="line">    <span class="var type0" id="S29T0U199">y</span> = zeros(<span class="var type0" id="S18T0U202">nwind</span>,<span class="var type0" id="S19T0U203">ncol</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="44,80" id="srcline80"> 80</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="44,81" id="srcline81"> 81</a></span><span class="line">    <span class="comment">% put x into columns of y with the proper offset</span></span></span>
<span class="srcline"><span class="lineno"><a href="44,82" id="srcline82"> 82</a></span><span class="line">    <span class="comment">% should be able to do this with fancy indexing!</span></span></span>
<span class="srcline"><span class="lineno"><a href="44,83" id="srcline83"> 83</a></span><span class="line">    <span class="var type0" id="S29T0U207">y</span>(:) = <span class="var type0" id="S10T0U210">x</span>(<span class="var type0" id="S22T0U214">rowindex</span>(:,ones(1,<span class="var type0" id="S19T0U219">ncol</span>))+<span class="var type0" id="S21T0U221">colindex</span>(ones(<span class="var type0" id="S18T0U224">nwind</span>,1),:)-1);</span></span>
<span class="srcline"><span class="lineno"><a href="44,84" id="srcline84"> 84</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="44,85" id="srcline85"> 85</a></span><span class="line">    <span class="comment">% Apply the window to the array of offset signal segments.</span></span></span>
<span class="srcline"><span class="lineno"><a href="44,86" id="srcline86"> 86</a></span><span class="line">    <span class="var type0" id="S29T0U230">y</span> = <span class="var type0" id="S13T0U233">window</span>(:,ones(1,<span class="var type0" id="S19T0U238">ncol</span>)).*<span class="var type0" id="S29T0U239">y</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="44,87" id="srcline87"> 87</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="44,88" id="srcline88"> 88</a></span><span class="line">    <span class="keyword">if</span> ~<span class="var type0" id="S28T0U243">use_chirp</span>     <span class="comment">% USE FFT</span></span></span>
<span class="srcline"><span class="lineno"><a href="44,89" id="srcline89"> 89</a></span><span class="line">        <span class="comment">% now fft y which does the columns</span></span></span>
<span class="srcline"><span class="lineno"><a href="44,90" id="srcline90"> 90</a></span><span class="line">        <span class="var type0" id="S29T0U246">y</span> = fft(<span class="var type0" id="S29T0U249">y</span>,<span class="var type0" id="S11T0U250">nfft</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="44,91" id="srcline91"> 91</a></span><span class="line">        <span class="keyword">if</span> ~any(any(imag(<span class="var type0" id="S10T0U260">x</span>)))    <span class="comment">% x purely real</span></span></span>
<span class="srcline"><span class="lineno"><a href="44,92" id="srcline92"> 92</a></span><span class="line">            <span class="keyword">if</span> rem(<span class="var type0" id="S11T0U265">nfft</span>,2),    <span class="comment">% nfft odd</span></span></span>
<span class="srcline"><span class="lineno"><a href="44,93" id="srcline93"> 93</a></span><span class="line">                <span class="var type0" id="S36T0U269">select</span> = [1:(<span class="var type0" id="S11T0U277">nfft</span>+1)/2];</span></span>
<span class="srcline"><span class="lineno"><a href="44,94" id="srcline94"> 94</a></span><span class="line">            <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="44,95" id="srcline95"> 95</a></span><span class="line">                <span class="var type0" id="S36T0U283">select</span> = [1:<span class="var type0" id="S11T0U290">nfft</span>/2+1];</span></span>
<span class="srcline"><span class="lineno"><a href="44,96" id="srcline96"> 96</a></span><span class="line">            <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="44,97" id="srcline97"> 97</a></span><span class="line">            <span class="var type0" id="S29T0U295">y</span> = <span class="var type0" id="S29T0U297">y</span>(<span class="var type0" id="S36T0U298">select</span>,:);</span></span>
<span class="srcline"><span class="lineno"><a href="44,98" id="srcline98"> 98</a></span><span class="line">        <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="44,99" id="srcline99"> 99</a></span><span class="line">            <span class="var type0" id="S36T0U303">select</span> = 1:<span class="var type0" id="S11T0U306">nfft</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="44,100" id="srcline100">100</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="44,101" id="srcline101">101</a></span><span class="line">        <span class="var type0" id="S37T0U309">f</span> = (<span class="var type0" id="S36T0U315">select</span> - 1)'*<span class="var type0" id="S12T0U317">Fs</span>/<span class="var type0" id="S11T0U318">nfft</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="44,102" id="srcline102">102</a></span><span class="line">    <span class="keyword">else</span> <span class="comment">% USE CHIRP Z TRANSFORM</span></span></span>
<span class="srcline"><span class="lineno"><a href="44,103" id="srcline103">103</a></span><span class="line">        error(<span class="string">'has to use czt'</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="44,104" id="srcline104">104</a></span><span class="line"><span class="comment">%         f = nfft(:);</span></span></span>
<span class="srcline"><span class="lineno"><a href="44,105" id="srcline105">105</a></span><span class="line"><span class="comment">%         f1 = f(1);</span></span></span>
<span class="srcline"><span class="lineno"><a href="44,106" id="srcline106">106</a></span><span class="line"><span class="comment">%         f2 = f(end);</span></span></span>
<span class="srcline"><span class="lineno"><a href="44,107" id="srcline107">107</a></span><span class="line"><span class="comment">%         m = length(f);</span></span></span>
<span class="srcline"><span class="lineno"><a href="44,108" id="srcline108">108</a></span><span class="line"><span class="comment">%         w = exp(-j*2*pi*(f2-f1)/(m*Fs));</span></span></span>
<span class="srcline"><span class="lineno"><a href="44,109" id="srcline109">109</a></span><span class="line"><span class="comment">%         a = exp(j*2*pi*f1/Fs);</span></span></span>
<span class="srcline"><span class="lineno"><a href="44,110" id="srcline110">110</a></span><span class="line"><span class="comment">%         y = czt(y,m,w,a);</span></span></span>
<span class="srcline"><span class="lineno"><a href="44,111" id="srcline111">111</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="44,112" id="srcline112">112</a></span><span class="line"><span class="keyword">else</span>  <span class="comment">% evaluate DFT on given set of frequencies</span></span></span>
<span class="srcline"><span class="lineno"><a href="44,113" id="srcline113">113</a></span><span class="line">    <span class="var type0" id="S37T0U327">f</span> = <span class="var type0" id="S11T0U329">nfft</span>(:);</span></span>
<span class="srcline"><span class="lineno"><a href="44,114" id="srcline114">114</a></span><span class="line">    <span class="var type0" id="S38T0U333">q</span> = <span class="var type0" id="S18T0U335">nwind</span> - <span class="var type0" id="S14T0U336">noverlap</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="44,115" id="srcline115">115</a></span><span class="line">    <span class="var type0" id="S39T0U339">extras</span> = floor(<span class="var type0" id="S18T0U343">nwind</span>/<span class="var type0" id="S38T0U344">q</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="44,116" id="srcline116">116</a></span><span class="line">    <span class="var type0" id="S10T0U347">x</span> = [zeros(<span class="var type0" id="S38T0U354">q</span>-rem(<span class="var type0" id="S18T0U357">nwind</span>,<span class="var type0" id="S38T0U358">q</span>)+1,1); <span class="var type0" id="S10T0U362">x</span>];</span></span>
<span class="srcline"><span class="lineno"><a href="44,117" id="srcline117">117</a></span><span class="line">    <span class="comment">% create windowed DTFT matrix (filter bank)</span></span></span>
<span class="srcline"><span class="lineno"><a href="44,118" id="srcline118">118</a></span><span class="line">    <span class="var type0" id="S41T0U365">D</span> = <span class="var type0" id="S13T0U368">window</span>(:,ones(1,length(<span class="var type0" id="S37T0U375">f</span>))).*exp((-j*2*pi/<span class="var type0" id="S12T0U391">Fs</span>*((<span class="var type0" id="S18T0U397">nwind</span>-1):-1:0)).'*<span class="var type0" id="S37T0U403">f</span>'); </span></span>
<span class="srcline"><span class="lineno"><a href="44,119" id="srcline119">119</a></span><span class="line">    <span class="var type0" id="S29T0U406">y</span> = upfirdn(<span class="var type0" id="S10T0U410">x</span>,<span class="var type0" id="S41T0U411">D</span>,1,<span class="var type0" id="S38T0U413">q</span>).';</span></span>
<span class="srcline"><span class="lineno"><a href="44,120" id="srcline120">120</a></span><span class="line">    <span class="var type0" id="S29T0U417">y</span>(:,[1:<span class="var type0" id="S39T0U424">extras</span>+1 end-<span class="var type0" id="S39T0U431">extras</span>+1:end]) = []; </span></span>
<span class="srcline"><span class="lineno"><a href="44,121" id="srcline121">121</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="44,122" id="srcline122">122</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="44,123" id="srcline123">123</a></span><span class="line"><span class="var type0" id="S47T0U439">t</span> = (<span class="var type0" id="S21T0U444">colindex</span>-1)'/<span class="var type0" id="S12T0U446">Fs</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="44,124" id="srcline124">124</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="44,125" id="srcline125">125</a></span><span class="line"><span class="comment">% take abs, and use image to display results</span></span></span>
<span class="srcline"><span class="lineno"><a href="44,126" id="srcline126">126</a></span><span class="line"><span class="comment">% if nargout == 0</span></span></span>
<span class="srcline"><span class="lineno"><a href="44,127" id="srcline127">127</a></span><span class="line"><span class="comment">%     newplot;</span></span></span>
<span class="srcline"><span class="lineno"><a href="44,128" id="srcline128">128</a></span><span class="line"><span class="comment">%     if length(t)==1</span></span></span>
<span class="srcline"><span class="lineno"><a href="44,129" id="srcline129">129</a></span><span class="line"><span class="comment">%         imagesc([0 1/f(2)],f,20*log10(abs(y)+eps));axis xy; colormap(jet)</span></span></span>
<span class="srcline"><span class="lineno"><a href="44,130" id="srcline130">130</a></span><span class="line"><span class="comment">%     else</span></span></span>
<span class="srcline"><span class="lineno"><a href="44,131" id="srcline131">131</a></span><span class="line"><span class="comment">%         imagesc(t,f,20*log10(abs(y)+eps));axis xy; colormap(jet)</span></span></span>
<span class="srcline"><span class="lineno"><a href="44,132" id="srcline132">132</a></span><span class="line"><span class="comment">%     end</span></span></span>
<span class="srcline"><span class="lineno"><a href="44,133" id="srcline133">133</a></span><span class="line"><span class="comment">%     xlabel('Time')</span></span></span>
<span class="srcline"><span class="lineno"><a href="44,134" id="srcline134">134</a></span><span class="line"><span class="comment">%     ylabel('Frequency')</span></span></span>
<span class="srcline"><span class="lineno"><a href="44,135" id="srcline135">135</a></span><span class="line"><span class="keyword">if</span> nargout == 1,</span></span>
<span class="srcline"><span class="lineno"><a href="44,136" id="srcline136">136</a></span><span class="line">    <span class="var type0" id="S2T0U455">yo</span> = <span class="var type0" id="S29T0U456">y</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="44,137" id="srcline137">137</a></span><span class="line"><span class="keyword">elseif</span> nargout == 2,</span></span>
<span class="srcline"><span class="lineno"><a href="44,138" id="srcline138">138</a></span><span class="line">    <span class="var type0" id="S2T0U464">yo</span> = <span class="var type0" id="S29T0U465">y</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="44,139" id="srcline139">139</a></span><span class="line">    <span class="var type0" id="S3T0U468">fo</span> = <span class="var type0" id="S37T0U469">f</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="44,140" id="srcline140">140</a></span><span class="line"><span class="keyword">elseif</span> nargout == 3,</span></span>
<span class="srcline"><span class="lineno"><a href="44,141" id="srcline141">141</a></span><span class="line">    <span class="var type0" id="S2T0U477">yo</span> = <span class="var type0" id="S29T0U478">y</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="44,142" id="srcline142">142</a></span><span class="line">    <span class="var type0" id="S3T0U481">fo</span> = <span class="var type0" id="S37T0U482">f</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="44,143" id="srcline143">143</a></span><span class="line">    <span class="var type0" id="S4T0U485">to</span> = <span class="var type0" id="S47T0U486">t</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="44,144" id="srcline144">144</a></span><span class="line"><span class="keyword"><span class="keyword">end</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="44,145" id="srcline145">145</a></span><span class="line"></span></span>
</pre>
