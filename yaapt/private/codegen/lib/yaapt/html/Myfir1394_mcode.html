<!-- saved from url=(0014)about:internet -->
<pre class="code">
<span class="srcline"><span class="lineno"><a href="111,1" id="srcline1">  1</a></span><span class="line"><span class="keyword">function</span> [<span class="var type1" id="S2T55U3">b</span>,<span class="var type0" id="S3T0U4">a</span>] = Myfir1(<span class="mxinfo" id="T2:U2"><span class="var type2" id="S4T2V1U7">N</span></span>,<span class="var type1" id="S5T7U8">Wn</span>) </span></span>
<span class="srcline"><span class="lineno"><a href="111,2" id="srcline2">  2</a></span><span class="line"><span class="comment">%FIR1   FIR filter design using the window method. </span></span></span>
<span class="srcline"><span class="lineno"><a href="111,3" id="srcline3">  3</a></span><span class="line"><span class="comment">%   B = FIR1(N,Wn) designs an N'th order lowpass FIR digital filter </span></span></span>
<span class="srcline"><span class="lineno"><a href="111,4" id="srcline4">  4</a></span><span class="line"><span class="comment">%   and returns the filter coefficients in length N+1 vector B. </span></span></span>
<span class="srcline"><span class="lineno"><a href="111,5" id="srcline5">  5</a></span><span class="line"><span class="comment">%   The cut-off frequency Wn must be between 0 &lt; Wn &lt; 1.0, with 1.0  </span></span></span>
<span class="srcline"><span class="lineno"><a href="111,6" id="srcline6">  6</a></span><span class="line"><span class="comment">%   corresponding to half the sample rate.  The filter B is real and </span></span></span>
<span class="srcline"><span class="lineno"><a href="111,7" id="srcline7">  7</a></span><span class="line"><span class="comment">%   has linear phase, i.e., even symmetric coefficients obeying B(k) = </span></span></span>
<span class="srcline"><span class="lineno"><a href="111,8" id="srcline8">  8</a></span><span class="line"><span class="comment">%   B(N+2-k), k = 1,2,<span class="keyword">...</span><span class="comment">,N+1. </span></span></span></span>
<span class="srcline"><span class="lineno"><a href="111,9" id="srcline9">  9</a></span><span class="line"><span class="comment">% </span></span></span>
<span class="srcline"><span class="lineno"><a href="111,10" id="srcline10"> 10</a></span><span class="line"><span class="comment">%   If Wn is a two-element vector, Wn = [W1 W2], FIR1 returns an </span></span></span>
<span class="srcline"><span class="lineno"><a href="111,11" id="srcline11"> 11</a></span><span class="line"><span class="comment">%   order N bandpass filter with passband  W1 &lt; W &lt; W2. </span></span></span>
<span class="srcline"><span class="lineno"><a href="111,12" id="srcline12"> 12</a></span><span class="line"><span class="comment">%   B = FIR1(N,Wn,'high') designs a highpass filter. </span></span></span>
<span class="srcline"><span class="lineno"><a href="111,13" id="srcline13"> 13</a></span><span class="line"><span class="comment">%   B = FIR1(N,Wn,'stop') is a bandstop filter if Wn = [W1 W2]. </span></span></span>
<span class="srcline"><span class="lineno"><a href="111,14" id="srcline14"> 14</a></span><span class="line"><span class="comment">% </span></span></span>
<span class="srcline"><span class="lineno"><a href="111,15" id="srcline15"> 15</a></span><span class="line"><span class="comment">%   If Wn is a multi-element vector,  </span></span></span>
<span class="srcline"><span class="lineno"><a href="111,16" id="srcline16"> 16</a></span><span class="line"><span class="comment">%          Wn = [W1 W2 W3 W4 W5 <span class="keyword">...</span><span class="comment"> WN], </span></span></span></span>
<span class="srcline"><span class="lineno"><a href="111,17" id="srcline17"> 17</a></span><span class="line"><span class="comment">%   FIR1 returns an order N multiband filter with bands </span></span></span>
<span class="srcline"><span class="lineno"><a href="111,18" id="srcline18"> 18</a></span><span class="line"><span class="comment">%    0 &lt; W &lt; W1, W1 &lt; W &lt; W2, <span class="keyword">...</span><span class="comment">, WN &lt; W &lt; 1. </span></span></span></span>
<span class="srcline"><span class="lineno"><a href="111,19" id="srcline19"> 19</a></span><span class="line"><span class="comment">%   B = FIR1(N,Wn,'DC-1') makes the first band a passband. </span></span></span>
<span class="srcline"><span class="lineno"><a href="111,20" id="srcline20"> 20</a></span><span class="line"><span class="comment">%   B = FIR1(N,Wn,'DC-0') makes the first band a stopband. </span></span></span>
<span class="srcline"><span class="lineno"><a href="111,21" id="srcline21"> 21</a></span><span class="line"><span class="comment">% </span></span></span>
<span class="srcline"><span class="lineno"><a href="111,22" id="srcline22"> 22</a></span><span class="line"><span class="comment">%   For filters with a passband near Fs/2, e.g., highpass </span></span></span>
<span class="srcline"><span class="lineno"><a href="111,23" id="srcline23"> 23</a></span><span class="line"><span class="comment">%   and bandstop filters, N must be even. </span></span></span>
<span class="srcline"><span class="lineno"><a href="111,24" id="srcline24"> 24</a></span><span class="line"><span class="comment">%    </span></span></span>
<span class="srcline"><span class="lineno"><a href="111,25" id="srcline25"> 25</a></span><span class="line"><span class="comment">%   By default FIR1 uses a Hamming window.  Other available windows, </span></span></span>
<span class="srcline"><span class="lineno"><a href="111,26" id="srcline26"> 26</a></span><span class="line"><span class="comment">%   including Boxcar, Hanning, Bartlett, Blackman, Kaiser and Chebwin </span></span></span>
<span class="srcline"><span class="lineno"><a href="111,27" id="srcline27"> 27</a></span><span class="line"><span class="comment">%   can be specified with an optional trailing argument.  For example, </span></span></span>
<span class="srcline"><span class="lineno"><a href="111,28" id="srcline28"> 28</a></span><span class="line"><span class="comment">%   B = FIR1(N,Wn,kaiser(N+1,4)) uses a Kaiser window with beta=4. </span></span></span>
<span class="srcline"><span class="lineno"><a href="111,29" id="srcline29"> 29</a></span><span class="line"><span class="comment">%   B = FIR1(N,Wn,'high',chebwin(N+1,R)) uses a Chebyshev window. </span></span></span>
<span class="srcline"><span class="lineno"><a href="111,30" id="srcline30"> 30</a></span><span class="line"><span class="comment">% </span></span></span>
<span class="srcline"><span class="lineno"><a href="111,31" id="srcline31"> 31</a></span><span class="line"><span class="comment">%   By default, the filter is scaled so the center of the first pass band  </span></span></span>
<span class="srcline"><span class="lineno"><a href="111,32" id="srcline32"> 32</a></span><span class="line"><span class="comment">%   has magnitude exactly one after windowing. Use a trailing 'noscale'  </span></span></span>
<span class="srcline"><span class="lineno"><a href="111,33" id="srcline33"> 33</a></span><span class="line"><span class="comment">%   argument to prevent this scaling, e.g. B = FIR1(N,Wn,'noscale'),  </span></span></span>
<span class="srcline"><span class="lineno"><a href="111,34" id="srcline34"> 34</a></span><span class="line"><span class="comment">%   B = FIR1(N,Wn,'high','noscale'), B = FIR1(N,Wn,wind,'noscale'). </span></span></span>
<span class="srcline"><span class="lineno"><a href="111,35" id="srcline35"> 35</a></span><span class="line"><span class="comment">% </span></span></span>
<span class="srcline"><span class="lineno"><a href="111,36" id="srcline36"> 36</a></span><span class="line"><span class="comment">%   See also KAISERORD, FIRCLS1, FIR2, FIRLS, FIRCLS, CREMEZ, </span></span></span>
<span class="srcline"><span class="lineno"><a href="111,37" id="srcline37"> 37</a></span><span class="line"><span class="comment">%            REMEZ, FREQZ, FILTER. </span></span></span>
<span class="srcline"><span class="lineno"><a href="111,38" id="srcline38"> 38</a></span><span class="line"> </span></span>
<span class="srcline"><span class="lineno"><a href="111,39" id="srcline39"> 39</a></span><span class="line"><span class="comment">%   FIR1 is an M-file implementation of program 5.2 in the IEEE </span></span></span>
<span class="srcline"><span class="lineno"><a href="111,40" id="srcline40"> 40</a></span><span class="line"><span class="comment">%   Programs for Digital Signal Processing tape.  </span></span></span>
<span class="srcline"><span class="lineno"><a href="111,41" id="srcline41"> 41</a></span><span class="line"> </span></span>
<span class="srcline"><span class="lineno"><a href="111,42" id="srcline42"> 42</a></span><span class="line"><span class="comment">%   Author(s): L. Shure </span></span></span>
<span class="srcline"><span class="lineno"><a href="111,43" id="srcline43"> 43</a></span><span class="line"><span class="comment">%              L. Shure, 4-5-90, revised </span></span></span>
<span class="srcline"><span class="lineno"><a href="111,44" id="srcline44"> 44</a></span><span class="line"><span class="comment">%              T. Krauss, 3-5-96, revised </span></span></span>
<span class="srcline"><span class="lineno"><a href="111,45" id="srcline45"> 45</a></span><span class="line"><span class="comment">%   Copyright (c) 1988-98 by The MathWorks, Inc. </span></span></span>
<span class="srcline"><span class="lineno"><a href="111,46" id="srcline46"> 46</a></span><span class="line"><span class="comment">%   $Revision: 1.20 $  $Date: 1997/12/02 18:36:03 $ </span></span></span>
<span class="srcline"><span class="lineno"><a href="111,47" id="srcline47"> 47</a></span><span class="line"> </span></span>
<span class="srcline"><span class="lineno"><a href="111,48" id="srcline48"> 48</a></span><span class="line"><span class="comment">%   Reference(s): </span></span></span>
<span class="srcline"><span class="lineno"><a href="111,49" id="srcline49"> 49</a></span><span class="line"><span class="comment">%     [1] "Programs for Digital Signal Processing", IEEE Press </span></span></span>
<span class="srcline"><span class="lineno"><a href="111,50" id="srcline50"> 50</a></span><span class="line"><span class="comment">%         John Wiley &amp; Sons, 1979, pg. 5.2-1. </span></span></span>
<span class="srcline"><span class="lineno"><a href="111,51" id="srcline51"> 51</a></span><span class="line"> </span></span>
<span class="srcline"><span class="lineno"><a href="111,52" id="srcline52"> 52</a></span><span class="line"><span class="comment">% nargchk(2,5,nargin); </span></span></span>
<span class="srcline"><span class="lineno"><a href="111,53" id="srcline53"> 53</a></span><span class="line"> </span></span>
<span class="srcline"><span class="lineno"><a href="111,54" id="srcline54"> 54</a></span><span class="line"><span class="comment">% Up to 3 optional input arguments, always in this order: </span></span></span>
<span class="srcline"><span class="lineno"><a href="111,55" id="srcline55"> 55</a></span><span class="line"><span class="comment">%   1 - Filter type flag, can be 'high', 'stop', '', 'DC-0', or 'DC-1' </span></span></span>
<span class="srcline"><span class="lineno"><a href="111,56" id="srcline56"> 56</a></span><span class="line"><span class="comment">%   2 - Window vector </span></span></span>
<span class="srcline"><span class="lineno"><a href="111,57" id="srcline57"> 57</a></span><span class="line"><span class="comment">%   3 - 'noscale' flag </span></span></span>
<span class="srcline"><span class="lineno"><a href="111,58" id="srcline58"> 58</a></span><span class="line"> </span></span>
<span class="srcline"><span class="lineno"><a href="111,59" id="srcline59"> 59</a></span><span class="line"><span class="comment">% default optional parameter values: </span></span></span>
<span class="srcline"><span class="lineno"><a href="111,60" id="srcline60"> 60</a></span><span class="line"><span class="mxinfo" id="T9:U5"><span class="var type1" id="S6T9U11">Wind</span> = <span class="mxinfo" id="T9:U7">[]</span></span>; </span></span>
<span class="srcline"><span class="lineno"><a href="111,61" id="srcline61"> 61</a></span><span class="line"><span class="comment">% Ftype = ''; </span></span></span>
<span class="srcline"><span class="lineno"><a href="111,62" id="srcline62"> 62</a></span><span class="line"><span class="comment">% Wind = []; </span></span></span>
<span class="srcline"><span class="lineno"><a href="111,63" id="srcline63"> 63</a></span><span class="line"><span class="comment">% Scale = 'scale'; </span></span></span>
<span class="srcline"><span class="lineno"><a href="111,64" id="srcline64"> 64</a></span><span class="line"> </span></span>
<span class="srcline"><span class="lineno"><a href="111,65" id="srcline65"> 65</a></span><span class="line"><span class="comment">% switch length(varargin) </span></span></span>
<span class="srcline"><span class="lineno"><a href="111,66" id="srcline66"> 66</a></span><span class="line"><span class="comment">% case 1 </span></span></span>
<span class="srcline"><span class="lineno"><a href="111,67" id="srcline67"> 67</a></span><span class="line"><span class="comment">%     if isstr(varargin{1})&amp;(length(varargin{1})&gt;0) </span></span></span>
<span class="srcline"><span class="lineno"><a href="111,68" id="srcline68"> 68</a></span><span class="line"><span class="comment">%         s = upper(varargin{1}); </span></span></span>
<span class="srcline"><span class="lineno"><a href="111,69" id="srcline69"> 69</a></span><span class="line"><span class="comment">%         switch upper(s) </span></span></span>
<span class="srcline"><span class="lineno"><a href="111,70" id="srcline70"> 70</a></span><span class="line"><span class="comment">%         case {'SCALE','NOSCALE'} </span></span></span>
<span class="srcline"><span class="lineno"><a href="111,71" id="srcline71"> 71</a></span><span class="line"><span class="comment">%             Scale = s; </span></span></span>
<span class="srcline"><span class="lineno"><a href="111,72" id="srcline72"> 72</a></span><span class="line"><span class="comment">%         otherwise </span></span></span>
<span class="srcline"><span class="lineno"><a href="111,73" id="srcline73"> 73</a></span><span class="line"><span class="comment">%             Ftype = s; </span></span></span>
<span class="srcline"><span class="lineno"><a href="111,74" id="srcline74"> 74</a></span><span class="line"><span class="comment">%         end </span></span></span>
<span class="srcline"><span class="lineno"><a href="111,75" id="srcline75"> 75</a></span><span class="line"><span class="comment">%     else </span></span></span>
<span class="srcline"><span class="lineno"><a href="111,76" id="srcline76"> 76</a></span><span class="line"><span class="comment">%         Wind = varargin{1}; </span></span></span>
<span class="srcline"><span class="lineno"><a href="111,77" id="srcline77"> 77</a></span><span class="line"><span class="comment">%     end </span></span></span>
<span class="srcline"><span class="lineno"><a href="111,78" id="srcline78"> 78</a></span><span class="line"><span class="comment">% case 2 </span></span></span>
<span class="srcline"><span class="lineno"><a href="111,79" id="srcline79"> 79</a></span><span class="line"><span class="comment">%     if isstr(varargin{1}) </span></span></span>
<span class="srcline"><span class="lineno"><a href="111,80" id="srcline80"> 80</a></span><span class="line"><span class="comment">%         Ftype = varargin{1}; </span></span></span>
<span class="srcline"><span class="lineno"><a href="111,81" id="srcline81"> 81</a></span><span class="line"><span class="comment">%     else </span></span></span>
<span class="srcline"><span class="lineno"><a href="111,82" id="srcline82"> 82</a></span><span class="line"><span class="comment">%         Wind = varargin{1}; </span></span></span>
<span class="srcline"><span class="lineno"><a href="111,83" id="srcline83"> 83</a></span><span class="line"><span class="comment">%     end </span></span></span>
<span class="srcline"><span class="lineno"><a href="111,84" id="srcline84"> 84</a></span><span class="line"><span class="comment">%     if isstr(varargin{2}) </span></span></span>
<span class="srcline"><span class="lineno"><a href="111,85" id="srcline85"> 85</a></span><span class="line"><span class="comment">%         Scale = varargin{2}; </span></span></span>
<span class="srcline"><span class="lineno"><a href="111,86" id="srcline86"> 86</a></span><span class="line"><span class="comment">%     else </span></span></span>
<span class="srcline"><span class="lineno"><a href="111,87" id="srcline87"> 87</a></span><span class="line"><span class="comment">%         Wind = varargin{2}; </span></span></span>
<span class="srcline"><span class="lineno"><a href="111,88" id="srcline88"> 88</a></span><span class="line"><span class="comment">%     end </span></span></span>
<span class="srcline"><span class="lineno"><a href="111,89" id="srcline89"> 89</a></span><span class="line"><span class="comment">% case 3 </span></span></span>
<span class="srcline"><span class="lineno"><a href="111,90" id="srcline90"> 90</a></span><span class="line"><span class="comment">%     Ftype = varargin{1}; </span></span></span>
<span class="srcline"><span class="lineno"><a href="111,91" id="srcline91"> 91</a></span><span class="line"><span class="comment">%     Wind = varargin{2}; </span></span></span>
<span class="srcline"><span class="lineno"><a href="111,92" id="srcline92"> 92</a></span><span class="line"><span class="comment">%     Scale = varargin{3}; </span></span></span>
<span class="srcline"><span class="lineno"><a href="111,93" id="srcline93"> 93</a></span><span class="line"><span class="comment">% end </span></span></span>
<span class="srcline"><span class="lineno"><a href="111,94" id="srcline94"> 94</a></span><span class="line"> </span></span>
<span class="srcline"><span class="lineno"><a href="111,95" id="srcline95"> 95</a></span><span class="line"><span class="comment">% switch upper(Scale) </span></span></span>
<span class="srcline"><span class="lineno"><a href="111,96" id="srcline96"> 96</a></span><span class="line"><span class="comment">% case 'NOSCALE' </span></span></span>
<span class="srcline"><span class="lineno"><a href="111,97" id="srcline97"> 97</a></span><span class="line"><span class="comment">%     SCALING = 0; </span></span></span>
<span class="srcline"><span class="lineno"><a href="111,98" id="srcline98"> 98</a></span><span class="line"><span class="comment">% case 'SCALE' </span></span></span>
<span class="srcline"><span class="lineno"><a href="111,99" id="srcline99"> 99</a></span><span class="line">    <span class="mxinfo" id="T2:U8"><span class="var type1" id="S7T2U16">SCALING</span> = <span class="mxinfo" id="T2:U10">1</span></span>; </span></span>
<span class="srcline"><span class="lineno"><a href="111,100" id="srcline100">100</a></span><span class="line"><span class="comment">% otherwise </span></span></span>
<span class="srcline"><span class="lineno"><a href="111,101" id="srcline101">101</a></span><span class="line"><span class="comment">%     error('Scaling option must be ''noscale'' or ''scale''.') </span></span></span>
<span class="srcline"><span class="lineno"><a href="111,102" id="srcline102">102</a></span><span class="line"><span class="comment">% end </span></span></span>
<span class="srcline"><span class="lineno"><a href="111,103" id="srcline103">103</a></span><span class="line"> </span></span>
<span class="srcline"><span class="lineno"><a href="111,104" id="srcline104">104</a></span><span class="line"><span class="keyword">if</span> isempty(<span class="var type1" id="S4T2U26">N</span>) | ~isnumeric(<span class="var type1" id="S4T2U30">N</span>) | ~isreal(<span class="var type1" id="S4T2U34">N</span>) | <span class="var type1" id="S4T2U36">N</span>~=round(<span class="var type1" id="S4T2U39">N</span>) | <span class="var type1" id="S4T2U41">N</span>&lt;=0 </span></span>
<span class="srcline"><span class="lineno"><a href="111,105" id="srcline105">105</a></span><span class="line">    error(<span class="string">'N must be a real, positive integer.'</span>) </span></span>
<span class="srcline"><span class="lineno"><a href="111,106" id="srcline106">106</a></span><span class="line"><span class="keyword">end</span> </span></span>
<span class="srcline"><span class="lineno"><a href="111,107" id="srcline107">107</a></span><span class="line"> </span></span>
<span class="srcline"><span class="lineno"><a href="111,108" id="srcline108">108</a></span><span class="line"><span class="comment">% Ftype = upper(Ftype); </span></span></span>
<span class="srcline"><span class="lineno"><a href="111,109" id="srcline109">109</a></span><span class="line"><span class="comment">% if ~strncmp(Ftype,'HIGH',1) &amp; ~strncmp(Ftype,'STOP',1) &amp; <span class="keyword">...</span><span class="comment"> </span></span></span></span>
<span class="srcline"><span class="lineno"><a href="111,110" id="srcline110">110</a></span><span class="line"><span class="comment">%    ~strncmp(Ftype,'DC-0',4) &amp; ~strncmp(Ftype,'DC-1',4) &amp; <span class="keyword">...</span><span class="comment"> </span></span></span></span>
<span class="srcline"><span class="lineno"><a href="111,111" id="srcline111">111</a></span><span class="line"><span class="comment">%    ~isempty(Ftype) </span></span></span>
<span class="srcline"><span class="lineno"><a href="111,112" id="srcline112">112</a></span><span class="line"><span class="comment">%     error('Filter type must be ''high'',''stop'',''DC-0'', or ''DC-1''.') </span></span></span>
<span class="srcline"><span class="lineno"><a href="111,113" id="srcline113">113</a></span><span class="line"><span class="comment">% end </span></span></span>
<span class="srcline"><span class="lineno"><a href="111,114" id="srcline114">114</a></span><span class="line"> </span></span>
<span class="srcline"><span class="lineno"><a href="111,115" id="srcline115">115</a></span><span class="line"><span class="mxinfo" id="T2:U17"><span class="var type1" id="S13T2U49">nw</span> = <span class="mxinfo" id="T2:U19">length(<span class="var type1" id="S6T9U52">Wind</span>)</span></span>; </span></span>
<span class="srcline"><span class="lineno"><a href="111,116" id="srcline116">116</a></span><span class="line"> </span></span>
<span class="srcline"><span class="lineno"><a href="111,117" id="srcline117">117</a></span><span class="line"><span class="mxinfo" id="T2:U21"><span class="var type1" id="S15T2U55">nbands</span> = <span class="mxinfo" id="T2:U23">length(<span class="var type1" id="S5T7U59">Wn</span>) + 1</span></span>; </span></span>
<span class="srcline"><span class="lineno"><a href="111,118" id="srcline118">118</a></span><span class="line"><span class="comment">% if (nbands &gt; 2) &amp; isempty(Ftype) </span></span></span>
<span class="srcline"><span class="lineno"><a href="111,119" id="srcline119">119</a></span><span class="line"> <span class="keyword">if</span> (<span class="var type1" id="S15T2U65">nbands</span> &gt; 2)</span></span>
<span class="srcline"><span class="lineno"><a href="111,120" id="srcline120">120</a></span><span class="line">    <span class="mxinfo" id="T12:U26"><span class="var type1" id="S16T12U69">Ftype</span> = <span class="mxinfo" id="T12:U28"><span class="string">'DC-0'</span></span></span>;  <span class="comment">% make sure default 3 band filter is bandpass </span></span></span>
<span class="srcline"><span class="lineno"><a href="111,121" id="srcline121">121</a></span><span class="line"><span class="keyword">end</span> </span></span>
<span class="srcline"><span class="lineno"><a href="111,122" id="srcline122">122</a></span><span class="line"><span class="mxinfo" id="T4:U29"><span class="var type1" id="S17T4U73">First_Band</span> = <span class="mxinfo" id="T4:U31">isempty(strfind(<span class="string">'DC-0'</span>,<span class="var type1" id="S16T12U80">Ftype</span>)) &amp; isempty(strfind(<span class="string">'HIGH'</span>,<span class="var type1" id="S16T12U86">Ftype</span>))</span></span>; </span></span>
<span class="srcline"><span class="lineno"><a href="111,123" id="srcline123">123</a></span><span class="line"><span class="mxinfo" id="T19:U34"><span class="var type1" id="S19T19U89">mags</span> = <span class="mxinfo" id="T19:U36">rem( <span class="var type1" id="S17T4U93">First_Band</span> + (0:<span class="var type1" id="S15T2U98">nbands</span>-1), 2)</span></span>; </span></span>
<span class="srcline"><span class="lineno"><a href="111,124" id="srcline124">124</a></span><span class="line"> </span></span>
<span class="srcline"><span class="lineno"><a href="111,125" id="srcline125">125</a></span><span class="line"><span class="mxinfo" id="T2:U39"><span class="var type1" id="S21T2U103">L</span> = <span class="mxinfo" id="T2:U41"><span class="var type1" id="S4T2U105">N</span> + 1</span></span>; </span></span>
<span class="srcline"><span class="lineno"><a href="111,126" id="srcline126">126</a></span><span class="line"><span class="mxinfo" id="T2:U43"><span class="var type1" id="S22T2U109">odd</span> = <span class="mxinfo" id="T2:U45">rem(<span class="mxinfo" id="T2:U46"><span class="var type1" id="S21T2U112">L</span></span>, <span class="mxinfo" id="T2:U48">2</span>)</span></span>; </span></span>
<span class="srcline"><span class="lineno"><a href="111,127" id="srcline127">127</a></span><span class="line"><span class="comment">% if (mags(nbands) &amp; ~odd) </span></span></span>
<span class="srcline"><span class="lineno"><a href="111,128" id="srcline128">128</a></span><span class="line"><span class="comment">%       disp('For highpass and bandstop filters, order must be even.') </span></span></span>
<span class="srcline"><span class="lineno"><a href="111,129" id="srcline129">129</a></span><span class="line"><span class="comment">%       disp('Order is being increased by 1.') </span></span></span>
<span class="srcline"><span class="lineno"><a href="111,130" id="srcline130">130</a></span><span class="line"><span class="comment">%       N = N + 1;  L = L + 1; </span></span></span>
<span class="srcline"><span class="lineno"><a href="111,131" id="srcline131">131</a></span><span class="line"><span class="comment">%       odd = 1; </span></span></span>
<span class="srcline"><span class="lineno"><a href="111,132" id="srcline132">132</a></span><span class="line"><span class="comment">% end </span></span></span>
<span class="srcline"><span class="lineno"><a href="111,133" id="srcline133">133</a></span><span class="line"><span class="keyword">if</span> <span class="var type1" id="S13T2U118">nw</span> ~= 0 &amp; <span class="var type0" id="S13T0U121">nw</span> ~= <span class="var type0" id="S21T0U122">L</span> </span></span>
<span class="srcline"><span class="lineno"><a href="111,134" id="srcline134">134</a></span><span class="line">   error(<span class="string">'The window length must be the same as the filter length.'</span>) </span></span>
<span class="srcline"><span class="lineno"><a href="111,135" id="srcline135">135</a></span><span class="line"><span class="keyword">end</span> </span></span>
<span class="srcline"><span class="lineno"><a href="111,136" id="srcline136">136</a></span><span class="line"><span class="keyword">if</span> <span class="var type1" id="S13T2U130">nw</span> == 0   <span class="comment">% replace the following with the default window of your choice. </span></span></span>
<span class="srcline"><span class="lineno"><a href="111,137" id="srcline137">137</a></span><span class="line">   <span class="mxinfo" id="T22:U51"><span class="var type1" id="S23T22U134">Window</span> = <span class="mxinfo" id="T22:U53">hamming(<span class="var type1" id="S21T2U137">L</span>)</span></span>; </span></span>
<span class="srcline"><span class="lineno"><a href="111,138" id="srcline138">138</a></span><span class="line"><span class="keyword">end</span> </span></span>
<span class="srcline"><span class="lineno"><a href="111,139" id="srcline139">139</a></span><span class="line"><span class="comment">% </span></span></span>
<span class="srcline"><span class="lineno"><a href="111,140" id="srcline140">140</a></span><span class="line"><span class="comment">% to use Kaiser window, beta must be supplied </span></span></span>
<span class="srcline"><span class="lineno"><a href="111,141" id="srcline141">141</a></span><span class="line"><span class="comment">% att = 60; % dB of attenuation desired in sidelobe </span></span></span>
<span class="srcline"><span class="lineno"><a href="111,142" id="srcline142">142</a></span><span class="line"><span class="comment">% beta = 0.1102*(att-8.7); </span></span></span>
<span class="srcline"><span class="lineno"><a href="111,143" id="srcline143">143</a></span><span class="line"><span class="comment">% wind = kaiser(L,beta); </span></span></span>
<span class="srcline"><span class="lineno"><a href="111,144" id="srcline144">144</a></span><span class="line"> </span></span>
<span class="srcline"><span class="lineno"><a href="111,145" id="srcline145">145</a></span><span class="line"><span class="keyword">if</span>  <span class="mxinfo" id="T4:U55">any( <span class="mxinfo" id="T23:U56"><span class="mxinfo" id="T23:U57"><span class="var type1" id="S5T7U144">Wn</span>&lt;<span class="mxinfo" id="T2:U59">0</span></span> | <span class="mxinfo" id="T23:U60"><span class="var type1" id="S5T7U147">Wn</span>&gt;<span class="mxinfo" id="T2:U62">1</span></span></span> )</span> </span></span>
<span class="srcline"><span class="lineno"><a href="111,146" id="srcline146">146</a></span><span class="line">   error(<span class="string">'Frequencies must fall in range between 0 and 1.'</span>) </span></span>
<span class="srcline"><span class="lineno"><a href="111,147" id="srcline147">147</a></span><span class="line"><span class="keyword">end</span> </span></span>
<span class="srcline"><span class="lineno"><a href="111,148" id="srcline148">148</a></span><span class="line"><span class="keyword">if</span>  <span class="mxinfo" id="T4:U63">any(<span class="mxinfo" id="T4:U64"><span class="mxinfo" id="T2:U65">diff(<span class="var type1" id="S5T7U160">Wn</span>)</span>&lt;<span class="mxinfo" id="T2:U67">0</span></span>)</span> </span></span>
<span class="srcline"><span class="lineno"><a href="111,149" id="srcline149">149</a></span><span class="line">   error(<span class="string">'Frequencies must be increasing'</span>) </span></span>
<span class="srcline"><span class="lineno"><a href="111,150" id="srcline150">150</a></span><span class="line"><span class="keyword">end</span> </span></span>
<span class="srcline"><span class="lineno"><a href="111,151" id="srcline151">151</a></span><span class="line"> </span></span>
<span class="srcline"><span class="lineno"><a href="111,152" id="srcline152">152</a></span><span class="line"><span class="mxinfo" id="T7:U68"><span class="var type1" id="S5T7U168">Wn</span> = <span class="mxinfo" id="T7:U70"><span class="mxinfo" id="T105:U71"><span class="var type1" id="S5T7U171">Wn</span>(:)</span>'</span></span>; </span></span>
<span class="srcline"><span class="lineno"><a href="111,153" id="srcline153">153</a></span><span class="line"><span class="mxinfo" id="T31:U73"><span class="var type1" id="S27T31U175">ff</span> = <span class="mxinfo" id="T31:U75">[<span class="mxinfo" id="T19:U76"><span class="mxinfo" id="T2:U77">0</span>,<span class="mxinfo" id="T7:U78"><span class="var type1" id="S5T7U180">Wn</span>(<span class="mxinfo" id="T7:U80"><span class="mxinfo" id="T2:U81">1</span>:<span class="mxinfo" id="T2:U82"><span class="var type1" id="S15T2U184">nbands</span>-1</span></span>)</span></span>; <span class="mxinfo" id="T19:U84"><span class="mxinfo" id="T7:U85"><span class="var type1" id="S5T7U188">Wn</span>(<span class="mxinfo" id="T7:U87"><span class="mxinfo" id="T2:U88">1</span>:<span class="mxinfo" id="T2:U89"><span class="var type1" id="S15T2U192">nbands</span>-1</span></span>)</span>,<span class="mxinfo" id="T2:U91">1</span></span>]</span></span>; </span></span>
<span class="srcline"><span class="lineno"><a href="111,154" id="srcline154">154</a></span><span class="line"><span class="mxinfo" id="T31:U92"><span class="var type1" id="S19T31U197">mags</span> = <span class="mxinfo" id="T31:U94">[<span class="var type1" id="S19T19U202">mags</span>(:)'; <span class="var type1" id="S19T19U207">mags</span>(:)']</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="111,155" id="srcline155">155</a></span><span class="line"><span class="comment">% hh_test = firls(L-1,ff(:),mags(:)); </span></span></span>
<span class="srcline"><span class="lineno"><a href="111,156" id="srcline156">156</a></span><span class="line"><span class="mxinfo" id="T55:U97"><span class="var type1" id="S28T55U211">hh</span> = <span class="mxinfo" id="T55:U99"><span class="fcn" id="F349N4:B213">Myfirls</span>(<span class="var type1" id="S21T2U215">L</span>-1,<span class="mxinfo" id="T32:U101"><span class="var type1" id="S27T31U218">ff</span>(:)</span>,<span class="var type1" id="S19T31U221">mags</span>(:))</span></span>; </span></span>
<span class="srcline"><span class="lineno"><a href="111,157" id="srcline157">157</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="111,158" id="srcline158">158</a></span><span class="line"> </span></span>
<span class="srcline"><span class="lineno"><a href="111,159" id="srcline159">159</a></span><span class="line"><span class="mxinfo" id="T55:U104"><span class="var type1" id="S2T55U225">b</span> = <span class="mxinfo" id="T55:U106"><span class="var type1" id="S28T55U227">hh</span>.*<span class="mxinfo" id="T55:U108"><span class="mxinfo" id="T22:U109"><span class="var type1" id="S23T22U230">Window</span>(:)</span>'</span></span></span>;  </span></span>
<span class="srcline"><span class="lineno"><a href="111,160" id="srcline160">160</a></span><span class="line"><span class="mxinfo" id="T2:U111"><span class="var type1" id="S3T2U234">a</span> = <span class="mxinfo" id="T2:U113">1</span></span>; </span></span>
<span class="srcline"><span class="lineno"><a href="111,161" id="srcline161">161</a></span><span class="line"> </span></span>
<span class="srcline"><span class="lineno"><a href="111,162" id="srcline162">162</a></span><span class="line"><span class="keyword">if</span> <span class="var type1" id="S7T2U238">SCALING</span> </span></span>
<span class="srcline"><span class="lineno"><a href="111,163" id="srcline163">163</a></span><span class="line">    <span class="keyword">if</span> <span class="var type1" id="S17T4U241">First_Band</span> </span></span>
<span class="srcline"><span class="lineno"><a href="111,164" id="srcline164">164</a></span><span class="line">        <span class="var type0" id="S2T0U244">b</span> = <span class="var type0" id="S2T0U246">b</span> / sum(<span class="var type0" id="S2T0U249">b</span>);  <span class="comment">% unity gain at DC </span></span></span>
<span class="srcline"><span class="lineno"><a href="111,165" id="srcline165">165</a></span><span class="line">    <span class="keyword">else</span> </span></span>
<span class="srcline"><span class="lineno"><a href="111,166" id="srcline166">166</a></span><span class="line">        <span class="keyword">if</span> <span class="mxinfo" id="T4:U116"><span class="mxinfo" id="T2:U117"><span class="var type1" id="S27T31U255">ff</span>(<span class="mxinfo" id="T2:U119">4</span>)</span>==<span class="mxinfo" id="T2:U120">1</span></span> </span></span>
<span class="srcline"><span class="lineno"><a href="111,167" id="srcline167">167</a></span><span class="line">            <span class="comment">% unity gain at Fs/2 </span></span></span>
<span class="srcline"><span class="lineno"><a href="111,168" id="srcline168">168</a></span><span class="line">            <span class="mxinfo" id="T2:U121"><span class="var type1" id="S31T2U260">f0</span> = <span class="mxinfo" id="T2:U123">1</span></span>; </span></span>
<span class="srcline"><span class="lineno"><a href="111,169" id="srcline169">169</a></span><span class="line">        <span class="keyword">else</span> </span></span>
<span class="srcline"><span class="lineno"><a href="111,170" id="srcline170">170</a></span><span class="line">            <span class="comment">% unity gain at center of first passband </span></span></span>
<span class="srcline"><span class="lineno"><a href="111,171" id="srcline171">171</a></span><span class="line">            <span class="mxinfo" id="T2:U124"><span class="var type1" id="S31T2U265">f0</span> = <span class="mxinfo" id="T2:U126">mean(<span class="mxinfo" id="T7:U127"><span class="var type1" id="S27T31U269">ff</span>(<span class="mxinfo" id="T7:U129"><span class="mxinfo" id="T2:U130">3</span>:<span class="mxinfo" id="T2:U131">4</span></span>)</span>)</span></span>; </span></span>
<span class="srcline"><span class="lineno"><a href="111,172" id="srcline172">172</a></span><span class="line">        <span class="keyword">end</span> </span></span>
<span class="srcline"><span class="lineno"><a href="111,173" id="srcline173">173</a></span><span class="line">        <span class="mxinfo" id="T55:U132"><span class="var type1" id="S2T55U275">b</span> = <span class="mxinfo" id="T55:U134"><span class="var type1" id="S2T55U277">b</span> / <span class="mxinfo" id="T2:U136">abs( <span class="mxinfo" id="T60:U137"><span class="mxinfo" id="T61:U138">exp(<span class="mxinfo" id="T61:U139"><span class="mxinfo" id="T61:U140">-j*2*pi*(0:<span class="var type1" id="S21T2U297">L</span>-1)</span>*(<span class="mxinfo" id="T2:U142"><span class="var type1" id="S31T2U301">f0</span>/<span class="mxinfo" id="T2:U144">2</span></span>)</span>)</span>*(<span class="mxinfo" id="T22:U145"><span class="var type1" id="S2T55U305">b</span>.'</span>)</span> )</span></span></span>; </span></span>
<span class="srcline"><span class="lineno"><a href="111,174" id="srcline174">174</a></span><span class="line">    <span class="keyword">end</span> </span></span>
<span class="srcline"><span class="lineno"><a href="111,175" id="srcline175">175</a></span><span class="line"><span class="keyword"><span class="keyword">end</span></span> </span></span>
</pre>
