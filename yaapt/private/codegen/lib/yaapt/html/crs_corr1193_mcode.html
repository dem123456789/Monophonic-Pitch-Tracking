<!-- saved from url=(0014)about:internet -->
<pre class="code">
<span class="srcline"><span class="lineno"><a href="170,1" id="srcline1"> 1</a></span><span class="line"><span class="keyword">function</span>[<span class="var type1" id="S2T1U3">Phi</span>] = crs_corr(<span class="var type1" id="S3T88U6">Data</span>, <span class="var type1" id="S4T2U7">lag_min</span>, <span class="var type1" id="S5T2U8">lag_max</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="170,2" id="srcline2"> 2</a></span><span class="line"><span class="comment">% CRS_CORR compute NCCF (Normalized cross correlation Function) </span></span></span>
<span class="srcline"><span class="lineno"><a href="170,3" id="srcline3"> 3</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="170,4" id="srcline4"> 4</a></span><span class="line"><span class="comment">%   [Phi] = crs_corr(Data, lag_min, lag_max) computes the</span></span></span>
<span class="srcline"><span class="lineno"><a href="170,5" id="srcline5"> 5</a></span><span class="line"><span class="comment">%   normalized cross correlation sequence based on the RAPT algorithm </span></span></span>
<span class="srcline"><span class="lineno"><a href="170,6" id="srcline6"> 6</a></span><span class="line"><span class="comment">%   discussed by DAVID TALKIN.</span></span></span>
<span class="srcline"><span class="lineno"><a href="170,7" id="srcline7"> 7</a></span><span class="line"><span class="comment">%   "Assume that "S" is the input signal sequence, "Phi" is correlation sequence,</span></span></span>
<span class="srcline"><span class="lineno"><a href="170,8" id="srcline8"> 8</a></span><span class="line"><span class="comment">%       Phi(k)=SUM((S[j])*(S[j+k]))/sqrt((SUM(s[j]^2)*(S[j+k]^2)))</span></span></span>
<span class="srcline"><span class="lineno"><a href="170,9" id="srcline9"> 9</a></span><span class="line"><span class="comment">%       where 1 &lt;= k &lt;= Lag_max and 1 &lt;= j &lt;= N. Summation is based on j only</span></span></span>
<span class="srcline"><span class="lineno"><a href="170,10" id="srcline10">10</a></span><span class="line"><span class="comment">%       Phi(k) should range from -1 to 1".</span></span></span>
<span class="srcline"><span class="lineno"><a href="170,11" id="srcline11">11</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="170,12" id="srcline12">12</a></span><span class="line"><span class="comment">% INPUTS:   </span></span></span>
<span class="srcline"><span class="lineno"><a href="170,13" id="srcline13">13</a></span><span class="line"><span class="comment">%   Data:     Data array of signal values.</span></span></span>
<span class="srcline"><span class="lineno"><a href="170,14" id="srcline14">14</a></span><span class="line"><span class="comment">%   lag_min:  minimum value of lag to consider</span></span></span>
<span class="srcline"><span class="lineno"><a href="170,15" id="srcline15">15</a></span><span class="line"><span class="comment">%   lag_max:  maximum value of lag to consider</span></span></span>
<span class="srcline"><span class="lineno"><a href="170,16" id="srcline16">16</a></span><span class="line"><span class="comment">%   Note that calculations will be based on (len-----lag_max)  points</span></span></span>
<span class="srcline"><span class="lineno"><a href="170,17" id="srcline17">17</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="170,18" id="srcline18">18</a></span><span class="line"><span class="comment">% OUTPUTS:</span></span></span>
<span class="srcline"><span class="lineno"><a href="170,19" id="srcline19">19</a></span><span class="line"><span class="comment">%   Phi     : The normalized cross correlated</span></span></span>
<span class="srcline"><span class="lineno"><a href="170,20" id="srcline20">20</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="170,21" id="srcline21">21</a></span><span class="line"><span class="comment">%   Note: The index of the first reasonable peak value of Phi is considered</span></span></span>
<span class="srcline"><span class="lineno"><a href="170,22" id="srcline22">22</a></span><span class="line"><span class="comment">%   to be the period of the input signal.</span></span></span>
<span class="srcline"><span class="lineno"><a href="170,23" id="srcline23">23</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="170,24" id="srcline24">24</a></span><span class="line"><span class="comment">%  Programmer: S.A.Zahorian,Kasi Kavita.</span></span></span>
<span class="srcline"><span class="lineno"><a href="170,25" id="srcline25">25</a></span><span class="line"><span class="comment">%  Creation date:  2000</span></span></span>
<span class="srcline"><span class="lineno"><a href="170,26" id="srcline26">26</a></span><span class="line"><span class="comment">%  Revision date:  March 26, 2002</span></span></span>
<span class="srcline"><span class="lineno"><a href="170,27" id="srcline27">27</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="170,28" id="srcline28">28</a></span><span class="line"><span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span></span></span>
<span class="srcline"><span class="lineno"><a href="170,29" id="srcline29">29</a></span><span class="line"><span class="comment">%     This file is a part of the YAAPT program, designed for a fundamental </span></span></span>
<span class="srcline"><span class="lineno"><a href="170,30" id="srcline30">30</a></span><span class="line"><span class="comment">%   frequency tracking algorithm that is extermely robust for both high quality </span></span></span>
<span class="srcline"><span class="lineno"><a href="170,31" id="srcline31">31</a></span><span class="line"><span class="comment">%   and telephone speech.  </span></span></span>
<span class="srcline"><span class="lineno"><a href="170,32" id="srcline32">32</a></span><span class="line"><span class="comment">%     The YAAPT program was created by the Speech Communication Laboratory of</span></span></span>
<span class="srcline"><span class="lineno"><a href="170,33" id="srcline33">33</a></span><span class="line"><span class="comment">%   the state university of New York at Binghamton. The program is available </span></span></span>
<span class="srcline"><span class="lineno"><a href="170,34" id="srcline34">34</a></span><span class="line"><span class="comment">%   at http://www.ws.binghamton.edu/zahorian as free software. Further </span></span></span>
<span class="srcline"><span class="lineno"><a href="170,35" id="srcline35">35</a></span><span class="line"><span class="comment">%   information about the program could be found at "A spectral/temporal </span></span></span>
<span class="srcline"><span class="lineno"><a href="170,36" id="srcline36">36</a></span><span class="line"><span class="comment">%   method for robust fundamental frequency tracking," J.Acosut.Soc.Am. 123(6), </span></span></span>
<span class="srcline"><span class="lineno"><a href="170,37" id="srcline37">37</a></span><span class="line"><span class="comment">%   June 2008.</span></span></span>
<span class="srcline"><span class="lineno"><a href="170,38" id="srcline38">38</a></span><span class="line"><span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span></span></span>
<span class="srcline"><span class="lineno"><a href="170,39" id="srcline39">39</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="170,40" id="srcline40">40</a></span><span class="line"><span class="comment">% Some initialization</span></span></span>
<span class="srcline"><span class="lineno"><a href="170,41" id="srcline41">41</a></span><span class="line"><span class="mxinfo " id="T2:U5"><span class="var type1" id="S6T2U11">eps1</span> = <span class="mxinfo " id="T2:U7">0.0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="170,42" id="srcline42">42</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="170,43" id="srcline43">43</a></span><span class="line"><span class="mxinfo " id="T2:U8"><span class="var type1" id="S7T2U15">len</span>  = <span class="mxinfo " id="T2:U10">length(<span class="var type1" id="S3T88U18">Data</span>)</span></span>; <span class="comment">% The length of data</span></span></span>
<span class="srcline"><span class="lineno"><a href="170,44" id="srcline44">44</a></span><span class="line"><span class="mxinfo " id="T2:U12"><span class="var type1" id="S9T2U21">N</span> = <span class="mxinfo " id="T2:U14"><span class="var type1" id="S7T2U23">len</span>-<span class="var type1" id="S5T2U24">lag_max</span></span></span>;    <span class="comment">% range</span></span></span>
<span class="srcline"><span class="lineno"><a href="170,45" id="srcline45">45</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="170,46" id="srcline46">46</a></span><span class="line"><span class="mxinfo " id="T1:U17"><span class="var type1" id="S2T1U27">Phi</span> = <span class="mxinfo " id="T1:U19">zeros(<span class="mxinfo " id="T2:U20">1</span>,<span class="var type1" id="S7T2U31">len</span>)</span></span>  ;</span></span>
<span class="srcline"><span class="lineno"><a href="170,47" id="srcline47">47</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="170,48" id="srcline48">48</a></span><span class="line"><span class="comment">% Remove DC level</span></span></span>
<span class="srcline"><span class="lineno"><a href="170,49" id="srcline49">49</a></span><span class="line"><span class="mxinfo " id="T88:U22"><span class="var type1" id="S3T88U34">Data</span> = <span class="mxinfo " id="T88:U24"><span class="var type1" id="S3T88U36">Data</span>- <span class="mxinfo " id="T2:U26">mean(<span class="var type1" id="S3T88U39">Data</span>)</span></span></span>; </span></span>
<span class="srcline"><span class="lineno"><a href="170,50" id="srcline50">50</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="170,51" id="srcline51">51</a></span><span class="line"><span class="mxinfo " id="T88:U28"><span class="var type1" id="S12T88U42">x_j</span> =  <span class="mxinfo " id="T88:U30"><span class="var type1" id="S3T88U44">Data</span>(<span class="mxinfo " id="T87:U32"><span class="mxinfo " id="T2:U33">1</span>:<span class="var type1" id="S9T2U47">N</span></span>)</span></span>;     <span class="comment">% s[j]   1 &lt;= j &lt;= N.</span></span></span>
<span class="srcline"><span class="lineno"><a href="170,52" id="srcline52">52</a></span><span class="line"><span class="mxinfo " id="T2:U35"><span class="var type1" id="S13T2U50">p</span> = <span class="mxinfo " id="T2:U37"><span class="mxinfo " id="T1:U38"><span class="var type1" id="S12T88U53">x_j</span>'</span> * <span class="var type1" id="S12T88U54">x_j</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="170,53" id="srcline53">53</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="170,54" id="srcline54">54</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S14T2U57">k</span> = <span class="var type1" id="S4T2U59">lag_min</span>:<span class="var type1" id="S5T2U60">lag_max</span></span></span>
<span class="srcline"><span class="lineno"><a href="170,55" id="srcline55">55</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="170,56" id="srcline56">56</a></span><span class="line">    <span class="comment">%  to calculate the dot product of the signal and displaced version.</span></span></span>
<span class="srcline"><span class="lineno"><a href="170,57" id="srcline57">57</a></span><span class="line">    <span class="mxinfo " id="T88:U44"><span class="var type1" id="S15T88U63">x_jr</span> = <span class="mxinfo " id="T88:U46"><span class="var type1" id="S3T88U65">Data</span>(<span class="mxinfo " id="T87:U48"><span class="var type1" id="S14T2U67">k</span>:<span class="mxinfo " id="T2:U50"><span class="mxinfo " id="T2:U51"><span class="var type1" id="S14T2U70">k</span>+<span class="var type1" id="S9T2U71">N</span></span>-<span class="mxinfo " id="T2:U54">1</span></span></span>)</span></span>;    <span class="comment">% s[j]   -k &lt;= j &lt;= N+K-k-1.</span></span></span>
<span class="srcline"><span class="lineno"><a href="170,58" id="srcline58">58</a></span><span class="line">    <span class="mxinfo " id="T2:U55"><span class="var type1" id="S16T2U75">formula_nume</span> = <span class="mxinfo " id="T2:U57"><span class="mxinfo " id="T1:U58"><span class="var type1" id="S12T88U78">x_j</span>'</span> * <span class="var type1" id="S15T88U79">x_jr</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="170,59" id="srcline59">59</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="170,60" id="srcline60">60</a></span><span class="line">    <span class="comment">% the normalization factor for the denominator.</span></span></span>
<span class="srcline"><span class="lineno"><a href="170,61" id="srcline61">61</a></span><span class="line">    <span class="mxinfo " id="T2:U61"><span class="var type1" id="S17T2U82">q</span> = <span class="mxinfo " id="T2:U63"><span class="mxinfo " id="T1:U64"><span class="var type1" id="S15T88U85">x_jr</span>'</span> * <span class="var type1" id="S15T88U86">x_jr</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="170,62" id="srcline62">62</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="170,63" id="srcline63">63</a></span><span class="line">    <span class="mxinfo " id="T2:U67"><span class="var type1" id="S18T2U89">formula_denom</span>= <span class="mxinfo " id="T2:U69"><span class="var type1" id="S13T2U91">p</span>*<span class="var type1" id="S17T2U92">q</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="170,64" id="srcline64">64</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="170,65" id="srcline65">65</a></span><span class="line">    <span class="mxinfo " id="T2:U72"><span class="var type1" id="S18T2U95">formula_denom</span> = <span class="mxinfo " id="T2:U74"><span class="var type1" id="S18T2U97">formula_denom</span>+ <span class="var type1" id="S6T2U98">eps1</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="170,66" id="srcline66">66</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="170,67" id="srcline67">67</a></span><span class="line">    <span class="comment">% calculate the normalized crosscorrelation value using the TALKIN FORMULA.</span></span></span>
<span class="srcline"><span class="lineno"><a href="170,68" id="srcline68">68</a></span><span class="line">    <span class="mxinfo " id="T2:U77"><span class="mxinfo " id="T2:U78"><span class="var type1" id="S2T1U102">Phi</span>(<span class="var type1" id="S14T2U103">k</span>)</span>=(<span class="mxinfo " id="T2:U81">(<span class="var type1" id="S16T2U107">formula_nume</span>)/(<span class="mxinfo " id="T2:U83">sqrt(<span class="var type1" id="S18T2U111">formula_denom</span>)</span>)</span>)</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="170,69" id="srcline69">69</a></span><span class="line"><span class="keyword"><span class="keyword">end</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="170,70" id="srcline70">70</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="170,71" id="srcline71">71</a></span><span class="line"><span class="comment">%   To test using autocorrelation</span></span></span>
<span class="srcline"><span class="lineno"><a href="170,72" id="srcline72">72</a></span><span class="line"><span class="comment">%    Phi = xcorr(s);</span></span></span>
<span class="srcline"><span class="lineno"><a href="170,73" id="srcline73">73</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="170,74" id="srcline74">74</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="170,75" id="srcline75">75</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="170,76" id="srcline76">76</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="170,77" id="srcline77">77</a></span><span class="line"></span></span>
</pre>
